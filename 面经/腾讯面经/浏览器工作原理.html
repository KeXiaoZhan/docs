<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器工作原理 | 木可生森</title>
    <meta name="generator" content="VuePress 1.9.2">
    <link rel="icon" href="/docs/img/logo.jpg">
    <meta name="description" content="瞧一瞧，看一看">
    
    <link rel="preload" href="/docs/assets/css/0.styles.1fca6052.css" as="style"><link rel="preload" href="/docs/assets/js/app.9351438b.js" as="script"><link rel="preload" href="/docs/assets/js/2.4eec09cd.js" as="script"><link rel="preload" href="/docs/assets/js/1160.b9554851.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.e01ca1a3.js"><link rel="prefetch" href="/docs/assets/js/100.c46df915.js"><link rel="prefetch" href="/docs/assets/js/1000.c783124f.js"><link rel="prefetch" href="/docs/assets/js/1001.a37e0ca3.js"><link rel="prefetch" href="/docs/assets/js/1002.fba979d1.js"><link rel="prefetch" href="/docs/assets/js/1003.985c1713.js"><link rel="prefetch" href="/docs/assets/js/1004.3bf496c2.js"><link rel="prefetch" href="/docs/assets/js/1005.d8e92759.js"><link rel="prefetch" href="/docs/assets/js/1006.ac2f448a.js"><link rel="prefetch" href="/docs/assets/js/1007.e94d814d.js"><link rel="prefetch" href="/docs/assets/js/1008.30e56b91.js"><link rel="prefetch" href="/docs/assets/js/1009.8b8c1bbf.js"><link rel="prefetch" href="/docs/assets/js/101.63ed5b82.js"><link rel="prefetch" href="/docs/assets/js/1010.bc6e611b.js"><link rel="prefetch" href="/docs/assets/js/1011.c383ed0e.js"><link rel="prefetch" href="/docs/assets/js/1012.0b9a5099.js"><link rel="prefetch" href="/docs/assets/js/1013.7e842d1d.js"><link rel="prefetch" href="/docs/assets/js/1014.d9c9cd4b.js"><link rel="prefetch" href="/docs/assets/js/1015.51347c1a.js"><link rel="prefetch" href="/docs/assets/js/1016.9b1397c9.js"><link rel="prefetch" href="/docs/assets/js/1017.11f23546.js"><link rel="prefetch" href="/docs/assets/js/1018.593a14af.js"><link rel="prefetch" href="/docs/assets/js/1019.1f683ac2.js"><link rel="prefetch" href="/docs/assets/js/102.236793de.js"><link rel="prefetch" href="/docs/assets/js/1020.5115d101.js"><link rel="prefetch" href="/docs/assets/js/1021.e440fd5c.js"><link rel="prefetch" href="/docs/assets/js/1022.d2e8ef3e.js"><link rel="prefetch" href="/docs/assets/js/1023.9ed138e1.js"><link rel="prefetch" href="/docs/assets/js/1024.41c64cd0.js"><link rel="prefetch" href="/docs/assets/js/1025.1bb8fab3.js"><link rel="prefetch" href="/docs/assets/js/1026.c1c7ecbc.js"><link rel="prefetch" href="/docs/assets/js/1027.801c4d62.js"><link rel="prefetch" href="/docs/assets/js/1028.908dbc45.js"><link rel="prefetch" href="/docs/assets/js/1029.027e11d6.js"><link rel="prefetch" href="/docs/assets/js/103.7f0f3f5c.js"><link rel="prefetch" href="/docs/assets/js/1030.614dc5cb.js"><link rel="prefetch" href="/docs/assets/js/1031.6bf622b4.js"><link rel="prefetch" href="/docs/assets/js/1032.b984395c.js"><link rel="prefetch" href="/docs/assets/js/1033.6fdcbddf.js"><link rel="prefetch" href="/docs/assets/js/1034.c9d346bb.js"><link rel="prefetch" href="/docs/assets/js/1035.9e214225.js"><link rel="prefetch" href="/docs/assets/js/1036.244451eb.js"><link rel="prefetch" href="/docs/assets/js/1037.ded6c19b.js"><link rel="prefetch" href="/docs/assets/js/1038.5854bf5a.js"><link rel="prefetch" href="/docs/assets/js/1039.8e5d8b03.js"><link rel="prefetch" href="/docs/assets/js/104.1b550121.js"><link rel="prefetch" href="/docs/assets/js/1040.c0ba78b6.js"><link rel="prefetch" href="/docs/assets/js/1041.9118ae65.js"><link rel="prefetch" href="/docs/assets/js/1042.9eb58334.js"><link rel="prefetch" href="/docs/assets/js/1043.e206c726.js"><link rel="prefetch" href="/docs/assets/js/1044.43c496a5.js"><link rel="prefetch" href="/docs/assets/js/1045.a1dddf09.js"><link rel="prefetch" href="/docs/assets/js/1046.267c671d.js"><link rel="prefetch" href="/docs/assets/js/1047.90e84c4d.js"><link rel="prefetch" href="/docs/assets/js/1048.9c76ad24.js"><link rel="prefetch" href="/docs/assets/js/1049.aa0ac9e5.js"><link rel="prefetch" href="/docs/assets/js/105.2b4a0516.js"><link rel="prefetch" href="/docs/assets/js/1050.d49198fd.js"><link rel="prefetch" href="/docs/assets/js/1051.0d72e913.js"><link rel="prefetch" href="/docs/assets/js/1052.bcc68b38.js"><link rel="prefetch" href="/docs/assets/js/1053.021c138e.js"><link rel="prefetch" href="/docs/assets/js/1054.24ea7aae.js"><link rel="prefetch" href="/docs/assets/js/1055.26f58eaa.js"><link rel="prefetch" href="/docs/assets/js/1056.bc398217.js"><link rel="prefetch" href="/docs/assets/js/1057.28186de5.js"><link rel="prefetch" href="/docs/assets/js/1058.14672a6c.js"><link rel="prefetch" href="/docs/assets/js/1059.221915df.js"><link rel="prefetch" href="/docs/assets/js/106.90a1bd05.js"><link rel="prefetch" href="/docs/assets/js/1060.4b236c9d.js"><link rel="prefetch" href="/docs/assets/js/1061.574039e6.js"><link rel="prefetch" href="/docs/assets/js/1062.bc9dc3e5.js"><link rel="prefetch" href="/docs/assets/js/1063.10b23ab2.js"><link rel="prefetch" href="/docs/assets/js/1064.081934ea.js"><link rel="prefetch" href="/docs/assets/js/1065.6b24e6a7.js"><link rel="prefetch" href="/docs/assets/js/1066.e51cfaa2.js"><link rel="prefetch" href="/docs/assets/js/1067.3ea8e62d.js"><link rel="prefetch" href="/docs/assets/js/1068.689b4d2c.js"><link rel="prefetch" href="/docs/assets/js/1069.786aa39b.js"><link rel="prefetch" href="/docs/assets/js/107.eecad668.js"><link rel="prefetch" href="/docs/assets/js/1070.779a45e8.js"><link rel="prefetch" href="/docs/assets/js/1071.c4977bbd.js"><link rel="prefetch" href="/docs/assets/js/1072.045a4078.js"><link rel="prefetch" href="/docs/assets/js/1073.af258b6d.js"><link rel="prefetch" href="/docs/assets/js/1074.069f93d8.js"><link rel="prefetch" href="/docs/assets/js/1075.75a96250.js"><link rel="prefetch" href="/docs/assets/js/1076.ed6f6816.js"><link rel="prefetch" href="/docs/assets/js/1077.173cf90f.js"><link rel="prefetch" href="/docs/assets/js/1078.b2592702.js"><link rel="prefetch" href="/docs/assets/js/1079.0a876b80.js"><link rel="prefetch" href="/docs/assets/js/108.dcd2ed04.js"><link rel="prefetch" href="/docs/assets/js/1080.8cd85d80.js"><link rel="prefetch" href="/docs/assets/js/1081.5ba849b9.js"><link rel="prefetch" href="/docs/assets/js/1082.15132811.js"><link rel="prefetch" href="/docs/assets/js/1083.6af09561.js"><link rel="prefetch" href="/docs/assets/js/1084.255a65e9.js"><link rel="prefetch" href="/docs/assets/js/1085.fb6c4bcb.js"><link rel="prefetch" href="/docs/assets/js/1086.9ad515f0.js"><link rel="prefetch" href="/docs/assets/js/1087.d4960acd.js"><link rel="prefetch" href="/docs/assets/js/1088.8dd28a3d.js"><link rel="prefetch" href="/docs/assets/js/1089.e3bf9538.js"><link rel="prefetch" href="/docs/assets/js/109.4faa1afc.js"><link rel="prefetch" href="/docs/assets/js/1090.47ac564d.js"><link rel="prefetch" href="/docs/assets/js/1091.584365c2.js"><link rel="prefetch" href="/docs/assets/js/1092.6c76691c.js"><link rel="prefetch" href="/docs/assets/js/1093.1d7d7f87.js"><link rel="prefetch" href="/docs/assets/js/1094.76461963.js"><link rel="prefetch" href="/docs/assets/js/1095.0eb8570e.js"><link rel="prefetch" href="/docs/assets/js/1096.e7989c54.js"><link rel="prefetch" href="/docs/assets/js/1097.8ec71ba3.js"><link rel="prefetch" href="/docs/assets/js/1098.1d0595b6.js"><link rel="prefetch" href="/docs/assets/js/1099.f4fb478f.js"><link rel="prefetch" href="/docs/assets/js/11.ab3ac22d.js"><link rel="prefetch" href="/docs/assets/js/110.07f637cc.js"><link rel="prefetch" href="/docs/assets/js/1100.d5dd278b.js"><link rel="prefetch" href="/docs/assets/js/1101.65e1bdee.js"><link rel="prefetch" href="/docs/assets/js/1102.3cc3fb95.js"><link rel="prefetch" href="/docs/assets/js/1103.c12f31f0.js"><link rel="prefetch" href="/docs/assets/js/1104.a240aa5e.js"><link rel="prefetch" href="/docs/assets/js/1105.6a5e7b9a.js"><link rel="prefetch" href="/docs/assets/js/1106.d4007c0f.js"><link rel="prefetch" href="/docs/assets/js/1107.a3b5738f.js"><link rel="prefetch" href="/docs/assets/js/1108.6a3227ef.js"><link rel="prefetch" href="/docs/assets/js/1109.7ff26a5e.js"><link rel="prefetch" href="/docs/assets/js/111.7164167b.js"><link rel="prefetch" href="/docs/assets/js/1110.40be73cb.js"><link rel="prefetch" href="/docs/assets/js/1111.696ef598.js"><link rel="prefetch" href="/docs/assets/js/1112.2a077f9b.js"><link rel="prefetch" href="/docs/assets/js/1113.7127a1bd.js"><link rel="prefetch" href="/docs/assets/js/1114.ba799891.js"><link rel="prefetch" href="/docs/assets/js/1115.dcd97c6e.js"><link rel="prefetch" href="/docs/assets/js/1116.8e2d996f.js"><link rel="prefetch" href="/docs/assets/js/1117.3a9c4cc7.js"><link rel="prefetch" href="/docs/assets/js/1118.f875ccfb.js"><link rel="prefetch" href="/docs/assets/js/1119.d6c91b46.js"><link rel="prefetch" href="/docs/assets/js/112.8744fef8.js"><link rel="prefetch" href="/docs/assets/js/1120.2924617f.js"><link rel="prefetch" href="/docs/assets/js/1121.ca6cd9bf.js"><link rel="prefetch" href="/docs/assets/js/1122.0b4c1a4d.js"><link rel="prefetch" href="/docs/assets/js/1123.be76ba87.js"><link rel="prefetch" href="/docs/assets/js/1124.e6f9c429.js"><link rel="prefetch" href="/docs/assets/js/1125.d44f07d2.js"><link rel="prefetch" href="/docs/assets/js/1126.6b01260f.js"><link rel="prefetch" href="/docs/assets/js/1127.c0263086.js"><link rel="prefetch" href="/docs/assets/js/1128.ca7e8dab.js"><link rel="prefetch" href="/docs/assets/js/1129.178b6122.js"><link rel="prefetch" href="/docs/assets/js/113.b2dfdd3f.js"><link rel="prefetch" href="/docs/assets/js/1130.a07d4530.js"><link rel="prefetch" href="/docs/assets/js/1131.eb2205e9.js"><link rel="prefetch" href="/docs/assets/js/1132.eb3f0942.js"><link rel="prefetch" href="/docs/assets/js/1133.f8fcc199.js"><link rel="prefetch" href="/docs/assets/js/1134.6ada7d1b.js"><link rel="prefetch" href="/docs/assets/js/1135.daa64c0b.js"><link rel="prefetch" href="/docs/assets/js/1136.926a723d.js"><link rel="prefetch" href="/docs/assets/js/1137.8db8e3a9.js"><link rel="prefetch" href="/docs/assets/js/1138.64dedf9e.js"><link rel="prefetch" href="/docs/assets/js/1139.650f8218.js"><link rel="prefetch" href="/docs/assets/js/114.4fd4960b.js"><link rel="prefetch" href="/docs/assets/js/1140.4747721d.js"><link rel="prefetch" href="/docs/assets/js/1141.c4785909.js"><link rel="prefetch" href="/docs/assets/js/1142.49596d0f.js"><link rel="prefetch" href="/docs/assets/js/1143.8950e995.js"><link rel="prefetch" href="/docs/assets/js/1144.015b0007.js"><link rel="prefetch" href="/docs/assets/js/1145.8fd19556.js"><link rel="prefetch" href="/docs/assets/js/1146.92412a60.js"><link rel="prefetch" href="/docs/assets/js/1147.89c804ea.js"><link rel="prefetch" href="/docs/assets/js/1148.897766d6.js"><link rel="prefetch" href="/docs/assets/js/1149.72d906f4.js"><link rel="prefetch" href="/docs/assets/js/115.89c6dc02.js"><link rel="prefetch" href="/docs/assets/js/1150.991114db.js"><link rel="prefetch" href="/docs/assets/js/1151.80bee007.js"><link rel="prefetch" href="/docs/assets/js/1152.d26fdeb3.js"><link rel="prefetch" href="/docs/assets/js/1153.5e8f3058.js"><link rel="prefetch" href="/docs/assets/js/1154.39235bf6.js"><link rel="prefetch" href="/docs/assets/js/1155.e0c9b8c9.js"><link rel="prefetch" href="/docs/assets/js/1156.606b532d.js"><link rel="prefetch" href="/docs/assets/js/1157.1678e480.js"><link rel="prefetch" href="/docs/assets/js/1158.bbfe8734.js"><link rel="prefetch" href="/docs/assets/js/1159.eacf13d7.js"><link rel="prefetch" href="/docs/assets/js/116.4e9cc0b6.js"><link rel="prefetch" href="/docs/assets/js/1161.ec0cd485.js"><link rel="prefetch" href="/docs/assets/js/1162.912b7026.js"><link rel="prefetch" href="/docs/assets/js/1163.1805fd85.js"><link rel="prefetch" href="/docs/assets/js/1164.3a39c169.js"><link rel="prefetch" href="/docs/assets/js/1165.552d6ccf.js"><link rel="prefetch" href="/docs/assets/js/1166.84381c7a.js"><link rel="prefetch" href="/docs/assets/js/1167.aad33f24.js"><link rel="prefetch" href="/docs/assets/js/1168.34e74848.js"><link rel="prefetch" href="/docs/assets/js/1169.f74fd1da.js"><link rel="prefetch" href="/docs/assets/js/117.49e09d71.js"><link rel="prefetch" href="/docs/assets/js/1170.049e3211.js"><link rel="prefetch" href="/docs/assets/js/1171.0b91492c.js"><link rel="prefetch" href="/docs/assets/js/1172.338bd57a.js"><link rel="prefetch" href="/docs/assets/js/1173.c8e76553.js"><link rel="prefetch" href="/docs/assets/js/1174.cbb8c367.js"><link rel="prefetch" href="/docs/assets/js/1175.833cd7f4.js"><link rel="prefetch" href="/docs/assets/js/1176.794565cf.js"><link rel="prefetch" href="/docs/assets/js/1177.30974d7f.js"><link rel="prefetch" href="/docs/assets/js/1178.b475179c.js"><link rel="prefetch" href="/docs/assets/js/1179.b43eae08.js"><link rel="prefetch" href="/docs/assets/js/118.4414541d.js"><link rel="prefetch" href="/docs/assets/js/1180.87764bce.js"><link rel="prefetch" href="/docs/assets/js/1181.fcf015db.js"><link rel="prefetch" href="/docs/assets/js/1182.24bbda69.js"><link rel="prefetch" href="/docs/assets/js/1183.86796ae4.js"><link rel="prefetch" href="/docs/assets/js/1184.a63f47ed.js"><link rel="prefetch" href="/docs/assets/js/1185.3523fcc2.js"><link rel="prefetch" href="/docs/assets/js/1186.b04f727f.js"><link rel="prefetch" href="/docs/assets/js/1187.ee377bf5.js"><link rel="prefetch" href="/docs/assets/js/1188.80b995cf.js"><link rel="prefetch" href="/docs/assets/js/1189.ee63ac5d.js"><link rel="prefetch" href="/docs/assets/js/119.d5924c2b.js"><link rel="prefetch" href="/docs/assets/js/1190.374c051f.js"><link rel="prefetch" href="/docs/assets/js/12.ce485d8e.js"><link rel="prefetch" href="/docs/assets/js/120.14ff6d49.js"><link rel="prefetch" href="/docs/assets/js/121.533a5c45.js"><link rel="prefetch" href="/docs/assets/js/122.8bda29e6.js"><link rel="prefetch" href="/docs/assets/js/123.cf3090b5.js"><link rel="prefetch" href="/docs/assets/js/124.0f54a5b4.js"><link rel="prefetch" href="/docs/assets/js/125.7837117e.js"><link rel="prefetch" href="/docs/assets/js/126.2ab2e348.js"><link rel="prefetch" href="/docs/assets/js/127.557b2a8d.js"><link rel="prefetch" href="/docs/assets/js/128.8494f21d.js"><link rel="prefetch" href="/docs/assets/js/129.9d73a4c1.js"><link rel="prefetch" href="/docs/assets/js/13.7b96c158.js"><link rel="prefetch" href="/docs/assets/js/130.db3086ab.js"><link rel="prefetch" href="/docs/assets/js/131.8dcfb910.js"><link rel="prefetch" href="/docs/assets/js/132.1411b965.js"><link rel="prefetch" href="/docs/assets/js/133.b7fa6a58.js"><link rel="prefetch" href="/docs/assets/js/134.e50c0cce.js"><link rel="prefetch" href="/docs/assets/js/135.bdacf800.js"><link rel="prefetch" href="/docs/assets/js/136.a144241f.js"><link rel="prefetch" href="/docs/assets/js/137.721f1f46.js"><link rel="prefetch" href="/docs/assets/js/138.0ef7fce1.js"><link rel="prefetch" href="/docs/assets/js/139.7bfc0ae5.js"><link rel="prefetch" href="/docs/assets/js/14.0d6900b3.js"><link rel="prefetch" href="/docs/assets/js/140.1253c36b.js"><link rel="prefetch" href="/docs/assets/js/141.c6ce3688.js"><link rel="prefetch" href="/docs/assets/js/142.badfa322.js"><link rel="prefetch" href="/docs/assets/js/143.45b3cc5f.js"><link rel="prefetch" href="/docs/assets/js/144.10046567.js"><link rel="prefetch" href="/docs/assets/js/145.089debff.js"><link rel="prefetch" href="/docs/assets/js/146.6045cc41.js"><link rel="prefetch" href="/docs/assets/js/147.aaaba74b.js"><link rel="prefetch" href="/docs/assets/js/148.2647ef3e.js"><link rel="prefetch" href="/docs/assets/js/149.d83ce7d1.js"><link rel="prefetch" href="/docs/assets/js/15.cda55a78.js"><link rel="prefetch" href="/docs/assets/js/150.865e0eba.js"><link rel="prefetch" href="/docs/assets/js/151.d1a4d2c2.js"><link rel="prefetch" href="/docs/assets/js/152.bfd5f381.js"><link rel="prefetch" href="/docs/assets/js/153.3c5541d7.js"><link rel="prefetch" href="/docs/assets/js/154.2d86cecf.js"><link rel="prefetch" href="/docs/assets/js/155.8b80a7b9.js"><link rel="prefetch" href="/docs/assets/js/156.8f1d184f.js"><link rel="prefetch" href="/docs/assets/js/157.999f953c.js"><link rel="prefetch" href="/docs/assets/js/158.69b4dde7.js"><link rel="prefetch" href="/docs/assets/js/159.9073ff7b.js"><link rel="prefetch" href="/docs/assets/js/16.c0ccad98.js"><link rel="prefetch" href="/docs/assets/js/160.77f5a7f2.js"><link rel="prefetch" href="/docs/assets/js/161.617fd309.js"><link rel="prefetch" href="/docs/assets/js/162.a89f73af.js"><link rel="prefetch" href="/docs/assets/js/163.45d3e8f6.js"><link rel="prefetch" href="/docs/assets/js/164.de6bc84e.js"><link rel="prefetch" href="/docs/assets/js/165.49cb89d7.js"><link rel="prefetch" href="/docs/assets/js/166.674c3191.js"><link rel="prefetch" href="/docs/assets/js/167.284395e5.js"><link rel="prefetch" href="/docs/assets/js/168.f48ffb25.js"><link rel="prefetch" href="/docs/assets/js/169.bb6b1c77.js"><link rel="prefetch" href="/docs/assets/js/17.00caf44a.js"><link rel="prefetch" href="/docs/assets/js/170.1e8608f2.js"><link rel="prefetch" href="/docs/assets/js/171.ae758677.js"><link rel="prefetch" href="/docs/assets/js/172.1b524bfe.js"><link rel="prefetch" href="/docs/assets/js/173.b2703b89.js"><link rel="prefetch" href="/docs/assets/js/174.c034873b.js"><link rel="prefetch" href="/docs/assets/js/175.c72855c1.js"><link rel="prefetch" href="/docs/assets/js/176.e920477f.js"><link rel="prefetch" href="/docs/assets/js/177.bb082227.js"><link rel="prefetch" href="/docs/assets/js/178.05421952.js"><link rel="prefetch" href="/docs/assets/js/179.34c5e625.js"><link rel="prefetch" href="/docs/assets/js/18.011f9e4f.js"><link rel="prefetch" href="/docs/assets/js/180.0543f56f.js"><link rel="prefetch" href="/docs/assets/js/181.95fdc25b.js"><link rel="prefetch" href="/docs/assets/js/182.c6878bc3.js"><link rel="prefetch" href="/docs/assets/js/183.58bf7566.js"><link rel="prefetch" href="/docs/assets/js/184.bf213114.js"><link rel="prefetch" href="/docs/assets/js/185.924a53bf.js"><link rel="prefetch" href="/docs/assets/js/186.573e25e2.js"><link rel="prefetch" href="/docs/assets/js/187.1082e50c.js"><link rel="prefetch" href="/docs/assets/js/188.a3ef37db.js"><link rel="prefetch" href="/docs/assets/js/189.24190ded.js"><link rel="prefetch" href="/docs/assets/js/19.e9f171c2.js"><link rel="prefetch" href="/docs/assets/js/190.b7fa7463.js"><link rel="prefetch" href="/docs/assets/js/191.92cdc789.js"><link rel="prefetch" href="/docs/assets/js/192.0a88fe83.js"><link rel="prefetch" href="/docs/assets/js/193.702679d2.js"><link rel="prefetch" href="/docs/assets/js/194.1bd0b5f0.js"><link rel="prefetch" href="/docs/assets/js/195.f26aea68.js"><link rel="prefetch" href="/docs/assets/js/196.79b5e82a.js"><link rel="prefetch" href="/docs/assets/js/197.35833980.js"><link rel="prefetch" href="/docs/assets/js/198.d8a646ac.js"><link rel="prefetch" href="/docs/assets/js/199.d2027178.js"><link rel="prefetch" href="/docs/assets/js/20.b247c8d1.js"><link rel="prefetch" href="/docs/assets/js/200.88f48136.js"><link rel="prefetch" href="/docs/assets/js/201.e28c9d90.js"><link rel="prefetch" href="/docs/assets/js/202.0a8b770d.js"><link rel="prefetch" href="/docs/assets/js/203.8edd62fa.js"><link rel="prefetch" href="/docs/assets/js/204.4c6c3a41.js"><link rel="prefetch" href="/docs/assets/js/205.a20972a4.js"><link rel="prefetch" href="/docs/assets/js/206.8deef739.js"><link rel="prefetch" href="/docs/assets/js/207.29f65a14.js"><link rel="prefetch" href="/docs/assets/js/208.1b55a89b.js"><link rel="prefetch" href="/docs/assets/js/209.5bd0378e.js"><link rel="prefetch" href="/docs/assets/js/21.b944ad82.js"><link rel="prefetch" href="/docs/assets/js/210.653449eb.js"><link rel="prefetch" href="/docs/assets/js/211.e7723b23.js"><link rel="prefetch" href="/docs/assets/js/212.345fa3e7.js"><link rel="prefetch" href="/docs/assets/js/213.ade7cd1e.js"><link rel="prefetch" href="/docs/assets/js/214.b3f67d35.js"><link rel="prefetch" href="/docs/assets/js/215.9d46eb63.js"><link rel="prefetch" href="/docs/assets/js/216.e0794ee9.js"><link rel="prefetch" href="/docs/assets/js/217.f95f764a.js"><link rel="prefetch" href="/docs/assets/js/218.80ff01fd.js"><link rel="prefetch" href="/docs/assets/js/219.73350f31.js"><link rel="prefetch" href="/docs/assets/js/22.3619036a.js"><link rel="prefetch" href="/docs/assets/js/220.9774c92b.js"><link rel="prefetch" href="/docs/assets/js/221.85b9938e.js"><link rel="prefetch" href="/docs/assets/js/222.b1928d30.js"><link rel="prefetch" href="/docs/assets/js/223.1c9b08c7.js"><link rel="prefetch" href="/docs/assets/js/224.1f8d839d.js"><link rel="prefetch" href="/docs/assets/js/225.9df6e5cb.js"><link rel="prefetch" href="/docs/assets/js/226.83a18766.js"><link rel="prefetch" href="/docs/assets/js/227.1fd2ee53.js"><link rel="prefetch" href="/docs/assets/js/228.d19d389c.js"><link rel="prefetch" href="/docs/assets/js/229.87db821f.js"><link rel="prefetch" href="/docs/assets/js/23.34037f6d.js"><link rel="prefetch" href="/docs/assets/js/230.903c800b.js"><link rel="prefetch" href="/docs/assets/js/231.6a01aed9.js"><link rel="prefetch" href="/docs/assets/js/232.1e7d935a.js"><link rel="prefetch" href="/docs/assets/js/233.230602f6.js"><link rel="prefetch" href="/docs/assets/js/234.93a95bea.js"><link rel="prefetch" href="/docs/assets/js/235.c84c98c1.js"><link rel="prefetch" href="/docs/assets/js/236.f9821e17.js"><link rel="prefetch" href="/docs/assets/js/237.ab4f0c44.js"><link rel="prefetch" href="/docs/assets/js/238.135ba397.js"><link rel="prefetch" href="/docs/assets/js/239.d491f958.js"><link rel="prefetch" href="/docs/assets/js/24.cce728f0.js"><link rel="prefetch" href="/docs/assets/js/240.25ae2db0.js"><link rel="prefetch" href="/docs/assets/js/241.0a06c413.js"><link rel="prefetch" href="/docs/assets/js/242.f2060d08.js"><link rel="prefetch" href="/docs/assets/js/243.dfe1117f.js"><link rel="prefetch" href="/docs/assets/js/244.7f92987f.js"><link rel="prefetch" href="/docs/assets/js/245.30e38417.js"><link rel="prefetch" href="/docs/assets/js/246.9e693b62.js"><link rel="prefetch" href="/docs/assets/js/247.052e63d5.js"><link rel="prefetch" href="/docs/assets/js/248.c46ff4a8.js"><link rel="prefetch" href="/docs/assets/js/249.429bbbe0.js"><link rel="prefetch" href="/docs/assets/js/25.faad963b.js"><link rel="prefetch" href="/docs/assets/js/250.48d59456.js"><link rel="prefetch" href="/docs/assets/js/251.0560367d.js"><link rel="prefetch" href="/docs/assets/js/252.987385b3.js"><link rel="prefetch" href="/docs/assets/js/253.e117fc2d.js"><link rel="prefetch" href="/docs/assets/js/254.375a0d19.js"><link rel="prefetch" href="/docs/assets/js/255.e2d3b397.js"><link rel="prefetch" href="/docs/assets/js/256.85b20928.js"><link rel="prefetch" href="/docs/assets/js/257.f69ccbd1.js"><link rel="prefetch" href="/docs/assets/js/258.3ac52b6a.js"><link rel="prefetch" href="/docs/assets/js/259.4a8e8dad.js"><link rel="prefetch" href="/docs/assets/js/26.ebedf7f9.js"><link rel="prefetch" href="/docs/assets/js/260.7f0f89bf.js"><link rel="prefetch" href="/docs/assets/js/261.d8fbb591.js"><link rel="prefetch" href="/docs/assets/js/262.c80fae29.js"><link rel="prefetch" href="/docs/assets/js/263.3b5d21ed.js"><link rel="prefetch" href="/docs/assets/js/264.688f22de.js"><link rel="prefetch" href="/docs/assets/js/265.cd887654.js"><link rel="prefetch" href="/docs/assets/js/266.3607b374.js"><link rel="prefetch" href="/docs/assets/js/267.b69d1ba3.js"><link rel="prefetch" href="/docs/assets/js/268.9dbe0cd1.js"><link rel="prefetch" href="/docs/assets/js/269.527204df.js"><link rel="prefetch" href="/docs/assets/js/27.67dd7a4f.js"><link rel="prefetch" href="/docs/assets/js/270.46c380d9.js"><link rel="prefetch" href="/docs/assets/js/271.84eabbc9.js"><link rel="prefetch" href="/docs/assets/js/272.3aac95c0.js"><link rel="prefetch" href="/docs/assets/js/273.b03e8b49.js"><link rel="prefetch" href="/docs/assets/js/274.9a284e38.js"><link rel="prefetch" href="/docs/assets/js/275.48c9d81e.js"><link rel="prefetch" href="/docs/assets/js/276.ecc278d5.js"><link rel="prefetch" href="/docs/assets/js/277.11bc0a8b.js"><link rel="prefetch" href="/docs/assets/js/278.38883fac.js"><link rel="prefetch" href="/docs/assets/js/279.2dd72acf.js"><link rel="prefetch" href="/docs/assets/js/28.c55bf7b0.js"><link rel="prefetch" href="/docs/assets/js/280.6db90c32.js"><link rel="prefetch" href="/docs/assets/js/281.272fd123.js"><link rel="prefetch" href="/docs/assets/js/282.2e7f69c9.js"><link rel="prefetch" href="/docs/assets/js/283.7bcb30b6.js"><link rel="prefetch" href="/docs/assets/js/284.fb7798f7.js"><link rel="prefetch" href="/docs/assets/js/285.3b9c011f.js"><link rel="prefetch" href="/docs/assets/js/286.8978bbae.js"><link rel="prefetch" href="/docs/assets/js/287.2ccf0849.js"><link rel="prefetch" href="/docs/assets/js/288.121a6d2f.js"><link rel="prefetch" href="/docs/assets/js/289.0d1e4536.js"><link rel="prefetch" href="/docs/assets/js/29.a30e96d9.js"><link rel="prefetch" href="/docs/assets/js/290.865386e0.js"><link rel="prefetch" href="/docs/assets/js/291.48c917fe.js"><link rel="prefetch" href="/docs/assets/js/292.821e8713.js"><link rel="prefetch" href="/docs/assets/js/293.077f0141.js"><link rel="prefetch" href="/docs/assets/js/294.e5eb280a.js"><link rel="prefetch" href="/docs/assets/js/295.2a823a84.js"><link rel="prefetch" href="/docs/assets/js/296.d1db0071.js"><link rel="prefetch" href="/docs/assets/js/297.19e336f3.js"><link rel="prefetch" href="/docs/assets/js/298.944d0878.js"><link rel="prefetch" href="/docs/assets/js/299.c745be8d.js"><link rel="prefetch" href="/docs/assets/js/3.1568a32f.js"><link rel="prefetch" href="/docs/assets/js/30.83667da9.js"><link rel="prefetch" href="/docs/assets/js/300.13dd4816.js"><link rel="prefetch" href="/docs/assets/js/301.2f4494b6.js"><link rel="prefetch" href="/docs/assets/js/302.1c207c4e.js"><link rel="prefetch" href="/docs/assets/js/303.91c0fc53.js"><link rel="prefetch" href="/docs/assets/js/304.3e4a8d34.js"><link rel="prefetch" href="/docs/assets/js/305.727c8133.js"><link rel="prefetch" href="/docs/assets/js/306.ececb6be.js"><link rel="prefetch" href="/docs/assets/js/307.c7f91360.js"><link rel="prefetch" href="/docs/assets/js/308.b7e53617.js"><link rel="prefetch" href="/docs/assets/js/309.9d7600b3.js"><link rel="prefetch" href="/docs/assets/js/31.ddefb20d.js"><link rel="prefetch" href="/docs/assets/js/310.174ef0aa.js"><link rel="prefetch" href="/docs/assets/js/311.b125f67e.js"><link rel="prefetch" href="/docs/assets/js/312.aecd6b51.js"><link rel="prefetch" href="/docs/assets/js/313.0cc1236f.js"><link rel="prefetch" href="/docs/assets/js/314.82fb8504.js"><link rel="prefetch" href="/docs/assets/js/315.43facff7.js"><link rel="prefetch" href="/docs/assets/js/316.bd15deb5.js"><link rel="prefetch" href="/docs/assets/js/317.613fd5a3.js"><link rel="prefetch" href="/docs/assets/js/318.85a18baa.js"><link rel="prefetch" href="/docs/assets/js/319.fa7aa1c9.js"><link rel="prefetch" href="/docs/assets/js/32.2bdd0c2a.js"><link rel="prefetch" href="/docs/assets/js/320.8d31f6ce.js"><link rel="prefetch" href="/docs/assets/js/321.235589a4.js"><link rel="prefetch" href="/docs/assets/js/322.f0b023e2.js"><link rel="prefetch" href="/docs/assets/js/323.02b5cf1c.js"><link rel="prefetch" href="/docs/assets/js/324.43975957.js"><link rel="prefetch" href="/docs/assets/js/325.0f1fb335.js"><link rel="prefetch" href="/docs/assets/js/326.bff908dc.js"><link rel="prefetch" href="/docs/assets/js/327.f3dc388f.js"><link rel="prefetch" href="/docs/assets/js/328.85b74c7c.js"><link rel="prefetch" href="/docs/assets/js/329.634c6081.js"><link rel="prefetch" href="/docs/assets/js/33.ef1b4ec4.js"><link rel="prefetch" href="/docs/assets/js/330.b70d01db.js"><link rel="prefetch" href="/docs/assets/js/331.a627fd1a.js"><link rel="prefetch" href="/docs/assets/js/332.32cd51f6.js"><link rel="prefetch" href="/docs/assets/js/333.9590fd85.js"><link rel="prefetch" href="/docs/assets/js/334.f11e2f6c.js"><link rel="prefetch" href="/docs/assets/js/335.320c05f4.js"><link rel="prefetch" href="/docs/assets/js/336.919879c2.js"><link rel="prefetch" href="/docs/assets/js/337.098c0178.js"><link rel="prefetch" href="/docs/assets/js/338.8d47980e.js"><link rel="prefetch" href="/docs/assets/js/339.af7df32e.js"><link rel="prefetch" href="/docs/assets/js/34.cc594137.js"><link rel="prefetch" href="/docs/assets/js/340.b40403e2.js"><link rel="prefetch" href="/docs/assets/js/341.27924e48.js"><link rel="prefetch" href="/docs/assets/js/342.6b1ed863.js"><link rel="prefetch" href="/docs/assets/js/343.6c449bf7.js"><link rel="prefetch" href="/docs/assets/js/344.d784b524.js"><link rel="prefetch" href="/docs/assets/js/345.119f37d0.js"><link rel="prefetch" href="/docs/assets/js/346.c21c0e93.js"><link rel="prefetch" href="/docs/assets/js/347.c70c45e3.js"><link rel="prefetch" href="/docs/assets/js/348.9e814b11.js"><link rel="prefetch" href="/docs/assets/js/349.e5590ba6.js"><link rel="prefetch" href="/docs/assets/js/35.4a5b2595.js"><link rel="prefetch" href="/docs/assets/js/350.1ff4a813.js"><link rel="prefetch" href="/docs/assets/js/351.c3151e3d.js"><link rel="prefetch" href="/docs/assets/js/352.c56ef90f.js"><link rel="prefetch" href="/docs/assets/js/353.d4b0b2dc.js"><link rel="prefetch" href="/docs/assets/js/354.43b9b2f3.js"><link rel="prefetch" href="/docs/assets/js/355.28cf46e1.js"><link rel="prefetch" href="/docs/assets/js/356.02480643.js"><link rel="prefetch" href="/docs/assets/js/357.92bd78bb.js"><link rel="prefetch" href="/docs/assets/js/358.78eb51df.js"><link rel="prefetch" href="/docs/assets/js/359.a70f915d.js"><link rel="prefetch" href="/docs/assets/js/36.52c215d2.js"><link rel="prefetch" href="/docs/assets/js/360.5db8b55c.js"><link rel="prefetch" href="/docs/assets/js/361.f7a3627e.js"><link rel="prefetch" href="/docs/assets/js/362.8d16caee.js"><link rel="prefetch" href="/docs/assets/js/363.83c228bc.js"><link rel="prefetch" href="/docs/assets/js/364.13bbf20a.js"><link rel="prefetch" href="/docs/assets/js/365.f718e869.js"><link rel="prefetch" href="/docs/assets/js/366.8ab7c140.js"><link rel="prefetch" href="/docs/assets/js/367.b9179bab.js"><link rel="prefetch" href="/docs/assets/js/368.00397f74.js"><link rel="prefetch" href="/docs/assets/js/369.2e53db79.js"><link rel="prefetch" href="/docs/assets/js/37.d3416b0e.js"><link rel="prefetch" href="/docs/assets/js/370.d2170ce3.js"><link rel="prefetch" href="/docs/assets/js/371.c100c845.js"><link rel="prefetch" href="/docs/assets/js/372.188dd188.js"><link rel="prefetch" href="/docs/assets/js/373.b2777f34.js"><link rel="prefetch" href="/docs/assets/js/374.395969d1.js"><link rel="prefetch" href="/docs/assets/js/375.db014891.js"><link rel="prefetch" href="/docs/assets/js/376.ee761f7a.js"><link rel="prefetch" href="/docs/assets/js/377.6b7204be.js"><link rel="prefetch" href="/docs/assets/js/378.b2a9c6b0.js"><link rel="prefetch" href="/docs/assets/js/379.31c8a65c.js"><link rel="prefetch" href="/docs/assets/js/38.f013117e.js"><link rel="prefetch" href="/docs/assets/js/380.22c1df18.js"><link rel="prefetch" href="/docs/assets/js/381.02fc2a4e.js"><link rel="prefetch" href="/docs/assets/js/382.92fcf2bf.js"><link rel="prefetch" href="/docs/assets/js/383.e1ef43ad.js"><link rel="prefetch" href="/docs/assets/js/384.f78553c3.js"><link rel="prefetch" href="/docs/assets/js/385.7a775f89.js"><link rel="prefetch" href="/docs/assets/js/386.e66e41dd.js"><link rel="prefetch" href="/docs/assets/js/387.2cf72c55.js"><link rel="prefetch" href="/docs/assets/js/388.6ef56db3.js"><link rel="prefetch" href="/docs/assets/js/389.386c1209.js"><link rel="prefetch" href="/docs/assets/js/39.507ded33.js"><link rel="prefetch" href="/docs/assets/js/390.cd49089b.js"><link rel="prefetch" href="/docs/assets/js/391.c967b6a6.js"><link rel="prefetch" href="/docs/assets/js/392.6bd11990.js"><link rel="prefetch" href="/docs/assets/js/393.1cb31fa8.js"><link rel="prefetch" href="/docs/assets/js/394.c1d615d3.js"><link rel="prefetch" href="/docs/assets/js/395.64b55b2c.js"><link rel="prefetch" href="/docs/assets/js/396.3255695c.js"><link rel="prefetch" href="/docs/assets/js/397.d2f8df92.js"><link rel="prefetch" href="/docs/assets/js/398.47f4b9dd.js"><link rel="prefetch" href="/docs/assets/js/399.1e9c6c54.js"><link rel="prefetch" href="/docs/assets/js/4.2c05b10b.js"><link rel="prefetch" href="/docs/assets/js/40.a09c7e32.js"><link rel="prefetch" href="/docs/assets/js/400.911a3bba.js"><link rel="prefetch" href="/docs/assets/js/401.71bd4c8f.js"><link rel="prefetch" href="/docs/assets/js/402.56573c8c.js"><link rel="prefetch" href="/docs/assets/js/403.3e8d5855.js"><link rel="prefetch" href="/docs/assets/js/404.a5e3bdca.js"><link rel="prefetch" href="/docs/assets/js/405.f969ec60.js"><link rel="prefetch" href="/docs/assets/js/406.7402cbc1.js"><link rel="prefetch" href="/docs/assets/js/407.ca81491e.js"><link rel="prefetch" href="/docs/assets/js/408.bcb4c908.js"><link rel="prefetch" href="/docs/assets/js/409.085fb47e.js"><link rel="prefetch" href="/docs/assets/js/41.e262c14a.js"><link rel="prefetch" href="/docs/assets/js/410.f1d37beb.js"><link rel="prefetch" href="/docs/assets/js/411.80b60096.js"><link rel="prefetch" href="/docs/assets/js/412.6a30ecd7.js"><link rel="prefetch" href="/docs/assets/js/413.3ee5d371.js"><link rel="prefetch" href="/docs/assets/js/414.ca59c53a.js"><link rel="prefetch" href="/docs/assets/js/415.82616ce5.js"><link rel="prefetch" href="/docs/assets/js/416.569c1979.js"><link rel="prefetch" href="/docs/assets/js/417.621d01ee.js"><link rel="prefetch" href="/docs/assets/js/418.da57dcae.js"><link rel="prefetch" href="/docs/assets/js/419.a2d423ca.js"><link rel="prefetch" href="/docs/assets/js/42.b6b6e2d3.js"><link rel="prefetch" href="/docs/assets/js/420.2c2178ae.js"><link rel="prefetch" href="/docs/assets/js/421.e70b5b1f.js"><link rel="prefetch" href="/docs/assets/js/422.6f35655b.js"><link rel="prefetch" href="/docs/assets/js/423.2f0cea18.js"><link rel="prefetch" href="/docs/assets/js/424.128e7163.js"><link rel="prefetch" href="/docs/assets/js/425.861d4dfe.js"><link rel="prefetch" href="/docs/assets/js/426.9aea92a0.js"><link rel="prefetch" href="/docs/assets/js/427.af581d15.js"><link rel="prefetch" href="/docs/assets/js/428.a218ea46.js"><link rel="prefetch" href="/docs/assets/js/429.065b5ac1.js"><link rel="prefetch" href="/docs/assets/js/43.63957427.js"><link rel="prefetch" href="/docs/assets/js/430.e767f1f4.js"><link rel="prefetch" href="/docs/assets/js/431.540150d6.js"><link rel="prefetch" href="/docs/assets/js/432.a1ddbbd1.js"><link rel="prefetch" href="/docs/assets/js/433.c7f7981f.js"><link rel="prefetch" href="/docs/assets/js/434.cffb48e9.js"><link rel="prefetch" href="/docs/assets/js/435.491baaf0.js"><link rel="prefetch" href="/docs/assets/js/436.0d652c26.js"><link rel="prefetch" href="/docs/assets/js/437.5bfcab8f.js"><link rel="prefetch" href="/docs/assets/js/438.68d2335b.js"><link rel="prefetch" href="/docs/assets/js/439.c6297ce6.js"><link rel="prefetch" href="/docs/assets/js/44.d8d04da9.js"><link rel="prefetch" href="/docs/assets/js/440.f33b43c5.js"><link rel="prefetch" href="/docs/assets/js/441.94af4046.js"><link rel="prefetch" href="/docs/assets/js/442.1d1cfe2e.js"><link rel="prefetch" href="/docs/assets/js/443.3a9f8a23.js"><link rel="prefetch" href="/docs/assets/js/444.36ca831d.js"><link rel="prefetch" href="/docs/assets/js/445.91622551.js"><link rel="prefetch" href="/docs/assets/js/446.45c815f0.js"><link rel="prefetch" href="/docs/assets/js/447.5d417e2d.js"><link rel="prefetch" href="/docs/assets/js/448.42abd591.js"><link rel="prefetch" href="/docs/assets/js/449.6c21256c.js"><link rel="prefetch" href="/docs/assets/js/45.49c1a866.js"><link rel="prefetch" href="/docs/assets/js/450.b9b1a490.js"><link rel="prefetch" href="/docs/assets/js/451.35fa3d3e.js"><link rel="prefetch" href="/docs/assets/js/452.513b0cce.js"><link rel="prefetch" href="/docs/assets/js/453.2792e570.js"><link rel="prefetch" href="/docs/assets/js/454.987f083a.js"><link rel="prefetch" href="/docs/assets/js/455.122cc5e2.js"><link rel="prefetch" href="/docs/assets/js/456.1dda02bd.js"><link rel="prefetch" href="/docs/assets/js/457.4beb203a.js"><link rel="prefetch" href="/docs/assets/js/458.ab405ce8.js"><link rel="prefetch" href="/docs/assets/js/459.ad2f065a.js"><link rel="prefetch" href="/docs/assets/js/46.be09a393.js"><link rel="prefetch" href="/docs/assets/js/460.89954fa3.js"><link rel="prefetch" href="/docs/assets/js/461.7018216b.js"><link rel="prefetch" href="/docs/assets/js/462.4d4ad00b.js"><link rel="prefetch" href="/docs/assets/js/463.baad8239.js"><link rel="prefetch" href="/docs/assets/js/464.190f3c23.js"><link rel="prefetch" href="/docs/assets/js/465.5c953a3e.js"><link rel="prefetch" href="/docs/assets/js/466.ad70fe73.js"><link rel="prefetch" href="/docs/assets/js/467.67bfc834.js"><link rel="prefetch" href="/docs/assets/js/468.f19aa8aa.js"><link rel="prefetch" href="/docs/assets/js/469.7cc42528.js"><link rel="prefetch" href="/docs/assets/js/47.f26d6bb6.js"><link rel="prefetch" href="/docs/assets/js/470.c0d409f2.js"><link rel="prefetch" href="/docs/assets/js/471.b84e0ea4.js"><link rel="prefetch" href="/docs/assets/js/472.6b8b1d7f.js"><link rel="prefetch" href="/docs/assets/js/473.f93754fe.js"><link rel="prefetch" href="/docs/assets/js/474.cd934b70.js"><link rel="prefetch" href="/docs/assets/js/475.792f8b22.js"><link rel="prefetch" href="/docs/assets/js/476.c1c92b32.js"><link rel="prefetch" href="/docs/assets/js/477.f5a9a42c.js"><link rel="prefetch" href="/docs/assets/js/478.1ab0b4d7.js"><link rel="prefetch" href="/docs/assets/js/479.5452fc68.js"><link rel="prefetch" href="/docs/assets/js/48.f384117a.js"><link rel="prefetch" href="/docs/assets/js/480.261723ff.js"><link rel="prefetch" href="/docs/assets/js/481.69c308bf.js"><link rel="prefetch" href="/docs/assets/js/482.2f954883.js"><link rel="prefetch" href="/docs/assets/js/483.bd6d2964.js"><link rel="prefetch" href="/docs/assets/js/484.8747dd46.js"><link rel="prefetch" href="/docs/assets/js/485.259a2a6b.js"><link rel="prefetch" href="/docs/assets/js/486.0f986781.js"><link rel="prefetch" href="/docs/assets/js/487.fe5e34fe.js"><link rel="prefetch" href="/docs/assets/js/488.f51c09c4.js"><link rel="prefetch" href="/docs/assets/js/489.c57b330a.js"><link rel="prefetch" href="/docs/assets/js/49.68d8968b.js"><link rel="prefetch" href="/docs/assets/js/490.813ea9fd.js"><link rel="prefetch" href="/docs/assets/js/491.630a22a2.js"><link rel="prefetch" href="/docs/assets/js/492.b97cc3da.js"><link rel="prefetch" href="/docs/assets/js/493.39c0cb23.js"><link rel="prefetch" href="/docs/assets/js/494.8274d531.js"><link rel="prefetch" href="/docs/assets/js/495.426dfbf4.js"><link rel="prefetch" href="/docs/assets/js/496.37b2211b.js"><link rel="prefetch" href="/docs/assets/js/497.1be9f612.js"><link rel="prefetch" href="/docs/assets/js/498.c3062f23.js"><link rel="prefetch" href="/docs/assets/js/499.4b3687d9.js"><link rel="prefetch" href="/docs/assets/js/5.7e332b2d.js"><link rel="prefetch" href="/docs/assets/js/50.64eac5e7.js"><link rel="prefetch" href="/docs/assets/js/500.f9ff19bc.js"><link rel="prefetch" href="/docs/assets/js/501.f65b2840.js"><link rel="prefetch" href="/docs/assets/js/502.60c23683.js"><link rel="prefetch" href="/docs/assets/js/503.e3eac5e5.js"><link rel="prefetch" href="/docs/assets/js/504.ab971aae.js"><link rel="prefetch" href="/docs/assets/js/505.c8129b89.js"><link rel="prefetch" href="/docs/assets/js/506.f772fc40.js"><link rel="prefetch" href="/docs/assets/js/507.f70951cf.js"><link rel="prefetch" href="/docs/assets/js/508.25cc8be9.js"><link rel="prefetch" href="/docs/assets/js/509.65dfbf21.js"><link rel="prefetch" href="/docs/assets/js/51.01f3110a.js"><link rel="prefetch" href="/docs/assets/js/510.ac159aa9.js"><link rel="prefetch" href="/docs/assets/js/511.3c411759.js"><link rel="prefetch" href="/docs/assets/js/512.2d4a937f.js"><link rel="prefetch" href="/docs/assets/js/513.717f6b15.js"><link rel="prefetch" href="/docs/assets/js/514.20fea45c.js"><link rel="prefetch" href="/docs/assets/js/515.36261571.js"><link rel="prefetch" href="/docs/assets/js/516.03f6f640.js"><link rel="prefetch" href="/docs/assets/js/517.d28e06bf.js"><link rel="prefetch" href="/docs/assets/js/518.211ac5b3.js"><link rel="prefetch" href="/docs/assets/js/519.e0576033.js"><link rel="prefetch" href="/docs/assets/js/52.78391078.js"><link rel="prefetch" href="/docs/assets/js/520.dfd2104a.js"><link rel="prefetch" href="/docs/assets/js/521.c0c195b8.js"><link rel="prefetch" href="/docs/assets/js/522.c70b23ea.js"><link rel="prefetch" href="/docs/assets/js/523.2e32d373.js"><link rel="prefetch" href="/docs/assets/js/524.dc30f013.js"><link rel="prefetch" href="/docs/assets/js/525.c7e74848.js"><link rel="prefetch" href="/docs/assets/js/526.2aa4467e.js"><link rel="prefetch" href="/docs/assets/js/527.d4865c4a.js"><link rel="prefetch" href="/docs/assets/js/528.87ef62a6.js"><link rel="prefetch" href="/docs/assets/js/529.e8adf60e.js"><link rel="prefetch" href="/docs/assets/js/53.ba4442c1.js"><link rel="prefetch" href="/docs/assets/js/530.8155d09c.js"><link rel="prefetch" href="/docs/assets/js/531.ef9f8a62.js"><link rel="prefetch" href="/docs/assets/js/532.e2d63979.js"><link rel="prefetch" href="/docs/assets/js/533.52be2a10.js"><link rel="prefetch" href="/docs/assets/js/534.1632b8ff.js"><link rel="prefetch" href="/docs/assets/js/535.1a22682f.js"><link rel="prefetch" href="/docs/assets/js/536.317add4c.js"><link rel="prefetch" href="/docs/assets/js/537.a9876966.js"><link rel="prefetch" href="/docs/assets/js/538.47ef8244.js"><link rel="prefetch" href="/docs/assets/js/539.c85fd8d8.js"><link rel="prefetch" href="/docs/assets/js/54.3b5666f4.js"><link rel="prefetch" href="/docs/assets/js/540.989842fa.js"><link rel="prefetch" href="/docs/assets/js/541.41f03fe7.js"><link rel="prefetch" href="/docs/assets/js/542.89e2be8c.js"><link rel="prefetch" href="/docs/assets/js/543.a3ad7d54.js"><link rel="prefetch" href="/docs/assets/js/544.26df925d.js"><link rel="prefetch" href="/docs/assets/js/545.3f06eefc.js"><link rel="prefetch" href="/docs/assets/js/546.c2697d2c.js"><link rel="prefetch" href="/docs/assets/js/547.403732e3.js"><link rel="prefetch" href="/docs/assets/js/548.8fdc36d8.js"><link rel="prefetch" href="/docs/assets/js/549.f535039f.js"><link rel="prefetch" href="/docs/assets/js/55.c70259cd.js"><link rel="prefetch" href="/docs/assets/js/550.44dca448.js"><link rel="prefetch" href="/docs/assets/js/551.09698fe6.js"><link rel="prefetch" href="/docs/assets/js/552.b87d8bdb.js"><link rel="prefetch" href="/docs/assets/js/553.18df4e68.js"><link rel="prefetch" href="/docs/assets/js/554.4b4d8ff0.js"><link rel="prefetch" href="/docs/assets/js/555.aebbab34.js"><link rel="prefetch" href="/docs/assets/js/556.08111e0a.js"><link rel="prefetch" href="/docs/assets/js/557.71f09c80.js"><link rel="prefetch" href="/docs/assets/js/558.10d550f5.js"><link rel="prefetch" href="/docs/assets/js/559.a242b5ac.js"><link rel="prefetch" href="/docs/assets/js/56.7bceb0cd.js"><link rel="prefetch" href="/docs/assets/js/560.89b5bb73.js"><link rel="prefetch" href="/docs/assets/js/561.c3cc7a4c.js"><link rel="prefetch" href="/docs/assets/js/562.d26a674b.js"><link rel="prefetch" href="/docs/assets/js/563.c87833fe.js"><link rel="prefetch" href="/docs/assets/js/564.e3e494f0.js"><link rel="prefetch" href="/docs/assets/js/565.b15376ae.js"><link rel="prefetch" href="/docs/assets/js/566.33572c2d.js"><link rel="prefetch" href="/docs/assets/js/567.21a9191c.js"><link rel="prefetch" href="/docs/assets/js/568.e118c126.js"><link rel="prefetch" href="/docs/assets/js/569.cf6762c5.js"><link rel="prefetch" href="/docs/assets/js/57.d970a53c.js"><link rel="prefetch" href="/docs/assets/js/570.9092596b.js"><link rel="prefetch" href="/docs/assets/js/571.f6f98009.js"><link rel="prefetch" href="/docs/assets/js/572.efe936bf.js"><link rel="prefetch" href="/docs/assets/js/573.7663f0f2.js"><link rel="prefetch" href="/docs/assets/js/574.69422327.js"><link rel="prefetch" href="/docs/assets/js/575.21edf531.js"><link rel="prefetch" href="/docs/assets/js/576.f889bc97.js"><link rel="prefetch" href="/docs/assets/js/577.05c97749.js"><link rel="prefetch" href="/docs/assets/js/578.3ddeb9b7.js"><link rel="prefetch" href="/docs/assets/js/579.30ab9a6f.js"><link rel="prefetch" href="/docs/assets/js/58.cdace39d.js"><link rel="prefetch" href="/docs/assets/js/580.5ee1443b.js"><link rel="prefetch" href="/docs/assets/js/581.57b2e5bc.js"><link rel="prefetch" href="/docs/assets/js/582.017b54dd.js"><link rel="prefetch" href="/docs/assets/js/583.b9b9cce9.js"><link rel="prefetch" href="/docs/assets/js/584.bc5ea254.js"><link rel="prefetch" href="/docs/assets/js/585.4d2659b8.js"><link rel="prefetch" href="/docs/assets/js/586.b384e0a0.js"><link rel="prefetch" href="/docs/assets/js/587.e1a93ba2.js"><link rel="prefetch" href="/docs/assets/js/588.2b967457.js"><link rel="prefetch" href="/docs/assets/js/589.53f5d127.js"><link rel="prefetch" href="/docs/assets/js/59.995216a6.js"><link rel="prefetch" href="/docs/assets/js/590.49173e30.js"><link rel="prefetch" href="/docs/assets/js/591.043f1145.js"><link rel="prefetch" href="/docs/assets/js/592.d5dc2ec0.js"><link rel="prefetch" href="/docs/assets/js/593.7e5c8e4a.js"><link rel="prefetch" href="/docs/assets/js/594.b4595395.js"><link rel="prefetch" href="/docs/assets/js/595.be9bef9f.js"><link rel="prefetch" href="/docs/assets/js/596.1e4a4520.js"><link rel="prefetch" href="/docs/assets/js/597.d9c69d5c.js"><link rel="prefetch" href="/docs/assets/js/598.2fbe0fbd.js"><link rel="prefetch" href="/docs/assets/js/599.8376ff1a.js"><link rel="prefetch" href="/docs/assets/js/6.eedf5cbf.js"><link rel="prefetch" href="/docs/assets/js/60.0047f859.js"><link rel="prefetch" href="/docs/assets/js/600.82185e66.js"><link rel="prefetch" href="/docs/assets/js/601.f0e1f279.js"><link rel="prefetch" href="/docs/assets/js/602.38d0e9c6.js"><link rel="prefetch" href="/docs/assets/js/603.7b69bbf9.js"><link rel="prefetch" href="/docs/assets/js/604.e2b4b86b.js"><link rel="prefetch" href="/docs/assets/js/605.40bb113c.js"><link rel="prefetch" href="/docs/assets/js/606.5bf5d2be.js"><link rel="prefetch" href="/docs/assets/js/607.27f38a78.js"><link rel="prefetch" href="/docs/assets/js/608.4c061219.js"><link rel="prefetch" href="/docs/assets/js/609.06809f4f.js"><link rel="prefetch" href="/docs/assets/js/61.2862fb6a.js"><link rel="prefetch" href="/docs/assets/js/610.acde6577.js"><link rel="prefetch" href="/docs/assets/js/611.23c4975a.js"><link rel="prefetch" href="/docs/assets/js/612.60f730f4.js"><link rel="prefetch" href="/docs/assets/js/613.9d1b7929.js"><link rel="prefetch" href="/docs/assets/js/614.559beacf.js"><link rel="prefetch" href="/docs/assets/js/615.1f9be7be.js"><link rel="prefetch" href="/docs/assets/js/616.eedac43e.js"><link rel="prefetch" href="/docs/assets/js/617.2ed2bcb2.js"><link rel="prefetch" href="/docs/assets/js/618.f425c18f.js"><link rel="prefetch" href="/docs/assets/js/619.3cb0569a.js"><link rel="prefetch" href="/docs/assets/js/62.9ef63b76.js"><link rel="prefetch" href="/docs/assets/js/620.f744636e.js"><link rel="prefetch" href="/docs/assets/js/621.8c6656a1.js"><link rel="prefetch" href="/docs/assets/js/622.685e3c9f.js"><link rel="prefetch" href="/docs/assets/js/623.a11c9e23.js"><link rel="prefetch" href="/docs/assets/js/624.52f36d48.js"><link rel="prefetch" href="/docs/assets/js/625.d3fb4805.js"><link rel="prefetch" href="/docs/assets/js/626.11e73330.js"><link rel="prefetch" href="/docs/assets/js/627.43d6477c.js"><link rel="prefetch" href="/docs/assets/js/628.c187b568.js"><link rel="prefetch" href="/docs/assets/js/629.0126df5c.js"><link rel="prefetch" href="/docs/assets/js/63.fbbf15ab.js"><link rel="prefetch" href="/docs/assets/js/630.db329275.js"><link rel="prefetch" href="/docs/assets/js/631.09cf74e9.js"><link rel="prefetch" href="/docs/assets/js/632.21b85ace.js"><link rel="prefetch" href="/docs/assets/js/633.9eeeec5d.js"><link rel="prefetch" href="/docs/assets/js/634.96af7409.js"><link rel="prefetch" href="/docs/assets/js/635.242baa30.js"><link rel="prefetch" href="/docs/assets/js/636.a80304b3.js"><link rel="prefetch" href="/docs/assets/js/637.3679d316.js"><link rel="prefetch" href="/docs/assets/js/638.bcdb8fac.js"><link rel="prefetch" href="/docs/assets/js/639.cc50ef8b.js"><link rel="prefetch" href="/docs/assets/js/64.8e274e7a.js"><link rel="prefetch" href="/docs/assets/js/640.06de7ca9.js"><link rel="prefetch" href="/docs/assets/js/641.bffa4bdc.js"><link rel="prefetch" href="/docs/assets/js/642.00162379.js"><link rel="prefetch" href="/docs/assets/js/643.92d66e56.js"><link rel="prefetch" href="/docs/assets/js/644.4e84bee2.js"><link rel="prefetch" href="/docs/assets/js/645.7c42c9b3.js"><link rel="prefetch" href="/docs/assets/js/646.7add21ea.js"><link rel="prefetch" href="/docs/assets/js/647.ff6c2981.js"><link rel="prefetch" href="/docs/assets/js/648.56a31c9c.js"><link rel="prefetch" href="/docs/assets/js/649.38e92cff.js"><link rel="prefetch" href="/docs/assets/js/65.d0b04ff8.js"><link rel="prefetch" href="/docs/assets/js/650.8375ae86.js"><link rel="prefetch" href="/docs/assets/js/651.5202b8b3.js"><link rel="prefetch" href="/docs/assets/js/652.0fe60d34.js"><link rel="prefetch" href="/docs/assets/js/653.ccb8a7fc.js"><link rel="prefetch" href="/docs/assets/js/654.f425ed00.js"><link rel="prefetch" href="/docs/assets/js/655.c33d409c.js"><link rel="prefetch" href="/docs/assets/js/656.9205e833.js"><link rel="prefetch" href="/docs/assets/js/657.0ca496ee.js"><link rel="prefetch" href="/docs/assets/js/658.27a73bfd.js"><link rel="prefetch" href="/docs/assets/js/659.54059cc6.js"><link rel="prefetch" href="/docs/assets/js/66.625eb510.js"><link rel="prefetch" href="/docs/assets/js/660.f147b1eb.js"><link rel="prefetch" href="/docs/assets/js/661.ec2e96c6.js"><link rel="prefetch" href="/docs/assets/js/662.43457746.js"><link rel="prefetch" href="/docs/assets/js/663.f41b3c2b.js"><link rel="prefetch" href="/docs/assets/js/664.3a394909.js"><link rel="prefetch" href="/docs/assets/js/665.4150abc4.js"><link rel="prefetch" href="/docs/assets/js/666.901f75af.js"><link rel="prefetch" href="/docs/assets/js/667.4fbcd769.js"><link rel="prefetch" href="/docs/assets/js/668.a7cbba5c.js"><link rel="prefetch" href="/docs/assets/js/669.bc5ba701.js"><link rel="prefetch" href="/docs/assets/js/67.d38e8cd3.js"><link rel="prefetch" href="/docs/assets/js/670.15121176.js"><link rel="prefetch" href="/docs/assets/js/671.3f73f40d.js"><link rel="prefetch" href="/docs/assets/js/672.564f3bb0.js"><link rel="prefetch" href="/docs/assets/js/673.0ae7eaf4.js"><link rel="prefetch" href="/docs/assets/js/674.fb3029ee.js"><link rel="prefetch" href="/docs/assets/js/675.42685a5a.js"><link rel="prefetch" href="/docs/assets/js/676.5abd26c5.js"><link rel="prefetch" href="/docs/assets/js/677.3fe1755c.js"><link rel="prefetch" href="/docs/assets/js/678.1650dbb6.js"><link rel="prefetch" href="/docs/assets/js/679.7babb708.js"><link rel="prefetch" href="/docs/assets/js/68.d401e2c4.js"><link rel="prefetch" href="/docs/assets/js/680.46b95bcf.js"><link rel="prefetch" href="/docs/assets/js/681.d770d29a.js"><link rel="prefetch" href="/docs/assets/js/682.d5171f01.js"><link rel="prefetch" href="/docs/assets/js/683.797145d8.js"><link rel="prefetch" href="/docs/assets/js/684.2a7193f2.js"><link rel="prefetch" href="/docs/assets/js/685.f64c5026.js"><link rel="prefetch" href="/docs/assets/js/686.16cbbadb.js"><link rel="prefetch" href="/docs/assets/js/687.0adcbabb.js"><link rel="prefetch" href="/docs/assets/js/688.b0136fbe.js"><link rel="prefetch" href="/docs/assets/js/689.f2dcc4d1.js"><link rel="prefetch" href="/docs/assets/js/69.270c7ff8.js"><link rel="prefetch" href="/docs/assets/js/690.fdb7a815.js"><link rel="prefetch" href="/docs/assets/js/691.b8e911c0.js"><link rel="prefetch" href="/docs/assets/js/692.92afbc12.js"><link rel="prefetch" href="/docs/assets/js/693.ff405580.js"><link rel="prefetch" href="/docs/assets/js/694.53fdf7c5.js"><link rel="prefetch" href="/docs/assets/js/695.0a3d15a8.js"><link rel="prefetch" href="/docs/assets/js/696.581418ac.js"><link rel="prefetch" href="/docs/assets/js/697.04895a58.js"><link rel="prefetch" href="/docs/assets/js/698.70e4d954.js"><link rel="prefetch" href="/docs/assets/js/699.b3576e9e.js"><link rel="prefetch" href="/docs/assets/js/7.69699b46.js"><link rel="prefetch" href="/docs/assets/js/70.8802986c.js"><link rel="prefetch" href="/docs/assets/js/700.40eedc90.js"><link rel="prefetch" href="/docs/assets/js/701.711a24c4.js"><link rel="prefetch" href="/docs/assets/js/702.f64689a3.js"><link rel="prefetch" href="/docs/assets/js/703.55c3857c.js"><link rel="prefetch" href="/docs/assets/js/704.ec3ffff5.js"><link rel="prefetch" href="/docs/assets/js/705.3c015979.js"><link rel="prefetch" href="/docs/assets/js/706.93359feb.js"><link rel="prefetch" href="/docs/assets/js/707.3a5d8ab1.js"><link rel="prefetch" href="/docs/assets/js/708.140b3b9f.js"><link rel="prefetch" href="/docs/assets/js/709.65ff829f.js"><link rel="prefetch" href="/docs/assets/js/71.86283f6b.js"><link rel="prefetch" href="/docs/assets/js/710.ea492f6c.js"><link rel="prefetch" href="/docs/assets/js/711.190b2e31.js"><link rel="prefetch" href="/docs/assets/js/712.c84633f7.js"><link rel="prefetch" href="/docs/assets/js/713.3a581fed.js"><link rel="prefetch" href="/docs/assets/js/714.2f11bd17.js"><link rel="prefetch" href="/docs/assets/js/715.875cff3d.js"><link rel="prefetch" href="/docs/assets/js/716.d0949dfd.js"><link rel="prefetch" href="/docs/assets/js/717.f1449650.js"><link rel="prefetch" href="/docs/assets/js/718.943a841a.js"><link rel="prefetch" href="/docs/assets/js/719.f17feed2.js"><link rel="prefetch" href="/docs/assets/js/72.f5731a1e.js"><link rel="prefetch" href="/docs/assets/js/720.6d39135e.js"><link rel="prefetch" href="/docs/assets/js/721.e45d6d53.js"><link rel="prefetch" href="/docs/assets/js/722.a06e5300.js"><link rel="prefetch" href="/docs/assets/js/723.0b0a8a28.js"><link rel="prefetch" href="/docs/assets/js/724.00efa468.js"><link rel="prefetch" href="/docs/assets/js/725.f5d426df.js"><link rel="prefetch" href="/docs/assets/js/726.9a505a77.js"><link rel="prefetch" href="/docs/assets/js/727.2d7b1cf8.js"><link rel="prefetch" href="/docs/assets/js/728.03bd3983.js"><link rel="prefetch" href="/docs/assets/js/729.1449d1b1.js"><link rel="prefetch" href="/docs/assets/js/73.5fbf43d0.js"><link rel="prefetch" href="/docs/assets/js/730.78a73426.js"><link rel="prefetch" href="/docs/assets/js/731.7782dd14.js"><link rel="prefetch" href="/docs/assets/js/732.c07e31e2.js"><link rel="prefetch" href="/docs/assets/js/733.5260b376.js"><link rel="prefetch" href="/docs/assets/js/734.e97adfef.js"><link rel="prefetch" href="/docs/assets/js/735.4d160b58.js"><link rel="prefetch" href="/docs/assets/js/736.84ee3892.js"><link rel="prefetch" href="/docs/assets/js/737.a5bda87f.js"><link rel="prefetch" href="/docs/assets/js/738.576329ef.js"><link rel="prefetch" href="/docs/assets/js/739.da891839.js"><link rel="prefetch" href="/docs/assets/js/74.17d19004.js"><link rel="prefetch" href="/docs/assets/js/740.caa1c5ea.js"><link rel="prefetch" href="/docs/assets/js/741.f0045c10.js"><link rel="prefetch" href="/docs/assets/js/742.d8e9ce9e.js"><link rel="prefetch" href="/docs/assets/js/743.300c7fda.js"><link rel="prefetch" href="/docs/assets/js/744.273140e6.js"><link rel="prefetch" href="/docs/assets/js/745.7024e286.js"><link rel="prefetch" href="/docs/assets/js/746.e9337443.js"><link rel="prefetch" href="/docs/assets/js/747.feba5d9c.js"><link rel="prefetch" href="/docs/assets/js/748.32a76b49.js"><link rel="prefetch" href="/docs/assets/js/749.b409d96d.js"><link rel="prefetch" href="/docs/assets/js/75.e31c5664.js"><link rel="prefetch" href="/docs/assets/js/750.d8454ae2.js"><link rel="prefetch" href="/docs/assets/js/751.14613305.js"><link rel="prefetch" href="/docs/assets/js/752.a16566a5.js"><link rel="prefetch" href="/docs/assets/js/753.e974a53c.js"><link rel="prefetch" href="/docs/assets/js/754.7194a972.js"><link rel="prefetch" href="/docs/assets/js/755.9ec7b833.js"><link rel="prefetch" href="/docs/assets/js/756.50f5b75c.js"><link rel="prefetch" href="/docs/assets/js/757.423f4628.js"><link rel="prefetch" href="/docs/assets/js/758.41daf4af.js"><link rel="prefetch" href="/docs/assets/js/759.50d726bc.js"><link rel="prefetch" href="/docs/assets/js/76.a6d2d020.js"><link rel="prefetch" href="/docs/assets/js/760.a3cbe13c.js"><link rel="prefetch" href="/docs/assets/js/761.845cb4df.js"><link rel="prefetch" href="/docs/assets/js/762.e429fc39.js"><link rel="prefetch" href="/docs/assets/js/763.228d5e64.js"><link rel="prefetch" href="/docs/assets/js/764.9e9450c9.js"><link rel="prefetch" href="/docs/assets/js/765.a6b0cf34.js"><link rel="prefetch" href="/docs/assets/js/766.dd40bcc6.js"><link rel="prefetch" href="/docs/assets/js/767.1827c029.js"><link rel="prefetch" href="/docs/assets/js/768.bc7f549d.js"><link rel="prefetch" href="/docs/assets/js/769.c37c9184.js"><link rel="prefetch" href="/docs/assets/js/77.2c84b5e7.js"><link rel="prefetch" href="/docs/assets/js/770.120427ac.js"><link rel="prefetch" href="/docs/assets/js/771.28cf4d9c.js"><link rel="prefetch" href="/docs/assets/js/772.1c2567f9.js"><link rel="prefetch" href="/docs/assets/js/773.2de14a63.js"><link rel="prefetch" href="/docs/assets/js/774.3f2d1a5c.js"><link rel="prefetch" href="/docs/assets/js/775.c2eee57b.js"><link rel="prefetch" href="/docs/assets/js/776.ce01a240.js"><link rel="prefetch" href="/docs/assets/js/777.e43ff443.js"><link rel="prefetch" href="/docs/assets/js/778.dbdabeda.js"><link rel="prefetch" href="/docs/assets/js/779.84ca9a40.js"><link rel="prefetch" href="/docs/assets/js/78.de150a39.js"><link rel="prefetch" href="/docs/assets/js/780.7d4ea451.js"><link rel="prefetch" href="/docs/assets/js/781.2ef05752.js"><link rel="prefetch" href="/docs/assets/js/782.f8d1af06.js"><link rel="prefetch" href="/docs/assets/js/783.61f5d695.js"><link rel="prefetch" href="/docs/assets/js/784.68643b3f.js"><link rel="prefetch" href="/docs/assets/js/785.0eeb40fc.js"><link rel="prefetch" href="/docs/assets/js/786.46929670.js"><link rel="prefetch" href="/docs/assets/js/787.27aea701.js"><link rel="prefetch" href="/docs/assets/js/788.8734555f.js"><link rel="prefetch" href="/docs/assets/js/789.a56056e7.js"><link rel="prefetch" href="/docs/assets/js/79.0b0c8741.js"><link rel="prefetch" href="/docs/assets/js/790.8cf272c1.js"><link rel="prefetch" href="/docs/assets/js/791.d5232aff.js"><link rel="prefetch" href="/docs/assets/js/792.cc9262da.js"><link rel="prefetch" href="/docs/assets/js/793.cb4a9271.js"><link rel="prefetch" href="/docs/assets/js/794.8c086163.js"><link rel="prefetch" href="/docs/assets/js/795.8b0ec904.js"><link rel="prefetch" href="/docs/assets/js/796.e761d6c6.js"><link rel="prefetch" href="/docs/assets/js/797.3ba2d149.js"><link rel="prefetch" href="/docs/assets/js/798.ff6f48e1.js"><link rel="prefetch" href="/docs/assets/js/799.b62e9085.js"><link rel="prefetch" href="/docs/assets/js/8.dfcc4cab.js"><link rel="prefetch" href="/docs/assets/js/80.2380eda8.js"><link rel="prefetch" href="/docs/assets/js/800.c971d246.js"><link rel="prefetch" href="/docs/assets/js/801.fba40151.js"><link rel="prefetch" href="/docs/assets/js/802.2156ce08.js"><link rel="prefetch" href="/docs/assets/js/803.c72e03ad.js"><link rel="prefetch" href="/docs/assets/js/804.ab14c057.js"><link rel="prefetch" href="/docs/assets/js/805.73d81c62.js"><link rel="prefetch" href="/docs/assets/js/806.a692ad02.js"><link rel="prefetch" href="/docs/assets/js/807.0c33e152.js"><link rel="prefetch" href="/docs/assets/js/808.b6a97586.js"><link rel="prefetch" href="/docs/assets/js/809.2c3637d7.js"><link rel="prefetch" href="/docs/assets/js/81.b4bc4383.js"><link rel="prefetch" href="/docs/assets/js/810.5766dcdd.js"><link rel="prefetch" href="/docs/assets/js/811.2893da77.js"><link rel="prefetch" href="/docs/assets/js/812.c63730fb.js"><link rel="prefetch" href="/docs/assets/js/813.a610df43.js"><link rel="prefetch" href="/docs/assets/js/814.dbf6628f.js"><link rel="prefetch" href="/docs/assets/js/815.abcef43d.js"><link rel="prefetch" href="/docs/assets/js/816.e842428d.js"><link rel="prefetch" href="/docs/assets/js/817.95dd19de.js"><link rel="prefetch" href="/docs/assets/js/818.a1efc42c.js"><link rel="prefetch" href="/docs/assets/js/819.05ff670b.js"><link rel="prefetch" href="/docs/assets/js/82.e7930bc4.js"><link rel="prefetch" href="/docs/assets/js/820.32cb4e92.js"><link rel="prefetch" href="/docs/assets/js/821.df9233bb.js"><link rel="prefetch" href="/docs/assets/js/822.aa4205df.js"><link rel="prefetch" href="/docs/assets/js/823.277fde07.js"><link rel="prefetch" href="/docs/assets/js/824.2b949a80.js"><link rel="prefetch" href="/docs/assets/js/825.9d33d9c0.js"><link rel="prefetch" href="/docs/assets/js/826.e8c8f61f.js"><link rel="prefetch" href="/docs/assets/js/827.3ef34c1e.js"><link rel="prefetch" href="/docs/assets/js/828.ddc3ac0b.js"><link rel="prefetch" href="/docs/assets/js/829.a6cdb412.js"><link rel="prefetch" href="/docs/assets/js/83.fc7e126a.js"><link rel="prefetch" href="/docs/assets/js/830.4ea95ba7.js"><link rel="prefetch" href="/docs/assets/js/831.ae0440b5.js"><link rel="prefetch" href="/docs/assets/js/832.17b620d0.js"><link rel="prefetch" href="/docs/assets/js/833.cd7045b3.js"><link rel="prefetch" href="/docs/assets/js/834.2fb2649a.js"><link rel="prefetch" href="/docs/assets/js/835.27439aab.js"><link rel="prefetch" href="/docs/assets/js/836.2080123e.js"><link rel="prefetch" href="/docs/assets/js/837.996f2c7d.js"><link rel="prefetch" href="/docs/assets/js/838.498403f6.js"><link rel="prefetch" href="/docs/assets/js/839.048d86d4.js"><link rel="prefetch" href="/docs/assets/js/84.fc5de171.js"><link rel="prefetch" href="/docs/assets/js/840.053bd885.js"><link rel="prefetch" href="/docs/assets/js/841.53a01594.js"><link rel="prefetch" href="/docs/assets/js/842.4f3eb7b5.js"><link rel="prefetch" href="/docs/assets/js/843.caae9187.js"><link rel="prefetch" href="/docs/assets/js/844.6fd18438.js"><link rel="prefetch" href="/docs/assets/js/845.2c902f2b.js"><link rel="prefetch" href="/docs/assets/js/846.6597c1f1.js"><link rel="prefetch" href="/docs/assets/js/847.9c04cf32.js"><link rel="prefetch" href="/docs/assets/js/848.c3a3684e.js"><link rel="prefetch" href="/docs/assets/js/849.6dcbb2db.js"><link rel="prefetch" href="/docs/assets/js/85.af8d2a92.js"><link rel="prefetch" href="/docs/assets/js/850.90239a01.js"><link rel="prefetch" href="/docs/assets/js/851.102a0322.js"><link rel="prefetch" href="/docs/assets/js/852.e652a448.js"><link rel="prefetch" href="/docs/assets/js/853.f4d2b825.js"><link rel="prefetch" href="/docs/assets/js/854.6bb06b12.js"><link rel="prefetch" href="/docs/assets/js/855.c41511ec.js"><link rel="prefetch" href="/docs/assets/js/856.bac0af57.js"><link rel="prefetch" href="/docs/assets/js/857.dfc83bd1.js"><link rel="prefetch" href="/docs/assets/js/858.1cee10a2.js"><link rel="prefetch" href="/docs/assets/js/859.511decf8.js"><link rel="prefetch" href="/docs/assets/js/86.76b77201.js"><link rel="prefetch" href="/docs/assets/js/860.8d26e878.js"><link rel="prefetch" href="/docs/assets/js/861.c6e8cd79.js"><link rel="prefetch" href="/docs/assets/js/862.9b4e8cfc.js"><link rel="prefetch" href="/docs/assets/js/863.b7e8f9da.js"><link rel="prefetch" href="/docs/assets/js/864.b7ae0a6d.js"><link rel="prefetch" href="/docs/assets/js/865.c4d6788c.js"><link rel="prefetch" href="/docs/assets/js/866.e47bf462.js"><link rel="prefetch" href="/docs/assets/js/867.a1688b10.js"><link rel="prefetch" href="/docs/assets/js/868.dc685dae.js"><link rel="prefetch" href="/docs/assets/js/869.8c7be1e3.js"><link rel="prefetch" href="/docs/assets/js/87.5fd4f2ce.js"><link rel="prefetch" href="/docs/assets/js/870.7cec79d2.js"><link rel="prefetch" href="/docs/assets/js/871.a8910b22.js"><link rel="prefetch" href="/docs/assets/js/872.1062b445.js"><link rel="prefetch" href="/docs/assets/js/873.d0260d6c.js"><link rel="prefetch" href="/docs/assets/js/874.117faf2e.js"><link rel="prefetch" href="/docs/assets/js/875.61161f75.js"><link rel="prefetch" href="/docs/assets/js/876.d8dda88a.js"><link rel="prefetch" href="/docs/assets/js/877.bed17928.js"><link rel="prefetch" href="/docs/assets/js/878.12cc970b.js"><link rel="prefetch" href="/docs/assets/js/879.f0c46f93.js"><link rel="prefetch" href="/docs/assets/js/88.a9326a7c.js"><link rel="prefetch" href="/docs/assets/js/880.157427f1.js"><link rel="prefetch" href="/docs/assets/js/881.9c0da1f9.js"><link rel="prefetch" href="/docs/assets/js/882.6461ef8f.js"><link rel="prefetch" href="/docs/assets/js/883.90c002d8.js"><link rel="prefetch" href="/docs/assets/js/884.4acc2abe.js"><link rel="prefetch" href="/docs/assets/js/885.7e72b9e9.js"><link rel="prefetch" href="/docs/assets/js/886.2db6682c.js"><link rel="prefetch" href="/docs/assets/js/887.30d8299e.js"><link rel="prefetch" href="/docs/assets/js/888.14f88192.js"><link rel="prefetch" href="/docs/assets/js/889.6b4b394b.js"><link rel="prefetch" href="/docs/assets/js/89.5f25c45f.js"><link rel="prefetch" href="/docs/assets/js/890.88242d66.js"><link rel="prefetch" href="/docs/assets/js/891.705598af.js"><link rel="prefetch" href="/docs/assets/js/892.d5112333.js"><link rel="prefetch" href="/docs/assets/js/893.f047a16d.js"><link rel="prefetch" href="/docs/assets/js/894.e8038193.js"><link rel="prefetch" href="/docs/assets/js/895.4f559c6f.js"><link rel="prefetch" href="/docs/assets/js/896.7e552c35.js"><link rel="prefetch" href="/docs/assets/js/897.61632210.js"><link rel="prefetch" href="/docs/assets/js/898.8c635c4e.js"><link rel="prefetch" href="/docs/assets/js/899.646bcafd.js"><link rel="prefetch" href="/docs/assets/js/9.051f2e4b.js"><link rel="prefetch" href="/docs/assets/js/90.63904893.js"><link rel="prefetch" href="/docs/assets/js/900.56de8114.js"><link rel="prefetch" href="/docs/assets/js/901.1df8d385.js"><link rel="prefetch" href="/docs/assets/js/902.1078e067.js"><link rel="prefetch" href="/docs/assets/js/903.eaab3260.js"><link rel="prefetch" href="/docs/assets/js/904.ac9efd3e.js"><link rel="prefetch" href="/docs/assets/js/905.f1397c44.js"><link rel="prefetch" href="/docs/assets/js/906.e1d3ab12.js"><link rel="prefetch" href="/docs/assets/js/907.5f6baa09.js"><link rel="prefetch" href="/docs/assets/js/908.0d4c29d0.js"><link rel="prefetch" href="/docs/assets/js/909.f2cd4ac6.js"><link rel="prefetch" href="/docs/assets/js/91.5ce7f0c3.js"><link rel="prefetch" href="/docs/assets/js/910.6fcdebc8.js"><link rel="prefetch" href="/docs/assets/js/911.6777957c.js"><link rel="prefetch" href="/docs/assets/js/912.192ae00e.js"><link rel="prefetch" href="/docs/assets/js/913.001e2b14.js"><link rel="prefetch" href="/docs/assets/js/914.f42662fc.js"><link rel="prefetch" href="/docs/assets/js/915.cac4fcbb.js"><link rel="prefetch" href="/docs/assets/js/916.17096861.js"><link rel="prefetch" href="/docs/assets/js/917.5d3aa2cd.js"><link rel="prefetch" href="/docs/assets/js/918.067ca6c4.js"><link rel="prefetch" href="/docs/assets/js/919.96b3dd13.js"><link rel="prefetch" href="/docs/assets/js/92.03afd5f0.js"><link rel="prefetch" href="/docs/assets/js/920.c75da0a5.js"><link rel="prefetch" href="/docs/assets/js/921.de79d8a6.js"><link rel="prefetch" href="/docs/assets/js/922.0f1918f7.js"><link rel="prefetch" href="/docs/assets/js/923.4b394cbf.js"><link rel="prefetch" href="/docs/assets/js/924.60cd234f.js"><link rel="prefetch" href="/docs/assets/js/925.39a12e0e.js"><link rel="prefetch" href="/docs/assets/js/926.c81ddd59.js"><link rel="prefetch" href="/docs/assets/js/927.9ccb47e4.js"><link rel="prefetch" href="/docs/assets/js/928.2b34630c.js"><link rel="prefetch" href="/docs/assets/js/929.6683f400.js"><link rel="prefetch" href="/docs/assets/js/93.a9b56f5a.js"><link rel="prefetch" href="/docs/assets/js/930.098e3a4a.js"><link rel="prefetch" href="/docs/assets/js/931.7fcfc095.js"><link rel="prefetch" href="/docs/assets/js/932.15375ce8.js"><link rel="prefetch" href="/docs/assets/js/933.d3eebeb5.js"><link rel="prefetch" href="/docs/assets/js/934.54978a6f.js"><link rel="prefetch" href="/docs/assets/js/935.c91e4f22.js"><link rel="prefetch" href="/docs/assets/js/936.a8735ceb.js"><link rel="prefetch" href="/docs/assets/js/937.85182e4c.js"><link rel="prefetch" href="/docs/assets/js/938.a93039f9.js"><link rel="prefetch" href="/docs/assets/js/939.eec54478.js"><link rel="prefetch" href="/docs/assets/js/94.755cb533.js"><link rel="prefetch" href="/docs/assets/js/940.4740eaea.js"><link rel="prefetch" href="/docs/assets/js/941.3b89acaf.js"><link rel="prefetch" href="/docs/assets/js/942.1f5a7556.js"><link rel="prefetch" href="/docs/assets/js/943.5dc97c29.js"><link rel="prefetch" href="/docs/assets/js/944.9961bf92.js"><link rel="prefetch" href="/docs/assets/js/945.71197478.js"><link rel="prefetch" href="/docs/assets/js/946.911f5769.js"><link rel="prefetch" href="/docs/assets/js/947.2d677338.js"><link rel="prefetch" href="/docs/assets/js/948.7517f60b.js"><link rel="prefetch" href="/docs/assets/js/949.d5a72238.js"><link rel="prefetch" href="/docs/assets/js/95.b9022c5c.js"><link rel="prefetch" href="/docs/assets/js/950.2a566f7c.js"><link rel="prefetch" href="/docs/assets/js/951.4ed58b1a.js"><link rel="prefetch" href="/docs/assets/js/952.2c11c1a2.js"><link rel="prefetch" href="/docs/assets/js/953.92888b69.js"><link rel="prefetch" href="/docs/assets/js/954.0310924b.js"><link rel="prefetch" href="/docs/assets/js/955.81a20420.js"><link rel="prefetch" href="/docs/assets/js/956.d4ffd582.js"><link rel="prefetch" href="/docs/assets/js/957.44f1ecbf.js"><link rel="prefetch" href="/docs/assets/js/958.e34debbc.js"><link rel="prefetch" href="/docs/assets/js/959.e097670d.js"><link rel="prefetch" href="/docs/assets/js/96.ee73e6c4.js"><link rel="prefetch" href="/docs/assets/js/960.0cc1a18c.js"><link rel="prefetch" href="/docs/assets/js/961.9b321ce4.js"><link rel="prefetch" href="/docs/assets/js/962.eb3e7815.js"><link rel="prefetch" href="/docs/assets/js/963.47c3cb4c.js"><link rel="prefetch" href="/docs/assets/js/964.6e1a2f57.js"><link rel="prefetch" href="/docs/assets/js/965.c5ad05e3.js"><link rel="prefetch" href="/docs/assets/js/966.964bbdad.js"><link rel="prefetch" href="/docs/assets/js/967.24ae6747.js"><link rel="prefetch" href="/docs/assets/js/968.c80e898b.js"><link rel="prefetch" href="/docs/assets/js/969.a00ccb6b.js"><link rel="prefetch" href="/docs/assets/js/97.b44fac77.js"><link rel="prefetch" href="/docs/assets/js/970.8533ba87.js"><link rel="prefetch" href="/docs/assets/js/971.67278162.js"><link rel="prefetch" href="/docs/assets/js/972.c2fa6219.js"><link rel="prefetch" href="/docs/assets/js/973.1fe23483.js"><link rel="prefetch" href="/docs/assets/js/974.d2ff44fe.js"><link rel="prefetch" href="/docs/assets/js/975.2d4bc6e6.js"><link rel="prefetch" href="/docs/assets/js/976.a6c7f38a.js"><link rel="prefetch" href="/docs/assets/js/977.3635a676.js"><link rel="prefetch" href="/docs/assets/js/978.f46b4826.js"><link rel="prefetch" href="/docs/assets/js/979.1353cba7.js"><link rel="prefetch" href="/docs/assets/js/98.9c54769a.js"><link rel="prefetch" href="/docs/assets/js/980.cdfc802c.js"><link rel="prefetch" href="/docs/assets/js/981.94cf3fc9.js"><link rel="prefetch" href="/docs/assets/js/982.a6814225.js"><link rel="prefetch" href="/docs/assets/js/983.cfb42e21.js"><link rel="prefetch" href="/docs/assets/js/984.51f5d4ab.js"><link rel="prefetch" href="/docs/assets/js/985.1ea79184.js"><link rel="prefetch" href="/docs/assets/js/986.e0a2d63d.js"><link rel="prefetch" href="/docs/assets/js/987.e02525b3.js"><link rel="prefetch" href="/docs/assets/js/988.700902ac.js"><link rel="prefetch" href="/docs/assets/js/989.22f1560b.js"><link rel="prefetch" href="/docs/assets/js/99.df60c60f.js"><link rel="prefetch" href="/docs/assets/js/990.e5fb2404.js"><link rel="prefetch" href="/docs/assets/js/991.e7ebadf0.js"><link rel="prefetch" href="/docs/assets/js/992.4e1043b2.js"><link rel="prefetch" href="/docs/assets/js/993.c91aef48.js"><link rel="prefetch" href="/docs/assets/js/994.69c3d38e.js"><link rel="prefetch" href="/docs/assets/js/995.91000ab4.js"><link rel="prefetch" href="/docs/assets/js/996.9a58e9f4.js"><link rel="prefetch" href="/docs/assets/js/997.db9b9d32.js"><link rel="prefetch" href="/docs/assets/js/998.1b6526a0.js"><link rel="prefetch" href="/docs/assets/js/999.3f137356.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.1fca6052.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">木可生森</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/node/html5/HTML基础/1 基本结构.html" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/css3/css初级/CSS简介.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/javaScript/js基础教程/变量声明.html" class="nav-link">
  javaScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/调试/调试/ChromeDevTools.html" class="nav-link">
  调试
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/typeScript/环境配置/介绍.html" class="nav-link">
  typeScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/git/基本使用.html" class="nav-link">
  git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue学习路线" class="dropdown-title"><span class="title">Vue学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue学习路线" class="mobile-dropdown-title"><span class="title">Vue学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vue/npm/notes/npm.html" class="nav-link">
  NPM
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/模拟数据/json-server.html" class="nav-link">
  模拟数据
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/vite/vite.html" class="nav-link">
  vite
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/vue/vue基础/数据绑定渲染.html" class="nav-link">
  Vue2基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/nodejs/快速上手/认识nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/webpack/webpack.html" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="/docs/数据结构/二叉树/二叉树基本操作.html" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/docs/算法/二分查找/二维数组查找.html" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/docs/手撕/call.html" class="nav-link">
  手撕
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经" class="dropdown-title"><span class="title">面经</span> <span class="arrow down"></span></button> <button type="button" aria-label="面经" class="mobile-dropdown-title"><span class="title">面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/面经/牛客网/html/标签/日历.html" class="nav-link">
  牛客网
</a></li><li class="dropdown-item"><!----> <a href="/docs/面经/腾讯面经/HTML.html" class="nav-link">
  面经
</a></li></ul></div></div><div class="nav-item"><a href="/docs/蓝桥杯/模拟题/实现搜一搜.html" class="nav-link">
  蓝桥杯
</a></div><div class="nav-item"><a href="/docs/项目/作家/小程序问题.html" class="nav-link">
  项目笔记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线编辑
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          博客指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://v3.cn.vuejs.org/guide/introduction.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端基础" class="mobile-dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/node/html5/HTML基础/1 基本结构.html" class="nav-link">
  HTML5
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/css3/css初级/CSS简介.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/javaScript/js基础教程/变量声明.html" class="nav-link">
  javaScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/调试/调试/ChromeDevTools.html" class="nav-link">
  调试
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/typeScript/环境配置/介绍.html" class="nav-link">
  typeScript
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/git/基本使用.html" class="nav-link">
  git
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue学习路线" class="dropdown-title"><span class="title">Vue学习路线</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue学习路线" class="mobile-dropdown-title"><span class="title">Vue学习路线</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/vue/npm/notes/npm.html" class="nav-link">
  NPM
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/模拟数据/json-server.html" class="nav-link">
  模拟数据
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/vite/vite.html" class="nav-link">
  vite
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/vue/vue基础/数据绑定渲染.html" class="nav-link">
  Vue2基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/nodejs/快速上手/认识nodejs.html" class="nav-link">
  nodejs
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/webpack/webpack.html" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="/docs/数据结构/二叉树/二叉树基本操作.html" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/docs/算法/二分查找/二维数组查找.html" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/docs/手撕/call.html" class="nav-link">
  手撕
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面经" class="dropdown-title"><span class="title">面经</span> <span class="arrow down"></span></button> <button type="button" aria-label="面经" class="mobile-dropdown-title"><span class="title">面经</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/面经/牛客网/html/标签/日历.html" class="nav-link">
  牛客网
</a></li><li class="dropdown-item"><!----> <a href="/docs/面经/腾讯面经/HTML.html" class="nav-link">
  面经
</a></li></ul></div></div><div class="nav-item"><a href="/docs/蓝桥杯/模拟题/实现搜一搜.html" class="nav-link">
  蓝桥杯
</a></div><div class="nav-item"><a href="/docs/项目/作家/小程序问题.html" class="nav-link">
  项目笔记
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线编辑
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          在线服务
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          博客指南
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://juejin.im/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://blog.csdn.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://v3.cn.vuejs.org/guide/introduction.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue3
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Vue2
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>面经</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/面经/腾讯面经/HTML.html" class="sidebar-link">HTML</a></li><li><a href="/docs/面经/腾讯面经/CSS.html" class="sidebar-link">CSS</a></li><li><a href="/docs/面经/腾讯面经/JS.html" class="sidebar-link">JS</a></li><li><a href="/docs/面经/腾讯面经/TS.html" class="sidebar-link">TS</a></li><li><a href="/docs/面经/腾讯面经/node.html" class="sidebar-link">node</a></li><li><a href="/docs/面经/腾讯面经/Vue.html" class="sidebar-link">Vue2 基础</a></li><li><a href="/docs/面经/腾讯面经/React.html" class="sidebar-link">React</a></li><li><a href="/docs/面经/腾讯面经/Webpack&amp;Vite.html" class="sidebar-link">Webpack</a></li><li><a href="/docs/面经/腾讯面经/操作系统.html" class="sidebar-link">操作系统</a></li><li><a href="/docs/面经/腾讯面经/后端问题.html" class="sidebar-link">后端问题</a></li><li><a href="/docs/面经/腾讯面经/计算机网络.html" class="sidebar-link">计算机网络</a></li><li><a href="/docs/面经/腾讯面经/浏览器安全.html" class="sidebar-link">浏览器安全</a></li><li><a href="/docs/面经/腾讯面经/浏览器工作原理.html" class="active sidebar-link">浏览器工作原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_1-重点-从输入url到看到页面发生了什么" class="sidebar-link">1 (重点)从输入URL到看到页面发生了什么？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_1-1-dns解析" class="sidebar-link">1-1 DNS解析</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_1-2-dns优化" class="sidebar-link">1-2 DNS优化</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_1-3-dns缓存" class="sidebar-link">1-3 DNS缓存</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_1-4-dns负载均衡" class="sidebar-link">1-4 DNS负载均衡</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_2-1-发起tcp连接" class="sidebar-link">2-1 发起TCP连接</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_2-2-三次握手" class="sidebar-link">2-2 三次握手</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_2-3-四次挥手" class="sidebar-link">2-3 四次挥手</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_3-1-发送http请求" class="sidebar-link">3-1 发送HTTP请求</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_3-2-重点-更重要的事情-http缓存" class="sidebar-link">3-2 (重点)更重要的事情-HTTP缓存</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_4-1-重点-服务器处理请求并返回http报文" class="sidebar-link">4-1 (重点)服务器处理请求并返回HTTP报文</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_5-1-重点-浏览器解析渲染页面" class="sidebar-link">5-1 (重点)浏览器解析渲染页面</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_6-扩展-性能优化" class="sidebar-link">6 扩展：性能优化</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_2-浏览器层合成和页面渲染优化" class="sidebar-link">2. 浏览器层合成和页面渲染优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#一-什么是渲染层合成" class="sidebar-link">一 什么是渲染层合成</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#二、浏览器的渲染原理" class="sidebar-link">二、浏览器的渲染原理</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#三、隐式合成" class="sidebar-link">三、隐式合成</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#四、层爆炸和层压缩" class="sidebar-link">四、层爆炸和层压缩</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#五、基于层合成的页面渲染优化" class="sidebar-link">五、基于层合成的页面渲染优化</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_3-浏览器前端缓存问题" class="sidebar-link">3.浏览器前端缓存问题</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_4-如何设计实现一个渲染引擎" class="sidebar-link">4 如何设计实现一个渲染引擎</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_5-前端性能定位以及优化指标" class="sidebar-link">5 前端性能定位以及优化指标</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#重点-同源策略与跨域-跨域问题-解决-jsonp原理-不受跨域影响的标签" class="sidebar-link">(重点)同源策略与跨域（跨域问题，解决，jsonp原理，不受跨域影响的标签）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#什么是同源" class="sidebar-link">什么是同源</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#什么地方有要求同源" class="sidebar-link">什么地方有要求同源</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#跨域资源共享" class="sidebar-link">跨域资源共享</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#cors-的简单请求原理" class="sidebar-link">CORS 的简单请求原理</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#浏览器对-cors-的实现" class="sidebar-link">浏览器对 CORS 的实现</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#reverse-proxy反向代理" class="sidebar-link">Reverse Proxy反向代理</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#图像-ping" class="sidebar-link">图像 Ping</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#jsonp" class="sidebar-link">JSONP</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#其他的跨域方法" class="sidebar-link">其他的跨域方法</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#cors和jsonp对比" class="sidebar-link">CORS和JSONP对比</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#事件冒泡和事件捕获-应用-注意" class="sidebar-link">事件冒泡和事件捕获，应用？注意？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#事件冒泡" class="sidebar-link">事件冒泡</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#事件捕获" class="sidebar-link">事件捕获</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#addeventlistener的第三个参数" class="sidebar-link">addEventListener的第三个参数</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#冒泡的案例" class="sidebar-link">冒泡的案例</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#捕获的案例" class="sidebar-link">捕获的案例</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#事件捕获vs事件冒泡" class="sidebar-link">事件捕获vs事件冒泡</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#应用-事件代理" class="sidebar-link">应用：事件代理</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#选择冒泡还是捕获" class="sidebar-link">选择冒泡还是捕获？</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#ie浏览器兼容" class="sidebar-link">IE浏览器兼容</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#事件轮询-eventloop" class="sidebar-link">事件轮询 Eventloop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#题目1" class="sidebar-link">题目1：</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_1-任务队列" class="sidebar-link">1.任务队列</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_2-流程分析" class="sidebar-link">2 流程分析</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_3-总结" class="sidebar-link">3.总结</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#题目2" class="sidebar-link">题目2：</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#etag是什么-有什么用" class="sidebar-link">Etag是什么？有什么用</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#重绘和重排-重绘和回流" class="sidebar-link">重绘和重排（重绘和回流）</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#重点-浏览器储存cookie-localstorage-sessionstorage详细区别" class="sidebar-link">(重点)浏览器储存cookie，localStorage，sessionStorage详细区别</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#http缓存-如果缓存还在有效期内-但是资源变更了怎么办" class="sidebar-link">http缓存，如果缓存还在有效期内，但是资源变更了怎么办</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#jsonp跨域的安全问题" class="sidebar-link">jsonp跨域的安全问题</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#jsonp的原理是什么-如何实现" class="sidebar-link">jsonp的原理是什么，如何实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#一个正常的请求-json" class="sidebar-link">一个正常的请求: JSON</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#一个-jsonp-请求" class="sidebar-link">一个 JSONP 请求</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#服务器端代码" class="sidebar-link">服务器端代码</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#完整代码附录" class="sidebar-link">完整代码附录</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#jsonp-实现代码示例演示" class="sidebar-link">JSONP 实现代码示例演示</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#文件结构" class="sidebar-link">文件结构</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#快速演示" class="sidebar-link">快速演示</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#cors-跨域-要支持两个域名怎么做" class="sidebar-link">cors 跨域，要支持两个域名怎么做</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#js会阻塞加载-怎么阻塞的" class="sidebar-link">js会阻塞加载，怎么阻塞的？</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#http缓存更新静态文件的方式" class="sidebar-link">http缓存更新静态文件的方式</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#postmessage" class="sidebar-link">postmessage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#postmessage的定义" class="sidebar-link">postMessage的定义</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#发送数据" class="sidebar-link">发送数据:</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#otherwindow" class="sidebar-link">otherWindow</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#接收数据-监听message事件的发生" class="sidebar-link">接收数据: 监听message事件的发生</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#postmessage的使用场景" class="sidebar-link">postMessage的使用场景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#场景一-跨域通信-包括get请求和post请求" class="sidebar-link">场景一 跨域通信(包括GET请求和POST请求)</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#场景二-webworker" class="sidebar-link">场景二  WebWorker</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#场景三-service-worker" class="sidebar-link">场景三 Service Worker</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#浏览器卡顿-你怎么去排除" class="sidebar-link">浏览器卡顿，你怎么去排除？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_1-长时间占用js线程" class="sidebar-link">1.长时间占用js线程</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_2-页面回流和重绘较多" class="sidebar-link">2.页面回流和重绘较多</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_3-资源加载阻塞" class="sidebar-link">3 资源加载阻塞</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_4-内存泄漏导致内存过大" class="sidebar-link">4.内存泄漏导致内存过大</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_5-dom节点或事件占用内存过大" class="sidebar-link">5.dom节点或事件占用内存过大</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#pc浏览器的分布-主流浏览器的版本" class="sidebar-link">PC浏览器的分布？主流浏览器的版本</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#重点-缓存问题-etag和if-modify-since是怎么来的" class="sidebar-link">(重点)缓存问题，Etag和IF-modify-since是怎么来的？</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#非同源cookie怎么访问" class="sidebar-link">非同源cookie怎么访问</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#如果要你缓存图片你怎么做" class="sidebar-link">如果要你缓存图片你怎么做？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_1-ajax-加载图片" class="sidebar-link">1.ajax 加载图片</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_2-url-createobjecturl" class="sidebar-link">2.. URL.createObjectURL</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_3-转为base64-格式" class="sidebar-link">3. 转为base64 格式</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#_4-缓存在localstorage" class="sidebar-link">4.缓存在localStorage</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#有多台服务器-sessionid怎么找" class="sidebar-link">有多台服务器，sessionid怎么找</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#图片懒加载" class="sidebar-link">图片懒加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#方案一-clientheight、scrolltop-和-offsettop" class="sidebar-link">方案一:clientHeight、scrollTop 和 offsetTop</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#方案二-getboundingclientrect" class="sidebar-link">方案二：getBoundingClientRect</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#方案三-intersectionobserver" class="sidebar-link">方案三: IntersectionObserver</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#方案四-lazyloading-属性" class="sidebar-link">方案四: LazyLoading 属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#重点-跨浏览器开发" class="sidebar-link">(重点)跨浏览器开发</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#重点-浏览器缓存" class="sidebar-link">(重点)浏览器缓存</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#localhost-3000-与-localhost-5000-的-cookie-信息是否共享" class="sidebar-link">localhost:3000 与 localhost:5000 的 cookie 信息是否共享</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#如何设置一个cookie" class="sidebar-link">如何设置一个cookie</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#重点-如何删除一个-cookie" class="sidebar-link">(重点)如何删除一个 cookie</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#当-cookie-没有设置-maxage-时-cookie-会存在多久" class="sidebar-link">当 cookie 没有设置 maxage 时，cookie 会存在多久</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#浏览器中-cookie-有哪些字段" class="sidebar-link">浏览器中 cookie 有哪些字段</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#异步加载-js-脚本时-async-与-defer-有何区别" class="sidebar-link">异步加载 JS 脚本时，async 与 defer 有何区别</a></li><li class="sidebar-sub-header"><a href="/docs/面经/腾讯面经/浏览器工作原理.html#重点-重绘和重排有什么区别-怎么优化" class="sidebar-link">(重点)重绘和重排有什么区别，怎么优化</a></li></ul></li><li><a href="/docs/面经/腾讯面经/前端框架.html" class="sidebar-link">前端框架</a></li><li><a href="/docs/面经/腾讯面经/设计模式.html" class="sidebar-link">设计模式</a></li><li><a href="/docs/面经/腾讯面经/手撕.html" class="sidebar-link">手撕</a></li><li><a href="/docs/面经/腾讯面经/算法.html" class="sidebar-link">算法</a></li><li><a href="/docs/面经/腾讯面经/项目工程.html" class="sidebar-link">项目工程</a></li><li><a href="/docs/面经/腾讯面经/移动端&amp;小程序.html" class="sidebar-link">移动端&amp;小程序</a></li><li><a href="/docs/面经/腾讯面经/桌面应用.html" class="sidebar-link">(重点)electron原理</a></li><li><a href="/docs/面经/腾讯面经/简历问题.html" class="sidebar-link">简历问题</a></li><li><a href="/docs/面经/腾讯面经/开发环境.html" class="sidebar-link">开发环境</a></li><li><a href="/docs/面经/腾讯面经/扩展问题.html" class="sidebar-link">扩展问题</a></li><li><a href="/docs/面经/腾讯面经/面试记录.html" class="sidebar-link">自我介绍</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="浏览器工作原理"><a href="#浏览器工作原理" class="header-anchor">#</a> 浏览器工作原理</h1> <h2 id="_1-重点-从输入url到看到页面发生了什么"><a href="#_1-重点-从输入url到看到页面发生了什么" class="header-anchor">#</a> 1 (重点)从输入URL到看到页面发生了什么？</h2> <p>很多大公司面试喜欢问这样一道面试题，<code>输入URL到看见页面发生了什么？</code>,今天我们来总结一下。 简单来说，共有以下几个过程</p> <ul><li>DNS解析</li> <li>发起TCP连接</li> <li>客户端发送HTTP请求</li> <li>服务器处理请求并返回HTTP报文</li> <li>浏览器解析渲染页面</li> <li>连接结束。</li></ul> <h3 id="_1-1-dns解析"><a href="#_1-1-dns解析" class="header-anchor">#</a> 1-1 DNS解析</h3> <p><font color="red" size="3">DNS解析实际上就是</font>寻找你所需要的资源的过程。假设你输入<code>www.baidu.com</code>，而这个网址并不是百度的真实地址，互联网中每一台机器都有唯一标识的IP地址，这个才是关键，但是它不好记，乱七八糟一串数字谁记得住啊，所以就需要一个<font color="red" size="3">网址和IP地址的转换，也就是DNS解析</font>。下面看看具体的解析过程</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16a634c9285cb545~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="DNS解析"></p> <p>输入<code>www.google.com</code>网址后，首先在本地的域名服务器中查找，没找到去根域名服务器查找，没有再去<code>com</code>顶级域名服务器查找，如此的类推下去，直到找到IP地址，然后把它记录在本地，供下次使用。<font color="orange" size="3">大致过程就是<code>.</code>-&gt; .com -&gt;<code>google.com.</code> -&gt; <code>www.google.com.</code>。</font> (你可能觉得我多写 .，并木有，这个.对应的就是根域名服务器，默认情况下所有的网址的最后一位都是.，既然是默认情况下，为了方便用户，通常都会省略，浏览器在请求DNS的时候会自动加上)</p> <h3 id="_1-2-dns优化"><a href="#_1-2-dns优化" class="header-anchor">#</a> 1-2 DNS优化</h3> <p>既然已经懂得了解析的具体过程，我们可以看到上述一共经过了N个过程，每个过程有一定的消耗和时间的等待，因此我们得想办法解决一下这个问题！</p> <h3 id="_1-3-dns缓存"><a href="#_1-3-dns缓存" class="header-anchor">#</a> 1-3 DNS缓存</h3> <p>DNS存在着多级缓存，从离浏览器的距离排序的话，有以下几种: <font color="red" size="3">浏览器缓存，系统缓存，路由器缓存</font>，IPS<font color="red" size="3">服务器缓存</font>，根域名服务器缓存，顶级域名服务器缓存，主域名服务器缓存。</p> <ul><li>在你的chrome浏览器中输入:chrome://dns/，你可以看到chrome浏览器的DNS缓存。</li> <li>系统缓存主要存在/etc/hosts(Linux系统)中</li></ul> <h3 id="_1-4-dns负载均衡"><a href="#_1-4-dns负载均衡" class="header-anchor">#</a> 1-4 DNS负载均衡</h3> <p>不知道你们有没有注意这样一件事，你访问<code>baidu.com</code>的时候，每次响应的并非是同一个服务器（IP地址不同），一般大公司都有成百上千台服务器来支撑访问，假设只有一个服务器，那它的性能和存储量要多大才能支撑这样大量的访问呢？<font color="red" size="3">DNS可以返回一个合适的机器的IP给用户，例如可以根据每台机器的负载量，该机器离用户地理位置的距离等等，这种过程就是DNS负载均衡</font></p> <h3 id="_2-1-发起tcp连接"><a href="#_2-1-发起tcp连接" class="header-anchor">#</a> 2-1 发起TCP连接</h3> <p>TCP提供一种可靠的传输，<font color="red" size="3">这个过程涉及到三次握手，四次挥手，下面我们详细看看 TCP提供一种面向连接的，可靠的字节流服务。</font> 其首部的数据格式如下</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16a634dbf162e53c~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="TCP首部"></p> <h3 id="_2-2-三次握手"><a href="#_2-2-三次握手" class="header-anchor">#</a> 2-2 三次握手</h3> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230221161122349.png" alt="image-20230221161122349" style="zoom:67%;"> <h4 id="tcp建立连接"><a href="#tcp建立连接" class="header-anchor">#</a> TCP建立连接</h4> <p>SYN: 同步序列编码</p> <p>ACK：确认字符</p> <p>seq：序号</p> <p><strong>ack和seq的作用是保证可靠传输</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20220422113427085.png" alt="image-20220422113427085"></p> <p>客户端： 我要连接（不能携带数据）</p> <p>服务端: 	我也要连接，你的连接我确认了</p> <p>客户端:     你的连接我也确认了（可以携带数据）</p> <h4 id="为什么不可以用两次握手"><a href="#为什么不可以用两次握手" class="header-anchor">#</a> 为什么不可以用两次握手</h4> <p>以下是网上普遍的解答：</p> <ul><li>若建立连接只需两次握手，客户端并没有太大的变化，仍然需要获得服务端的应答后才进入<code>ESTABLISHED</code>状态（<font color="red" size="3">连接成功状态</font>），而服务端在收到连接请求后就进入<code>ESTABLISHED</code>状态。</li> <li>此时<font color="red" size="3">如果网络拥塞</font>，客户端发送的<font color="red" size="3">连接请求迟迟到不了服务端</font>，客户端便超时<font color="red" size="3">重发请求</font>，如果服务端正确接收并确认应答，双方便开始通信，通信结束后释放连接。此时，<font color="red" size="3">如果那个失效的连接请求抵达了服务端</font>，由于只有两次握手，服务端收到请求就会进入<code>ESTABLISHED</code>状态，等待发送数据或主动发送数据</li> <li>但<font color="red" size="3">此时的客户端</font>早已进入<code>CLOSED</code>状态，服务端将会一直等待下去，这样浪费服务端连接资源</li> <li>但我觉得这个只是两次握手可能造成的问题，最关键的是两次握手有服务器对客户端的起始序列号做了确认，<code>但客户端却没有对服务器的起始序列号做确认</code>，不能保证传输的可靠性。</li></ul> <h3 id="_2-3-四次挥手"><a href="#_2-3-四次挥手" class="header-anchor">#</a> 2-3 四次挥手</h3> <h4 id="tcp释放连接"><a href="#tcp释放连接" class="header-anchor">#</a> TCP释放连接</h4> <p>FIN：表示关闭连接</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20220422113451128.png" alt="image-20220422113451128"></p> <p>客户端: 	我不连了</p> <p>服务端：   嗯，我知道了，我允许你断开，但是我等我现在发的东西发完，现在还不能断开  （此过程为ACK发送）</p> <p>服务端：  东西我发完了，咱们断了吧   （此过程为FIN发送）</p> <p>客户端：  我知晓了，再见</p> <h4 id="为什么客户端最后还要等待2msl"><a href="#为什么客户端最后还要等待2msl" class="header-anchor">#</a> 为什么客户端最后还要等待2MSL？</h4> <p>MSL（Maximum Segment Lifetime），TCP允许不同的实现可以设置不同的MSL值。</p> <p>第一，<font color="red" size="3">保证客户端发送的最后一个ACK报文能够到达服务器，因为这个ACK报文可能丢失</font>，站在服务器的角度看来，我已经发送了FIN+ACK报文请求断开了，客户端还没有给我回应，应该是我发送的请求断开报文它没有收到，于是服务器又会重新发送一次，而客户端就能在这个2MSL时间段内收到这个重传的报文，接着给出回应报文，并且会重启2MSL计时器。</p> <p>第二，防止类似与“三次握手”中提到了的“已经失效的连接请求报文段”出现在本连接中。客户端发送完最后一个确认报文后，在这个2MSL时间中，就可以使本连接持续的时间内所产生的所有报文段都从网络中消失。这样新的连接中不会出现旧连接的请求报文。</p> <h4 id="为什么建立连接是三次握手-关闭连接确是四次挥手呢"><a href="#为什么建立连接是三次握手-关闭连接确是四次挥手呢" class="header-anchor">#</a> 为什么建立连接是三次握手，关闭连接确是四次挥手呢？</h4> <ul><li>关闭连接时，服务器收到对方的<code>FIN</code>报文时，仅仅表示对方不再发送数据了但是还能接收数据，而自己也未必全部数据都发送给对方了，所以己方可以立即关闭，也可以发送一些数据给对方后，再发送<code>FIN</code>报文给对方来表示同意现在关闭连接</li> <li>因此，<font color="red" size="3">己方<code>ACK和FIN</code>一般都会分开发送</font>，从而导致多了一次</li></ul> <h3 id="_3-1-发送http请求"><a href="#_3-1-发送http请求" class="header-anchor">#</a> 3-1 发送HTTP请求</h3> <blockquote><p>首先科补一个小知识，HTTP的端口为80/8080，而HTTPS的端口为443</p></blockquote> <p>发送HTTP请求的过程就是构建HTTP请求报文并通过TCP协议中发送到服务器指定端口 请求报文由<strong>请求行</strong>，<strong>请求报头</strong>，<strong>请求正文</strong>组成。</p> <h4 id="请求行"><a href="#请求行" class="header-anchor">#</a> 请求行</h4> <p>请求行的格式为<code>Method Request-URL HTTP-Version CRLF</code></p> <p><code>eg: GET index.html HTTP/1.1</code></p> <p>常用的方法有: <code>GET</code>,<code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>OPTIONS</code>, <code>HEAD</code>。</p> <h4 id="常见的请求方法区别"><a href="#常见的请求方法区别" class="header-anchor">#</a> 常见的请求方法区别</h4> <p>这里主要展示<code>POST</code>和<code>GET</code>的区别</p> <blockquote><p>常见的区别</p></blockquote> <ul><li>GET在浏览器回退时是无害的，而POST会再次提交请求。</li> <li>GET产生的URL地址可以被Bookmark，而POST不可以。</li> <li><font color="red" size="3">GET请求会被浏览器主动cache</font>，而POST不会，除非手动设置。</li> <li>GET请求只能进行url编码，而POST支持多种编码方式。</li> <li>GET请求参数会被完整保留在浏览器历史记录里，而POST中的参数不会被保留。</li> <li><font color="red" size="3">GET请求在URL中传送的参数是有长度限制的</font>，而POST么有。</li> <li>对参数的数据类型，GET只接受ASCII字符，而POST没有限制。</li> <li><font color="red" size="3">GET比POST更不安全</font>，因为参数直接暴露在URL上，所以不能用来传递敏感信息。</li> <li>GET参数通过URL传递，POST放在Request body中。</li></ul> <p><font color="orange" size="3">重点区别: <code>GET</code>会产生一个<code>TCP</code>数据包，而<code>POST</code>会产生两个<code>TCP</code>数据包。</font></p> <p>详细的说就是：</p> <ul><li>对于GET方式的请求，浏览器会把http header和data一并发送出去，服务器响应200(返回数据);</li> <li>而对于POST，浏览器先发送header，服务器响应100 continue，浏览器再发送data，服务器响应200 ok(返回数据)。</li></ul> <blockquote><p><strong>注意一点，并不是所有的浏览器都会发送两次数据包，Firefox就发送一次</strong></p></blockquote> <blockquote><p><strong>注意一点你也可以在GET里面藏body，POST里面带参数</strong></p></blockquote> <h4 id="请求报头"><a href="#请求报头" class="header-anchor">#</a> 请求报头</h4> <p>请求报头允许客户端向服务器传递请求的附加信息和客户端自身的信息。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20220422151816046.png" alt="image-20220422151816046"></p> <p>从图中可以看出，请求报头中使用了Accept, Accept-Encoding, Accept-Language, Cache-Control, Connection, Cookie等字段。Accept用于指定客户端用于接受哪些类型的信息，Accept-Encoding与Accept类似，它用于指定接受的编码方式。Connection设置为Keep-alive用于告诉客户端本次HTTP请求结束之后并不需要关闭TCP连接，这样可以使下次HTTP请求使用相同的TCP通道，节省TCP连接建立的时间。</p> <h4 id="请求正文"><a href="#请求正文" class="header-anchor">#</a> 请求正文</h4> <p>当使用POST, PUT等方法时，通常需要客户端向服务器传递数据。这些数据就储存在请求正文中。在请求包头中有一些与请求正文相关的信息，例如: 现在的Web应用通常采用Rest架构，请求的数据格式一般为json。这时就需要设置<code>Content-Type: application/json</code>。</p> <h3 id="_3-2-重点-更重要的事情-http缓存"><a href="#_3-2-重点-更重要的事情-http缓存" class="header-anchor">#</a> 3-2 (重点)更重要的事情-HTTP缓存</h3> <p>更多： https://juejin.cn/post/6844904153043435533#heading-7</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/171fea0fec0b4668~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="Http缓存.jpg"></p> <p><font color="red" size="3">HTTP属于客户端缓存，我们常认为浏览器有一个缓存数据库，用来保存一些静态文件</font>，下面我们分为以下几个方面来简单介绍HTTP缓存</p> <ul><li>缓存的规则</li> <li>缓存的方案</li> <li>缓存的优点</li> <li>不同刷新的请求执行过程</li></ul> <h4 id="缓存的规则"><a href="#缓存的规则" class="header-anchor">#</a> 缓存的规则</h4> <p>缓存规则分为<strong>强制缓存</strong>和<strong>协商缓存</strong></p> <p><strong>(重点)什么是强缓存和协商缓存</strong></p> <h5 id="强制缓存"><a href="#强制缓存" class="header-anchor">#</a> <font color="red" size="3">强制缓存</font></h5> <p><strong>当缓存数据库中有客户端需要的数据，客户端直接将数据从其中拿出来使用（如果数据未失效），当缓存服务器没有需要的数据时，客户端才会向服务端请求。</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16a634c93d8f18a3~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="强制缓存"></p> <h5 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> <font color="red" size="3">协商缓存</font></h5> <p><strong>又称对比缓存。客户端会先从缓存数据库拿到一个<font color="red" size="3">缓存的标识</font>，然后向服务端验证标识是否失效，如果没有失效服务端会返回304，这样客户端可以直接去缓存数据库拿出数据，如果失效，服务端会返回新的数据</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16a634c93d5e5406~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="协商缓存"></p> <blockquote><p>强制缓存的优先级高于协商缓存，若两种缓存皆存在，且强制缓存命中目标，则协商缓存不再验证标识。</p></blockquote> <h4 id="缓存的方案"><a href="#缓存的方案" class="header-anchor">#</a> 缓存的方案</h4> <p>上面的内容让我们大概了解了缓存机制是怎样运行的，但是，服务器是如何判断缓存是否失效呢？我们知道浏览器和服务器进行交互的时候会发送一些请求数据和响应数据，我们称之为HTTP报文。报文中包含首部header和主体部分body。与缓存相关的规则信息就包含在header中。boby中的内容是HTTP请求真正要传输的部分。举个HTTP报文header部分的例子如下：</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16a634c93e1365db~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="报头"></p> <p>分为强制缓存和协商缓存来分析。</p> <h5 id="强制缓存-2"><a href="#强制缓存-2" class="header-anchor">#</a> 强制缓存</h5> <p>对于强制缓存，服务器响应的header中会用两个字段来表明——Expires和Cache-Control。</p> <h6 id="expires"><a href="#expires" class="header-anchor">#</a> <font color="red" size="3">Expires</font></h6> <p><font color="orange" size="3">Exprires的值为服务端返回的数据到期时间</font>。当再次请求时的请求时间小于返回的此时间，则直接使用缓存数据。但由于服务端时间和客户端时间可能有误差，这也将导致缓存命中的误差，另一方面，<font color="orange" size="3">Expires是HTTP1.0的产物，故现在大多数使用Cache-Control替代。</font></p> <h6 id="cache-control"><a href="#cache-control" class="header-anchor">#</a> <font color="red" size="3">Cache-Control</font></h6> <p>Cache-Control有很多属性，不同的属性代表的意义也不同。</p> <ul><li>private：客户端可以缓存</li> <li>public：客户端和代理服务器都可以缓存</li> <li><strong>max-age</strong>=t：缓存内容将在t秒后失效</li> <li><strong>no-cache</strong>：需要使用协商缓存来验证缓存数据</li> <li>no-store：所有内容都不会缓存。</li></ul> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219120727125.png" alt="image-20230219120727125" style="zoom:50%;"> <p><font color="red" size="3">验证强缓存</font></p> <p>本地通过 express 起一个服务来验证强缓存的 3 个属性，代码如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">etag</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 禁用协商缓存</span>
  <span class="token literal-property property">lastModified</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 禁用协商缓存</span>
  <span class="token function-variable function">setHeaders</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> path<span class="token punctuation">,</span> stat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'Cache-Control'</span><span class="token punctuation">,</span> <span class="token string">'max-age=10'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 强缓存超时时间为10秒</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>第一次加载，页面会向服务器请求数据，并在 Response Header 中添加 Cache-Control ，过期时间为 10 秒。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/171fea0fefc0c914~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="缓存1.jpg"></p> <p>第二次加载，Date 头属性未更新，可以看到浏览器直接使用了强缓存，实际没有发送请求。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/171fea0fec38cd06~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="缓存2.jpg"></p> <p>过了 10 秒的超时时间之后，再次请求资源：</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/171fea0ff0566887~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="缓存3.jpg"></p> <p>当 Pragma 和 Cache-Control 同时存在的时候，Pragma 的优先级高于 Cache-Control。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/171fea0ff1465018~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="缓存5.jpg"></p> <h5 id="协商缓存-对比缓存-服务端缓存策略-由服务端来判断资源是否可以被缓存-不是文件缓存在服务端"><a href="#协商缓存-对比缓存-服务端缓存策略-由服务端来判断资源是否可以被缓存-不是文件缓存在服务端" class="header-anchor">#</a> 协商缓存  （对比缓存，服务端缓存策略，由服务端来判断资源是否可以被缓存，不是文件缓存在服务端）</h5> <p>协商缓存需要进行对比判断是否可以使用缓存。浏览器第一次请求数据时，服务器会将缓存标识与数据一起响应给客户端，客户端将它们备份至缓存中。再次请求时，客户端会将<font color="red" size="3">缓存中的标识</font>发送给服务器，服务器根据此标识判断。<font color="orange" size="3">若未失效，返回304状态码</font>，浏览器拿到此状态码就可以直接使用缓存数据了，<font color="orange" size="3">若失效，返回200状态码和最新的资源</font>。</p> <p>对于协商缓存来说，缓存标识我们需要着重理解一下，下面我们将着重介绍它的两种缓存方案。</p> <h6 id="last-modified-一种资源标识"><a href="#last-modified-一种资源标识" class="header-anchor">#</a> <font color="red" size="3">Last-Modified （一种资源标识）</font></h6> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219122336487.png" alt="image-20230219122336487" style="zoom:50%;"> <ul><li><p>Last-Modified：服务器在初次响应请求时，会<strong>告诉浏览器资源的最后修改时间</strong>。</p></li> <li><p><code>if-Modified-Since</code>:浏览器再次请求服务器的时候，请求头会包含此字段，<font color="red" size="3">后面跟着在缓存中获得的最后修改时间</font>。<font color="orange" size="3">服务端收到此请求头发现有if-Modified-Since，则与被请求资源的最后修改时间进行对比，如果一致则返回304和响应报文头</font>，浏览器只需要从缓存中获取信息即可。</p></li></ul> <p>从字面上看，就是说：从某个时间节点算起，是否文件被修改了</p> <ul><li>如果真的被修改：那么开始传输响应一个整体，服务器返回：200 OK</li> <li>如果没有被修改：那么只需传输响应header，服务器返回：304 Not Modified</li> <li><code>if-Unmodified-Since</code>:从字面上看, 就是说: 从某个时间点算起, 是否文件没有被修改
<ul><li>如果没有被修改:则开始`继续'传送文件: 服务器返回: 200 OK</li> <li>如果文件被修改:则不传输,服务器返回: 412 Precondition failed (预处理错误)</li></ul></li></ul> <p>这两个的区别是一个是修改了才下载一个是没修改才下载。</p> <h4 id="重点-last-modified缺点"><a href="#重点-last-modified缺点" class="header-anchor">#</a> (重点)Last-Modified缺点</h4> <p><font color="orange" size="3">因为last-modified是根据资源最后修改时间来判断资源是否改变的，Last-Modified 说好却也不是特别好，因为如果在服务器上，一个资源被修改了，但其实际内容根本没发生改变，会因为Last-Modified时间匹配不上而返回了整个实体给客户端（即使客户端缓存里有个一模一样的资源）。</font>为了解决这个问题，HTTP1.1推出了Etag。</p> <h6 id="etag-一种资源标识"><a href="#etag-一种资源标识" class="header-anchor">#</a> <font color="red" size="3">Etag （一种资源标识）</font></h6> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219122823564.png" alt="image-20230219122823564" style="zoom:50%;"> <ul><li><p>Etag：服务器响应请求时，通过此字段告诉浏览器当前资源在服务器生成的唯一标识(内容hash)（生成规则由服务器决定）</p></li> <li><p>If-None-Match：再次请求服务器时，浏览器的请求报文头部会包含此字段，<font color="red" size="3">后面的值为在缓存中获取的标识</font>。服务器接收到次报文后发现If-None-Match则与被请求资源的唯一标识进行对比。</p> <ul><li>不同，说明资源被改动过，则响应整个资源内容，返回状态码200。</li> <li>相同，说明资源无心修改，则响应header，浏览器直接从缓存中获取数据信息。返回状态码304.</li></ul></li></ul> <h4 id="重点-etag缺点"><a href="#重点-etag缺点" class="header-anchor">#</a> (重点)Etag缺点</h4> <p><font color="red" size="3">但是实际应用中由于Etag的计算是使用算法来得出的，而算法会占用服务端计算的资源，所有服务端的资源都是宝贵的，所以就很少使用Etag了。</font></p> <p><font color="red" size="3">验证协商缓存</font></p> <p>本地通过 express 起一个服务来验证协商缓存，代码如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">etag</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启协商缓存</span>
  <span class="token literal-property property">lastModified</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启协商缓存</span>
  <span class="token function-variable function">setHeaders</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> path<span class="token punctuation">,</span> stat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string-property property">'Cache-Control'</span><span class="token operator">:</span> <span class="token string">'max-age=00'</span><span class="token punctuation">,</span> <span class="token comment">// 浏览器不走强缓存</span>
      <span class="token string-property property">'Pragma'</span><span class="token operator">:</span> <span class="token string">'no-cache'</span><span class="token punctuation">,</span> <span class="token comment">// 浏览器不走强缓存</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>第一次请求资源:</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/171fea0ff25773ac~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="缓存6.jpg"></p> <p>第二次请求资源，服务端根据请求头中的 If-Modified-Since 和 If-None-Match 验证文件是否修改。</p> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/5/10/171fea102889a5fc~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="缓存7.jpg"></p> <p>我们再来验证一下 ETag 在强校验的情况下，只增加一行空格，hash 值如何变化，在代码中，我采用的是对文件进行 MD5 加密来计算其 hash 值。</p> <p>注：只是为了演示用，实际计算不是通过 MD5 加密的，Apache 默认通过 FileEtag 中 FileEtag INode Mtime Size 的配置自动生成 ETag，用户可以通过自定义的方式来修改文件生成 ETag 的方式。</p> <p>为了保证 lastModified 不影响缓存，我把通过 Last-Modified/If-Modified-Since 请求头删除了，源码如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> CryptoJS <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto-js/crypto-js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token literal-property property">etag</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 只通过Etag来判断</span>
  <span class="token literal-property property">lastModified</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 关闭另一种协商缓存</span>
  <span class="token function-variable function">setHeaders</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> path<span class="token punctuation">,</span> stat</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取文件</span>
    <span class="token keyword">const</span> hash <span class="token operator">=</span> CryptoJS<span class="token punctuation">.</span><span class="token constant">MD5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// MD5加密</span>
    res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string-property property">'Cache-Control'</span><span class="token operator">:</span> <span class="token string">'max-age=00'</span><span class="token punctuation">,</span> <span class="token comment">// 浏览器不走强缓存</span>
      <span class="token string-property property">'Pragma'</span><span class="token operator">:</span> <span class="token string">'no-cache'</span><span class="token punctuation">,</span> <span class="token comment">// 浏览器不走强缓存</span>
      <span class="token string-property property">'ETag'</span><span class="token operator">:</span> hash<span class="token punctuation">,</span> <span class="token comment">// 手动设置Etag值为MD5加密后的hash值</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用新端口号，否则上面验证的协商缓存会一直存在</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>第一次和第二次请求如下：</p> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/5/10/171fea1028a3c5a1~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="缓存10.jpg"></p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/171fea102b4fd3ff~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="缓存11.jpg"></p> <p>然后我修改了 test.js ，增加一个空格后再删除一个空格，保持文件内容不变，但文件的修改时间改变，发起第三次请求，由于我生成 ETag 的方式是通过对文件内容进行 MD5 加密生成，所以虽然修改时间变化了，但请求依然返回了 304 ，读取浏览器缓存。</p> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/5/10/171fea102b886f6d~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="缓存13.jpg"></p> <p>ETag/If-None-Match 的出现主要解决了 Last-Modified/If-Modified-Since 所解决不了的问题：</p> <ul><li>如果文件的修改频率在秒级以下，Last-Modified/If-Modified-Since 会错误地返回 304</li> <li>如果文件被修改了，但是内容没有任何变化的时候，Last-Modified/If-Modified-Since 会错误地返回 304 ，上面的例子就说明了这个问题</li></ul> <h4 id="缓存的优点"><a href="#缓存的优点" class="header-anchor">#</a> 缓存的优点</h4> <ul><li>减少了冗余的数据传递，节省宽带流量</li> <li>减少了服务器的负担，大大提高了网站性能</li> <li>加快了客户端加载网页的速度 这也正是HTTP缓存属于客户端缓存的原因。</li></ul> <h4 id="不同刷新的请求执行过程"><a href="#不同刷新的请求执行过程" class="header-anchor">#</a> 不同刷新的请求执行过程</h4> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219123859296.png" alt="image-20230219123859296" style="zoom:50%;"> <h5 id="浏览器地址栏中写入url-回车"><a href="#浏览器地址栏中写入url-回车" class="header-anchor">#</a> 浏览器地址栏中写入URL，回车</h5> <ul><li>浏览器发现缓存中有这个文件了，不用继续请求了，直接去缓存拿。（最快）</li></ul> <h5 id="f5"><a href="#f5" class="header-anchor">#</a> F5</h5> <ul><li>F5就是告诉浏览器，别偷懒，好歹去服务器看看这个文件是否有过期了。于是浏览器就战战兢兢的发送一个请求带上If-Modify-since。</li></ul> <h5 id="ctrl-f5"><a href="#ctrl-f5" class="header-anchor">#</a> Ctrl+F5</h5> <ul><li>告诉浏览器，你先把你缓存中的这个文件给我删了，然后再去服务器请求个完整的资源文件下来。于是客户端就完成了强行更新的操作.</li></ul> <h4 id="重点-http缓存综述"><a href="#重点-http缓存综述" class="header-anchor">#</a> （重点）http缓存综述</h4> <p>建议自己画一遍</p> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219123228068.png" alt="image-20230219123228068"> <h3 id="_4-1-重点-服务器处理请求并返回http报文"><a href="#_4-1-重点-服务器处理请求并返回http报文" class="header-anchor">#</a> 4-1 (重点)服务器处理请求并返回HTTP报文</h3> <p>它会对TCP连接进行处理，对HTTP协议进行解析，并按照报文格式进一步封装成HTTP Request对象，供上层使用。这一部分工作一般是由Web服务器去进行，我使用过的Web服务器有Tomcat, Nginx和Apache等等 HTTP报文也分成三份，<strong>状态码</strong> ，<strong>响应报头</strong>和<strong>响应报文</strong></p> <h4 id="状态码"><a href="#状态码" class="header-anchor">#</a> 状态码</h4> <p>状态码是由3位数组成，第一个数字定义了响应的类别，且有五种可能取值:</p> <ul><li>1xx：指示信息–表示请求已接收，继续处理。</li> <li>2xx：成功–表示请求已被成功接收、理解、接受。</li> <li>3xx：重定向–要完成请求必须进行更进一步的操作。</li> <li>4xx：客户端错误–请求有语法错误或请求无法实现。</li> <li>5xx：服务器端错误–服务器未能实现合法的请求。</li></ul> <p>平时遇到比较常见的状态码有:200, 204, 301, 302, 304, 400, 401, 403, 404, 422, 500</p> <h4 id="常见状态码区别"><a href="#常见状态码区别" class="header-anchor">#</a> 常见状态码区别</h4> <h5 id="_200-成功"><a href="#_200-成功" class="header-anchor">#</a> 200 成功</h5> <p>请求成功，通常服务器提供了需要的资源。</p> <h5 id="_204-无内容"><a href="#_204-无内容" class="header-anchor">#</a> 204 无内容</h5> <p>服务器成功处理了请求，但没有返回任何内容。</p> <h5 id="_301-永久移动"><a href="#_301-永久移动" class="header-anchor">#</a> 301 永久移动</h5> <p>请求的网页已永久移动到新位置。 服务器返回此响应（对 GET 或 HEAD 请求的响应）时，会自动将请求者转到新位置。</p> <h5 id="_302-临时移动"><a href="#_302-临时移动" class="header-anchor">#</a> 302 临时移动</h5> <p>服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求。</p> <h5 id="_304-未修改"><a href="#_304-未修改" class="header-anchor">#</a> 304 未修改</h5> <p>自从上次请求后，请求的网页未修改过。 服务器返回此响应时，不会返回网页内容。</p> <h5 id="_400-错误请求"><a href="#_400-错误请求" class="header-anchor">#</a> 400 错误请求</h5> <p>服务器不理解请求的语法。</p> <h5 id="_401-未授权"><a href="#_401-未授权" class="header-anchor">#</a> 401 未授权</h5> <p>请求要求身份验证。 对于需要登录的网页，服务器可能返回此响应。</p> <h5 id="_403-禁止"><a href="#_403-禁止" class="header-anchor">#</a> 403 禁止</h5> <p>服务器拒绝请求。</p> <h5 id="_404-未找到"><a href="#_404-未找到" class="header-anchor">#</a> 404 未找到</h5> <p>服务器找不到请求的网页。</p> <h5 id="_422-无法处理"><a href="#_422-无法处理" class="header-anchor">#</a> 422 无法处理</h5> <p>请求格式正确，但是由于含有语义错误，无法响应</p> <h5 id="_500-服务器内部错误"><a href="#_500-服务器内部错误" class="header-anchor">#</a> 500 服务器内部错误</h5> <p>服务器遇到错误，无法完成请求。</p> <h4 id="响应报头"><a href="#响应报头" class="header-anchor">#</a> 响应报头</h4> <p>常见的响应报头字段有: Server, Connection...。</p> <h4 id="响应报文"><a href="#响应报文" class="header-anchor">#</a> 响应报文</h4> <p>你从服务器请求的HTML,CSS,JS文件就放在这里面</p> <h3 id="_5-1-重点-浏览器解析渲染页面"><a href="#_5-1-重点-浏览器解析渲染页面" class="header-anchor">#</a> 5-1 (重点)浏览器解析渲染页面</h3> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20220422153716594.png" alt="image-20220422153716594"></p> <p>就是<code>Webkit</code>解析渲染页面的过程。</p> <ul><li>解析HTML形成<strong>DOM树</strong></li> <li>解析CSS形成<strong>CSSOM 树</strong></li> <li>合并DOM树和CSSOM树形成<strong>渲染树</strong></li> <li><strong>遇到script标签就暂停渲染，优先加载并执行js代码，完成后再继续，用渲染树去渲染页面</strong></li> <li>浏览器开始渲染并绘制页面</li></ul> <p>这个过程涉及两个比较重要的概念<strong>回流</strong>和<strong>重绘</strong>，DOM结点都是以盒模型形式存在，需要浏览器去<strong>计算位置和宽度等</strong>，<strong>这个过程就是回流</strong>。等到页面的宽高，大小，颜色等属性确定下来后，浏览器开始绘制内容，<strong>这个过程叫做重绘</strong>。浏览器刚打开页面一定要经过这两个过程的，但是这个过程非常非常非常消耗性能，所以我们应该<strong>尽量减少页面的回流和重绘</strong></p> <blockquote><p>建议把css放到head里，js放到body后面</p> <p>如果把css放到body里，可能渲染一半发现有个css就要重新渲染了</p> <p>把js放到body里，渲染一半发现有个js，有可能就卡住了</p> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219144838463.png" alt="image-20230219144838463" style="zoom:50%;"></blockquote> <h4 id="性能优化之回流重绘"><a href="#性能优化之回流重绘" class="header-anchor">#</a> 性能优化之回流重绘</h4> <h4 id="回流"><a href="#回流" class="header-anchor">#</a> 回流</h4> <p>当Render Tree中部分或全部元素的尺寸、结构、或某些属性发生改变时，浏览器重新渲染部分或全部文档的过程称为回流。</p> <p>会导致回流的操作：</p> <ul><li>页面首次渲染</li> <li>浏览器窗口大小发生改变</li> <li>元素尺寸或位置发生改变</li> <li>元素内容变化（文字数量或图片大小等等）</li> <li>元素字体大小变化</li> <li>添加或者删除可见的DOM元素</li> <li>激活CSS伪类（例如：:hover）</li> <li>查询某些属性或调用某些方法</li></ul> <p>一些常用且会导致回流的属性和方法：</p> <ul><li><code>clientWidth、clientHeight、clientTop、clientLeft</code></li> <li><code>offsetWidth、offsetHeight、offsetTop、offsetLeft</code></li> <li><code>scrollWidth、scrollHeight、scrollTop、scrollLeft</code></li> <li><code>scrollIntoView()、scrollIntoViewIfNeeded()</code></li> <li><code>getComputedStyle()</code></li> <li><code>getBoundingClientRect()</code></li> <li><code>scrollTo()</code></li></ul> <h4 id="重绘"><a href="#重绘" class="header-anchor">#</a> 重绘</h4> <p>当页面中元素样式的改变并不影响它在文档流中的位置时（例如：color、background-color、visibility等），浏览器会将新样式赋予给元素并重新绘制它，这个过程称为重绘。</p> <h4 id="优化"><a href="#优化" class="header-anchor">#</a> 优化</h4> <h5 id="css"><a href="#css" class="header-anchor">#</a> CSS</h5> <ul><li>避免使用table布局。</li> <li>尽可能在DOM树的最末端改变class。</li> <li>避免设置多层内联样式。</li> <li>将动画效果应用到position属性为absolute或fixed的元素上。</li> <li>避免使用CSS表达式（例如：calc()）。</li></ul> <h5 id="javascript"><a href="#javascript" class="header-anchor">#</a> JavaScript</h5> <ul><li>避免频繁操作样式，最好一次性重写style属性，或者将样式列表定义为class并一次性更改class属性。</li> <li>避免频繁操作DOM，创建一个documentFragment，在它上面应用所有DOM操作，最后再把它添加到文档中。</li> <li>也可以先为元素设置display: none，操作结束后再把它显示出来。因为在display属性为none的元素上进行的DOM操作不会引发回流和重绘。</li> <li>避免频繁读取会引发回流/重绘的属性，如果确实需要多次使用，就用一个变量缓存起来。</li> <li>对具有复杂动画的元素使用绝对定位，使它脱离文档流，否则会引起父元素及后续元素频繁回流。</li></ul> <h4 id="js的解析"><a href="#js的解析" class="header-anchor">#</a> JS的解析</h4> <p>JS的解析是由浏览器的JS引擎完成的。由于JavaScript是单线程运行，也就是说一个时间只能干一件事，干这件事情时其他事情都有排队，但是有些人物比较耗时（例如IO操作），所以将任务分为<strong>同步任务</strong>和<strong>异步任务</strong>，所有的同步任务放在主线程上执行，形成执行栈，而异步任务等待，当执行栈被清空时才去看看异步任务有没有东西要搞，有再提取到主线程执行，这样往复循环（冤冤相报何时了，阿弥陀佛），就形成了Event Loop事件循环，下面来看看大人物</p> <h4 id="event-loop"><a href="#event-loop" class="header-anchor">#</a> Event Loop</h4> <p>JavaScript是一门单线程语言，尽管H5中提出了<code>Web-Worker</code>，能够模拟实现多线程，但本质上还是单线程，说它是多线程就是扯淡。</p> <h4 id="事件循环"><a href="#事件循环" class="header-anchor">#</a> 事件循环</h4> <p>既然是单线程，每个事件的执行就要有顺序，比如你去银行取钱，前面的人在进行，后面的就得等待，要是前面的人弄个一两个小时，估计后面的人都疯了，因此，浏览器的JS引擎处理JavaScript时分为<strong>同步任务</strong>和<strong>异步任务</strong></p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16a634c9e9a32553~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="事件执行"></p> <p>这张图我们可以清楚看到</p> <ul><li>同步和异步任务分别进入不同的执行&quot;场所&quot;，同步的进入主线程，异步的进入Event Table并注册函数。</li> <li>当指定的事情完成时，Event Table会将这个函数移入Event Queue。</li> <li>主线程内的任务执行完毕为空，会去Event Queue读取对应的函数，进入主线程执行。</li> <li>上述过程会不断重复，也就是常说的Event Loop(事件循环)。</li></ul> <p>js引擎存在monitoring process进程，会持续不断的检查主线程执行栈是否为空，一旦为空，就会去Event Queue那里检查是否有等待被调用的函数。 估计看完这些你对事件循环有一定的了解，但是事实上我们看对的没这么简单，通常我们会看到Promise，setTimeout，process.nextTick（），这个时候你和我就懵逼。</p> <blockquote><p>除了同步任务和异步任务，我们还分为宏任务和微任务，常见的有以下几种</p></blockquote> <ul><li>macro-task(宏任务)：包括整体代码script，setTimeout，setInterval</li> <li>micro-task(微任务)：Promise，process.nextTick</li></ul> <p>不同任务会进入不同的任务队列来执行。 JS引擎开始工作后，先在宏任务中开始第一次循环（<code>script里面先执行，不过我喜欢把它拎出来，直接称其进入执行栈</code>），当主线程执行栈全部任务被清空后去微任务看看，如果有等待执行的任务，执行全部的微任务（其实将其回调函数推入执行栈来执行），再去宏任务找最先进入队列的任务执行，执行这个任务后再去主线程执行任务（例如执行```console.log(&quot;hello world&quot;)这种任务），执行栈被清空后再去微任务，这样往复循环（冤冤相报何时了）</p> <h3 id="_6-扩展-性能优化"><a href="#_6-扩展-性能优化" class="header-anchor">#</a> 6 扩展：性能优化</h3> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219145227890.png" alt="image-20230219145227890" style="zoom:50%;"> <h4 id="让加载更快"><a href="#让加载更快" class="header-anchor">#</a> 让加载更快</h4> <ul><li>减少资源体积：压缩代码</li> <li>减少访问次数：合并代码（webpack把多个js合并为一个这这样），SSR服务端渲染（将网页和数据一起加载，一起渲染，再发给前端直接展示），缓存</li> <li><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219150010951.png" alt="image-20230219150010951" style="zoom:50%;"></li> <li><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219150226564.png" alt="image-20230219150226564" style="zoom:50%;"></li> <li>使用更快的网络：CDN</li></ul> <h4 id="让渲染更快"><a href="#让渲染更快" class="header-anchor">#</a> 让渲染更快</h4> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219145752804.png" alt="image-20230219145752804" style="zoom:50%;"> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219145827332.png" alt="image-20230219145827332" style="zoom:50%;"> <h2 id="_2-浏览器层合成和页面渲染优化"><a href="#_2-浏览器层合成和页面渲染优化" class="header-anchor">#</a> 2. 浏览器层合成和页面渲染优化</h2> <p>浏览器渲染流程是个老生常谈的话题了，对于 “浏览器如何呈现一个页面的内容” 的这类问题，不少人都可以讲出一个相对完整的过程，从网络请求到浏览器解析，可以具体到很多的细节。除去网络资源获取的步骤，我们理解的 Web 页面的展示，一般可以分为 <code>构建 DOM 树</code>、<code>构建渲染树</code>、<code>布局</code>、<code>绘制</code>、<code>渲染层合成</code> 几个步骤。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0a076a2f8~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <ul><li><font color="red" size="3">构建 DOM 树</font>：浏览器将 HTML 解析成树形结构的 DOM 树，一般来说，这个过程发生在页面初次加载，或页面 JavaScript 修改了节点结构的时候。</li> <li><font color="red" size="3">构建渲染树</font>：浏览器将 CSS 解析成树形结构的 CSSOM 树，再和 DOM 树合并成渲染树。</li> <li><font color="red" size="3">布局（Layout）</font>：浏览器根据渲染树所体现的节点、各个节点的CSS定义以及它们的从属关系，计算出每个节点在屏幕中的位置。Web 页面中元素的布局是相对的，在页面元素位置、大小发生变化，往往会导致其他节点联动，需要重新计算布局，这时候的<font color="red" size="3">布局过程一般被称为回流（Reflow）</font>。</li> <li><font color="red" size="3">绘制（Paint）</font>：遍历渲染树，调用渲染器的 <code>paint()</code> 方法在屏幕上绘制出节点内容，本质上是一个像素填充的过程。这个过程也出现于回流或一些不影响布局的 CSS 修改引起的屏幕局部重画，<font color="red" size="3">这时候它被称为重绘</font>（Repaint）。<font color="orange" size="3">实际上，绘制过程是在多个层上完成的，这些层我们称为渲染层（RenderLayer）。</font></li> <li><font color="red" size="3">渲染层合成（Composite）</font>：多个绘制后的渲染层按照恰当的重叠顺序进行合并，而后生成位图，最终通过显卡展示到屏幕上。</li></ul> <p>这是一个基本的浏览器从解析到绘制一个 Web 页面的过程，跟上边页面卡顿问题的解决方法相关的，主要是最后一个环节 —— 渲染层合成。</p> <h3 id="一-什么是渲染层合成"><a href="#一-什么是渲染层合成" class="header-anchor">#</a> 一 什么是渲染层合成</h3> <p>在 DOM 树中每个节点都会对应一个渲染对象（RenderObject），<font color="red" size="3">当它们的渲染对象处于相同的坐标空间（z 轴空间）时，就会形成一个 RenderLayers，也就是渲染层。</font>渲染层将保证页面元素以正确的顺序堆叠，这时候就会出现层合成（composite），从而正确处理透明元素和重叠元素的显示。</p> <p>这个模型类似于 Photoshop 的图层模型，在 Photoshop 中，每个设计元素都是一个独立的图层，多个图层以恰当的顺序在 z 轴空间上叠加，最终构成一个完整的设计图。</p> <p>对于有位置重叠的元素的页面，这个过程尤其重要，因为一旦图层的合并顺序出错，将会导致元素显示异常。</p> <h3 id="二、浏览器的渲染原理"><a href="#二、浏览器的渲染原理" class="header-anchor">#</a> 二、浏览器的渲染原理</h3> <p>从浏览器的渲染过程中我们知道，页面 HTML 会被解析成 DOM 树，每个 HTML 元素对应了树结构上的一个 node 节点。而从 DOM 树转化到一个个的渲染层，并最终执行合并、绘制的过程，中间其实还存在一些过渡的数据结构，它们记录了 <font color="red" size="3">DOM 树到屏幕图形的转化原理，其本质也就是树结构到层结构的演化。</font></p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0a72be715~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <h4 id="_1、渲染对象"><a href="#_1、渲染对象" class="header-anchor">#</a> 1、渲染对象</h4> <p><font color="orange" size="3">一个 DOM 节点对应了一个渲染对象，渲染对象依然维持着 DOM 树的树形结构。</font>一个渲染对象知道如何绘制一个 DOM 节点的内容，它通过向一个绘图上下文（GraphicsContext）发出必要的绘制调用来绘制 DOM 节点。</p> <h4 id="_2、渲染层"><a href="#_2、渲染层" class="header-anchor">#</a> 2、渲染层</h4> <p>这是浏览器渲染期间构建的第一个层模型，处于相同坐标空间（z轴空间）的渲染对象，都将归并到同一个渲染层中，因此根据层叠上下文，不同坐标空间的的渲染对象将形成多个渲染层，以体现它们的层叠关系。所以，对于满足形成层叠上下文条件的渲染对象，浏览器会自动为其创建新的渲染层。<font color="red" size="3">能够导致浏览器为其创建新的渲染层的，包括以下几类常见的情况：</font></p> <ul><li><p>根元素 document</p></li> <li><p>有明确的定位属性（relative、fixed、sticky、absolute）</p></li> <li><p>opacity &lt; 1</p></li> <li><p>有 CSS fliter 属性</p></li> <li><p>有 CSS mask 属性</p></li> <li><p>有 CSS mix-blend-mode 属性且值不为 normal</p></li> <li><p>有 CSS transform 属性且值不为 none</p></li> <li><p>backface-visibility 属性为 hidden</p></li> <li><p>有 CSS reflection 属性</p></li> <li><p>有 CSS column-count 属性且值不为 auto或者有 CSS column-width 属性且值不为 auto</p></li> <li><p>当前有对于 opacity、transform、fliter、backdrop-filter 应用动画</p></li> <li><p>overflow 不为 visible</p></li></ul> <p>DOM 节点和渲染对象是一一对应的，<font color="red" size="3">满足以上条件的渲染对象就能拥有独立的渲染层。当然这里的独立是不完全准确的，并不代表着它们完全独享了渲染层，</font>由于不满足上述条件的渲染对象将会与其第一个拥有渲染层的父元素共用同一个渲染层，因此实际上，这些<font color="orange" size="3">渲染对象会与它的部分子元素共用这个渲染层</font>。</p> <h4 id="_3、图形层"><a href="#_3、图形层" class="header-anchor">#</a> 3、图形层</h4> <p>GraphicsLayer 其实是一个负责生成最终准备呈现的内容图形的层模型，它拥有一个图形上下文（GraphicsContext），GraphicsContext 会负责输出该层的位图。存储在共享内存中的位图将作为纹理上传到 GPU，最后由 GPU 将多个位图进行合成，然后绘制到屏幕上，此时，我们的页面也就展现到了屏幕上。</p> <p>所以 GraphicsLayer 是一个重要的渲染载体和工具，但<font color="red" size="3">它并不直接处理渲染层，而是处理合成层</font></p> <h4 id="_4、合成层"><a href="#_4、合成层" class="header-anchor">#</a> 4、合成层</h4> <p>满足某些特殊条件的渲染层，会被浏览器自动提升为合成层。<font color="red" size="3">合成层拥有单独的 GraphicsLayer，而其他不是合成层的渲染层，则和其第一个拥有 GraphicsLayer 的父层共用一个。</font></p> <p><font color="orange" size="3">那么一个渲染层满足哪些特殊条件时，才能被提升为合成层呢？</font>这里列举了一些常见的情况：</p> <ul><li>3D transforms：translate3d、translateZ 等</li> <li>video、canvas、iframe 等元素</li> <li>通过 Element.animate() 实现的 opacity 动画转换</li> <li>通过 СSS 动画实现的 opacity 动画转换</li> <li>position: fixed</li> <li>具有 will-change 属性</li> <li>对 opacity、transform、fliter、backdropfilter 应用了 animation 或者 transition</li></ul> <p>因此，文首例子的解决方案，其实就是利用 will-change 属性，将 CPU 消耗高的渲染元素提升为一个新的合成层，才能开启 GPU 加速的，因此你也可以使用 <code>transform: translateZ(0)</code> 来解决这个问题。</p> <p>这里值得注意的是，<font color="orange" size="3">不少人会将这些合成层的条件和渲染层产生的条件混淆，这两种条件发生在两个不同的层处理环节，是完全不一样的。</font></p> <p>另外，有些文章会把 CSS Filter 也列为影响 Composite 的因素之一，然而我验证后发现并没有效果。</p> <h3 id="三、隐式合成"><a href="#三、隐式合成" class="header-anchor">#</a> 三、隐式合成</h3> <p>上边提到，满足某些显性的特殊条件时，渲染层会被浏览器提升为合成层。除此之外，在浏览器的 Composite 阶段，<font color="red" size="3">还存在一种隐式合成，部分渲染层在一些特定场景下，会被默认提升为合成层。</font></p> <p>对于隐式合成，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.smashingmagazine.com%2F2016%2F12%2Fgpu-animation-doing-it-right%2F" target="_blank" rel="noopener noreferrer">CSS GPU Animation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中是这么描述的：</p> <blockquote><p>This is called implicit compositing: One or more non-composited elements that should appear above a composited one in the stacking order are promoted to composite layers. (一个或多个非合成元素应出现在堆叠顺序上的合成元素之上，被提升到合成层。)</p></blockquote> <p>这句话可能不好理解，它其实是在描述一个交叠问题（overlap）。举个例子说明一下：（<font color="red" size="3">懂了下面的例子，你就能彻底理解隐式合成</font>）</p> <ul><li>两个 absolute 定位的 div 在屏幕上交叠了，根据 <code>z-index</code> 的关系，<font color="orange" size="3">其中一个 div 就会”盖在“了另外一个上边。</font></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0a871e2e9~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <ul><li>这个时候，如果处于下方的 div 被加上了 CSS 属性：<code>transform: translateZ(0)</code>，就会被浏览器提升为合成层。提升后的合成层位于 Document 上方，假如没有隐式合成，原本应该处于上方的 div 就依然还是跟 Document 共用一个 GraphicsLayer，<font color="orange" size="3">层级反而降了，就出现了元素交叠关系错乱的问题。</font></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0a89f88c8~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <ul><li>所以为了纠正错误的交叠顺序，<font color="orange" size="3">浏览器必须让原本应该”盖在“它上边的渲染层也同时提升为合成层。</font></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0aa2976c4~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <h3 id="四、层爆炸和层压缩"><a href="#四、层爆炸和层压缩" class="header-anchor">#</a> 四、层爆炸和层压缩</h3> <h4 id="_1、层爆炸"><a href="#_1、层爆炸" class="header-anchor">#</a> 1、层爆炸</h4> <p>从上边的研究中我们可以发现，一些产生合成层的原因太过于隐蔽了，尤其是隐式合成。在平时的开发过程中，我们很少会去关注层合成的问题，很容易就产生一些不在预期范围内的合成层，当这些不符合预期的合成层达到一定量级时，就会变成层爆炸。</p> <p>层爆炸会占用 GPU 和大量的内存资源，严重损耗页面性能，因此盲目地使用 GPU 加速，结果有可能会是适得其反。<a href="https://link.juejin.cn?target=https%3A%2F%2Fdiv.io%2Ftopic%2F1348" target="_blank" rel="noopener noreferrer">CSS3硬件加速也有坑<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这篇文章提供了一个很有趣的 <a href="https://link.juejin.cn?target=http%3A%2F%2Ffouber.github.io%2Ftest%2Flayer%2F" target="_blank" rel="noopener noreferrer">DEMO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这个 DEMO 页面中包含了一个 h1 标题，它对 transform 应用了 animation 动画，进而导致被放到了合成层中渲染。由于 animation transform 的特殊性（动态交叠不确定），隐式合成在不需要交叠的情况下也能发生，就导致了<font color="orange" size="3">页面中所有 <code>z-index</code> 高于它的节点所对应的渲染层全部提升为合成层，最终让这个页面整整产生了几千个合成层。</font></p> <p>消除隐式合成就是要消除元素交叠，拿这个 DEMO 来说，<font color="orange" size="3">我们只需要给 h1 标题的 <code>z-index</code> 属性设置一个较高的数值，就能让它高于页面中其他元素，自然也就没有合成层提升的必要了。</font>点击 DEMO 中的复选按钮就可以给 h1 标题加上一个较大的 <code>z-index</code>，前后效果对比十分明显。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0aa30b739~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <h4 id="_2、层压缩"><a href="#_2、层压缩" class="header-anchor">#</a> 2、层压缩</h4> <p>当然了，面对这种问题，浏览器也有相应的应对策略，如果多个渲染层同一个合成层重叠时，这些渲染层会被压缩到一个 GraphicsLayer 中，以防止由于重叠原因导致可能出现的“层爆炸”。这句话不好理解，具体可以看看这个例子：</p> <ul><li>还是之前的模型，只不过这次不同的是，有四个 absolute 定位的 div 在屏幕内发生了交叠。此时处于最下方的 div 在加上了 CSS 属性 <code>transform: translateZ(0)</code> 后被浏览器提升为合成层，如果按照隐式合成的原理，盖在它上边的 div 会提升为一个新的合成层，第三个 div 又盖在了第二个上，自然也会被提升为合成层，第四个也同理。这样一来，岂不是就会产生四个合成层了？</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0d4bf2415~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <ul><li>然而事实并不是这样的，浏览器的层压缩机制，会将隐式合成的多个渲染层压缩到同一个 GraphicsLayer 中进行渲染，也就是说，上方的三个 div 最终会处于同一个合成层中，这就是浏览器的层压缩。</li></ul> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0d5261105~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <p>当然了，浏览器的自动层压缩并不是万能的，有很多特定情况下，浏览器是无法进行层压缩的，<a href="https://link.juejin.cn?target=https%3A%2F%2Ffed.taobao.org%2Fblog%2F2016%2F04%2F26%2Fperformance-composite%2F" target="_blank" rel="noopener noreferrer">无线性能优化：Composite<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这篇文章列举了许多详细的场景。</p> <h3 id="五、基于层合成的页面渲染优化"><a href="#五、基于层合成的页面渲染优化" class="header-anchor">#</a> 五、基于层合成的页面渲染优化</h3> <h4 id="一、层合成的得与失"><a href="#一、层合成的得与失" class="header-anchor">#</a> 一、层合成的得与失</h4> <p>层合成是一个相对复杂的浏览器特性，为什么我们需要关注这么底层又难理解的东西呢？那是因为渲染层提升为合成层之后，会给我们带来不少好处：</p> <ul><li>合成层的位图，会交由 GPU 合成，比 CPU 处理要快得多；</li> <li>当需要 repaint 时，只需要 repaint 本身，不会影响到其他的层；</li> <li>元素提升为合成层后，transform 和 opacity 才不会触发 repaint，如果不是合成层，则其依然会触发 repaint。</li></ul> <p>当然了，利弊是相对和共存的，层合成也存在一些缺点，这很多时候也成为了我们网页性能问题的根源所在：</p> <ul><li>绘制的图层必须传输到 GPU，这些层的数量和大小达到一定量级后，可能会导致传输非常慢，进而导致一些低端和中端设备上出现闪烁；</li> <li>隐式合成容易产生过量的合成层，每个合成层都占用额外的内存，而内存是移动设备上的宝贵资源，过多使用内存可能会导致浏览器崩溃，让性能优化适得其反。</li></ul> <h4 id="二、chrome-devtools-如何查看合成层"><a href="#二、chrome-devtools-如何查看合成层" class="header-anchor">#</a> 二、Chrome Devtools 如何查看合成层</h4> <p>层合成的特性给我们提供了一个利用终端硬件能力来优化页面性能的方式，对于一些重交互、重动画的页面，合理地利用层合成可以让页面的渲染效率得到极大提升，改善交互体验。而我们需要关注的是如何规避层合成对页面造成的负面影响，或者换个说法来讲，更多时候是如何权衡利害，合理组织页面的合成层，这就要求我们事先要对页面的层合成情况有一个详细的了解。Chrome Devtools 给我们提供了一些工具，可以方便的查看页面的合成层情况。</p> <p>首先是看看页面的渲染情况，以一个栏目页为例，点击 <code>More tools -&gt; Rendering</code>，选择 <code>Layer borders</code>，你就能看到页面中的合成层都带上了黄色边框。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0d555a746~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <p>这还不够，我们还需要更加详尽的层合成情况，点击 <code>More tools -&gt; Layers</code>，你可以看到像这样的一个视图：</p> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/10/9/16daf0c0dd4303a5~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <p>左侧列出了所有提升为独立合成层的元素，右侧则是一个整体合成层边界视图，以及选定合成层的详细情况，包括以下几个比较关键的信息：</p> <ul><li>Size：合成层的大小，其实也就是对应元素的尺寸；</li> <li>Compositing Reasons：形成复合层原因，这是最关键的，也是我们分析问题的突破口，比如图中的合成层产生的原因就是交叠问题；</li> <li>Memory estimate：内存占用估算；</li> <li>Paint count：绘制次数；</li> <li>Slow scroll regions：缓慢滚动区域。</li></ul> <p>可以看出我们在不经意间就已经制造出了很多意料之外的合成层，这些没有实际意义的合成层都是可以被优化的。</p> <h4 id="三、一些优化建议"><a href="#三、一些优化建议" class="header-anchor">#</a> 三、一些优化建议</h4> <h5 id="_1、动画使用-transform-实现"><a href="#_1、动画使用-transform-实现" class="header-anchor">#</a> 1、动画使用 transform 实现</h5> <p>对于一些体验要求较高的关键动画，比如一些交互复杂的玩法页面，<font color="red" size="3">存在持续变化位置的 animation 元素，我们最好是使用 transform 来实现而不是通过改变 left/top 的方式</font>。这样做的原因是，如果使用 left/top 来实现位置变化，animation 节点和 Document 将被放到了同一个 GraphicsLayer 中进行渲染，持续的动画效果将导致整个 Document 不断地执行重绘，而<font color="orange" size="3">使用 transform 的话，能够让 animation 节点被放置到一个独立合成层中进行渲染绘制，动画发生时不会影响到其它层。并且另一方面，动画会完全运行在 GPU 上，相比起 CPU 处理图层后再发送给显卡进行显示绘制来说，这样的动画往往更加流畅。</font></p> <h5 id="_2、减少隐式合成"><a href="#_2、减少隐式合成" class="header-anchor">#</a> 2、减少隐式合成</h5> <p>虽然隐式合成从根本上来说是为了保证正确的图层重叠顺序，但具体到实际开发中，隐式合成很容易就导致一些无意义的合成层生成，归根结底其实就要求我们在开发时约束自己的布局习惯，避免踩坑。</p> <p>比如上边提到的栏目页面，就因为平时开发的不注意造成页面生成了过多的合成层，我在试图查看页面合成层情况的时候，在 PC 上已经能明显感到卡顿了。利用 Chrome Devtools 分析之后不难发现，页面里边存在的一个带动画 transform 的 button 按钮，提升为了合成层，动画交叠的不确定性使得页面内其他 <code>z-index</code> 大于它但其实并没有交叠的节点也都全部提升为了合成层（这个原因真的好坑）。</p> <p>这个时候我们只需要把这个动画节点的 <font color="red" size="3"><code>z-index</code> 属性值设置得大一些，让层叠顺序高过于页面其他无关节点就行</font>。当然并不是盲目地设置 <code>z-index</code> 就能避免，有时候 <code>z-index</code> 也还是会导致隐式合成，这个时候可以试着调整一下文档中节点的先后顺序直接让后边的节点来覆盖前边的节点，而不用 <code>z-index</code> 来调整重叠关系。方法不是唯一的，具体方式还是得根据不同的页面具体分析。</p> <p>改善后的页面效果如下，可以看到相比优化前，我们消除了很多无意义的合成层。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/16daf0c0e9db722b~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="img"></p> <h5 id="_3、减小合成层的尺寸"><a href="#_3、减小合成层的尺寸" class="header-anchor">#</a> 3、减小合成层的尺寸</h5> <p>举个简单的例子，分别画两个尺寸一样的 div，但实现方式有点差别：一个直接设置尺寸 100x100，另一个设置尺寸 10x10，然后通过 <code>scale</code> 放大 10 倍，并且我们让这两个 div 都提升为合成层：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&lt;style&gt;
  .bottom, .top {
    position: absolute;
    will-change: transform;
  }
  .bottom {
    width: 100px;
    height: 100px;
    top: 20px;
    left: 20px;
    z-index: 3;
    background: rosybrown;
  }
  .top {
    width: 10px;
    height: 10px;
    transform: scale(10);
    top: 200px;
    left: 200px;
    z-index: 5;
    background: indianred;
  }
&lt;/style&gt;
&lt;body&gt;
  &lt;div class=&quot;bottom&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;top&quot;&gt;&lt;/div&gt;
&lt;/body&gt;
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>利用 Chrome Devtools 查看这两个合成层的内存占用后发现，<code>.bottom</code> 内存占用是 39.1 KB，而 <code>.top</code> 是 400 B，差距十分明显。这是因为 <code>.top</code> 是合成层，transform 位于的 Composite 阶段，现在完全在 GPU 上执行。因此对于一些纯色图层来说，<font color="red" size="3">我们可以使用 width 和 height 属性减小合成层的物理尺寸，然后再用 <code>transform: scale(…)</code> 放大，这样一来可以极大地减少层合成带来的内存消耗。</font></p> <h2 id="_3-浏览器前端缓存问题"><a href="#_3-浏览器前端缓存问题" class="header-anchor">#</a> 3.浏览器前端缓存问题</h2> <p>https://juejin.cn/post/6947936223126093861</p> <p>flex 实际上是 flex-grow、flex-shrink 和 flex-basis 三个属性的缩写。</p> <p>flex-grow：定义项目的的放大比例；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>默认为0，即 即使存在剩余空间，也不会放大；
所有项目的flex-grow为1：等分剩余空间（自动放大占位）；
flex-grow为n的项目，占据的空间（放大的比例）是flex-grow为1的n倍。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>flex-shrink：定义项目的缩小比例；</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>默认为1，即 如果空间不足，该项目将缩小；
所有项目的flex-shrink为1：当空间不足时，缩小的比例相同；
flex-shrink为0：空间不足时，该项目不会缩小；
flex-shrink为n的项目，空间不足时缩小的比例是flex-shrink为1的n倍。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>flex-basis： 定义在分配多余空间之前，项目占据的主轴空间（main size），浏览器根据此属性计算主轴是否有多余空间</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>默认值为auto，即 项目原本大小；
设置后项目将占据固定空间。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_4-如何设计实现一个渲染引擎"><a href="#_4-如何设计实现一个渲染引擎" class="header-anchor">#</a> 4 如何设计实现一个渲染引擎</h2> <p>这道题是字节终面的最后一个题目 属于<strong>开放性问题</strong> 没有固定答案 我当时觉得题目概念太大了 把我整懵了 我只是回答了下浏览器渲染原理啥的 貌似面试官不太满意 哈哈 如果叫你设计一个渲染引擎 应该从哪些方面着手呢</p> <p>大家可以参考看看文章 <a href="https://juejin.cn/post/6844903815758479374" target="_blank" rel="noopener noreferrer">你不知道的浏览器页面渲染机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_5-前端性能定位以及优化指标"><a href="#_5-前端性能定位以及优化指标" class="header-anchor">#</a> 5 前端性能定位以及优化指标</h2> <p>前端性能优化 已经是<strong>老生常谈</strong>的一项技术了 很多人说起性能优化方案的时候头头是道 但是真正的对于性能分析定位和性能指标这块却一知半解 所以这道题虽然和性能相关 但是考察点在于平常项目如何进行<strong>性能定位和分析</strong></p> <ol><li>我们可以从 前端性能监控-<strong>埋点</strong>以及 <strong>window.performance</strong>相关的 api 去回答</li> <li>也可以从性能分析工具 Performance 和 <strong>Lighthouse</strong></li> <li>还可以从<strong>性能指标</strong> LCP FCP FID CLS 等去着手</li></ol> <blockquote><p>以下为性能相关的文章 大家可以去看看</p></blockquote> <p><a href="https://juejin.cn/post/6844903662020460552" target="_blank" rel="noopener noreferrer">5 分钟撸一个前端性能监控工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6844904150057091086" target="_blank" rel="noopener noreferrer">前端性能优化之谈谈通用性能指标及上报策略<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6974565176427151397" target="_blank" rel="noopener noreferrer">前端性能优化指标 + 检测工具<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="重点-同源策略与跨域-跨域问题-解决-jsonp原理-不受跨域影响的标签"><a href="#重点-同源策略与跨域-跨域问题-解决-jsonp原理-不受跨域影响的标签" class="header-anchor">#</a> (重点)同源策略与跨域（跨域问题，解决，jsonp原理，不受跨域影响的标签）</h2> <h3 id="什么是同源"><a href="#什么是同源" class="header-anchor">#</a> 什么是同源</h3> <p>在了解跨域这个概念之前首先要知道的是何为同源策略。所谓的同源是一种安全机制，为了预防某些恶意行为（例如 Cookie 窃取等），浏览器限制了从同一个源加载的文档或脚本如何与来自另一个源的资源进行交互。而满足同源要具备三方面：<strong>协议相同</strong>、<strong>域名相同</strong>、<strong>端口相同</strong>。</p> <p>以下是对于<code>http://domain.com/dir/index.html</code>（默认端口 80）来进行同源判断：</p> <ol><li><code>http://domain.com/dir2/info.html</code>（同源）</li> <li><code>https://domain.com/dir/index.html</code>（非同源，协议不相同）</li> <li><code>http://www.domain.com/dir/index.html</code>（非同源，域名不同）</li> <li><code>http://domain.com:233/dir/index.html</code>（非同源，端口不同）</li></ol> <h3 id="什么地方有要求同源"><a href="#什么地方有要求同源" class="header-anchor">#</a> 什么地方有要求同源</h3> <ol><li>Ajax 通信</li> <li>Cookie</li> <li>LocalStorage</li> <li>IndexDB</li> <li>DOM 的操作</li></ol> <h3 id="跨域资源共享"><a href="#跨域资源共享" class="header-anchor">#</a> 跨域资源共享</h3> <p>同源策略对于用户信息安全是必不可少的，但是实现合理的跨域请求也是很重要的，于是 W3C 就定了一个叫<strong>CORS</strong>(Cross-Origin Resource Sharing)的草案，也就是<strong>跨域资源共享</strong>。其基本思想就是使用自定义的 HTTP 头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功或是失败。</p> <h3 id="cors-的简单请求原理"><a href="#cors-的简单请求原理" class="header-anchor">#</a> CORS 的简单请求原理</h3> <p>实现 CORS 需要浏览器与服务器的同时支持。例如发送一个简单的<code>GET</code>或<code>POST</code>请求，浏览器会为其添加一个<code>Origin</code>的头，其包含页面的源信息（协议、域名和端口），如：</p> <p>CORS，<strong>在服务器端设置几个响应头</strong>，如 <code>Access-Control-Allow-Origin: *</code></p> <div class="language-arduino line-numbers-mode"><pre class="language-arduino"><code>Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token comment">//domain.com</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>若服务器认为该请求可接受，就在<code>Access-Control-Allow-Origin</code>头部中回发相同的源信息（我们有时调用的公共 API，大部分都是将该头部设为<code>*</code>，但是它们都不发送 Cookie）。要注意的是请求和响应都不包含 Cookie 信息。</p> <p>以上都为简单请求，对于非简单请求，CORS 通过一种叫做 Preflighted Requests 的透明服务器验证机制支持开发者使用自定义头部信息或者 GET 和 POST 之外的方法，不过代价是在正式通信前增加一次 HTTP 请求，这里就不详细描述了。</p> <h3 id="浏览器对-cors-的实现"><a href="#浏览器对-cors-的实现" class="header-anchor">#</a> 浏览器对 CORS 的实现</h3> <p>现代浏览器都对 CORS 提供了原生支持（IE8、9 是利用<code>XDomainRequest</code>，不过已废弃），无需编写额外代码即可触发简单的跨域行为，因为浏览器会自动帮你添加一些头部信息，但是有以下限制：</p> <ol><li>不可使用<code>setRequestHeader()</code>设置自定义头部。</li> <li>默认情况下不能请求 Cookie 等凭据，除非服务器在响应头中将<code>Access-Control-Allow-Credentials</code>设为<code>true</code>。</li> <li>调用<code>getAllResponseHeaders()</code>会返回空字符串。</li></ol> <h3 id="reverse-proxy反向代理"><a href="#reverse-proxy反向代理" class="header-anchor">#</a> Reverse Proxy反向代理</h3> <p>在 nginx/traefik/haproxy 等反向代理服务器中设置为同一域名</p> <h3 id="图像-ping"><a href="#图像-ping" class="header-anchor">#</a> 图像 Ping</h3> <p>该跨域技术主要是利用<code>&lt;img&gt;</code>标签设置<code>src</code>属性（请求地址通常都带有查询字符串），然后监听该<code>&lt;img&gt;</code>的<code>onload</code>或<code>onerror</code>事件来判断请求是否成功。响应的内容通常是一张 1 像素的图片或者<code>204</code>响应。</p> <p>图片 Ping 有两个缺点：</p> <ol><li>因为是通过<code>&lt;img&gt;</code>标签实现，所以只支持<code>GET</code>请求。</li> <li>无法访问服务器响应脚本，只能用于在浏览器与服务器之间进行单向通行。</li></ol> <p>由于以上特点，图片 Ping 方法常用于跟踪用户点击页面或动态广告的曝光次数。</p> <h3 id="jsonp"><a href="#jsonp" class="header-anchor">#</a> JSONP</h3> <p><strong>jsonp不是真正的ajax，没有使用到XMLHttpRequest，是一种使用script的跨域变种方案</strong></p> <p>JSONP 是 JSON with padding 的简写，<strong>其主要是利用动态创建<code>&lt;script&gt;</code>标签向服务器发送 GET 请求</strong>，服务器收到请求后将数据放在一个指定名字的<strong>回调函数</strong>中并传送回来。接下来看一下简单示例： <strong>浏览器</strong>：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">//对创建标签行为进行封装</span>
<span class="token keyword">function</span> <span class="token function">addScriptTag</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
  script<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;text/javascript&quot;</span><span class="token punctuation">)</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> src
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//当浏览器加载完毕时向服务器发送请求</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">addScriptTag</span><span class="token punctuation">(</span><span class="token string">'http://domain.com/data?callback=getdata'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//服务器收到上面的请求后，将数据放在回调函数的参数（data）中返回</span>
<span class="token keyword">function</span> <span class="token function">getdata</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>jQuery 也有对 JSONP 的封装，有兴趣的可以了解一下（文章尾部链接）</p> <p><strong>优缺点</strong></p> <p>JSONP的优点是：它不像XMLHttpRequest对象实现的Ajax请求那样受到同源策略的限制；它的兼容性更好，<font color="red" size="3">在更加古老的浏览器中都可以运行</font>，不需要XMLHttpRequest或ActiveX的支持；并且在请求完毕后可以通过调用callback的方式回传结果。</p> <p>JSONP的缺点则是：<font color="red" size="3">它只支持GET请求而不支持POST等其它类型的HTTP请求</font>；它只支持跨域HTTP请求这种情况，不能解决不同域的两个页面之间如何进行JavaScript调用的问题。</p> <p><strong>服务器</strong></p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">//服务器获取参数名后，将回调函数和参数拼接为字符串返回</span>
response.send(
  `$<span class="token punctuation">{</span>query.callback<span class="token punctuation">}</span>(<span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Hello&quot;</span>
  <span class="token punctuation">}</span>)`
)
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="其他的跨域方法"><a href="#其他的跨域方法" class="header-anchor">#</a> 其他的跨域方法</h3> <p>跨域方法其实还有不少，这里先总结这么多，往后若时间允许的话就更新 😬</p> <ul><li>HTML5 的 postMessage</li> <li>WebSocket（当然协议就不一样了）</li> <li>document.domain（iframe）</li> <li>location.hash（iframe）</li> <li>window.name</li> <li>nginx 反向代理</li></ul> <h3 id="cors和jsonp对比"><a href="#cors和jsonp对比" class="header-anchor">#</a> CORS和JSONP对比</h3> <p>CORS（跨域资源共享）与JSONP相比，无疑更为先进、方便和可靠。</p> <p>1、<font color="red" size="3"> JSONP只能实现GET请求，而CORS支持所有类型的HTTP请求。 </font></p> <p>2、  使用CORS，开发者可以使用普通的XMLHttpRequest发起请求和获得数据，比起JSONP有更好的错误处理。</p> <p>3、  JSONP主要被老的浏览器支持，它们往往不支持CORS，而绝大多数现代浏览器都已经支持了CORS）。</p> <h2 id="事件冒泡和事件捕获-应用-注意"><a href="#事件冒泡和事件捕获-应用-注意" class="header-anchor">#</a> 事件冒泡和事件捕获，应用？注意？</h2> <h3 id="事件冒泡"><a href="#事件冒泡" class="header-anchor">#</a> 事件冒泡</h3> <p>微软提出了名为<code>事件冒泡(event bubbling)</code>的事件流。事件冒泡可以形象地比喻为把一颗石头投入水中，泡泡会一直从水底冒出水面。也就是说，事件会从最内层的元素开始发生，一直向上传播，直到document对象。</p> <p>因此在事件冒泡的概念下在p元素上发生click事件的顺序应该是**<code>p -&gt; div -&gt; body -&gt; html -&gt; document</code>**</p> <h3 id="事件捕获"><a href="#事件捕获" class="header-anchor">#</a> 事件捕获</h3> <p>网景提出另一种事件流名为<code>事件捕获(event capturing)</code>。与事件冒泡相反，事件会从最外层开始发生，直到最具体的元素。</p> <p>因此在事件捕获的概念下在p元素上发生click事件的顺序应该是**<code>document -&gt; html -&gt; body -&gt; div -&gt; p</code>**</p> <h3 id="addeventlistener的第三个参数"><a href="#addeventlistener的第三个参数" class="header-anchor">#</a> addEventListener的第三个参数</h3> <p>网景 和 微软 曾经的战争还是比较火热的，当时， 网景主张捕获方式，微软主张冒泡方式。后来 w3c 采用折中的方式，平息了战火，制定了统一的标准——<strong>先捕获再冒泡</strong>。
addEventListener的第三个参数就是为冒泡和捕获准备的.
addEventListener有三个参数：</p> <blockquote><p>element.addEventListener(event, function, useCapture)</p></blockquote> <p>第一个参数是需要绑定的事件
第二个参数是触发事件后要执行的函数
第三个参数默认值是false，表示在<strong>事件冒泡阶段</strong>调用事件处理函数;如果参数为true，则表示在<strong>事件捕获阶段</strong>调用处理函数</p> <h3 id="冒泡的案例"><a href="#冒泡的案例" class="header-anchor">#</a> 冒泡的案例</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>s1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>s1
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>s2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>s2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>
    s1.addEventListener(&quot;click&quot;,function(e){
        console.log(&quot;s1 冒泡事件&quot;);
    },false);
    s2.addEventListener(&quot;click&quot;,function(e){
        console.log(&quot;s2 冒泡事件&quot;);
    },false);
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="捕获的案例"><a href="#捕获的案例" class="header-anchor">#</a> 捕获的案例</h3> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>s1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>s1
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>s2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>s2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span>
    s1.addEventListener(&quot;click&quot;,function(e){
        console.log(&quot;s1 捕获事件&quot;);
    },true);
    s2.addEventListener(&quot;click&quot;,function(e){
        console.log(&quot;s2 捕获事件&quot;);
    },true);
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="事件捕获vs事件冒泡"><a href="#事件捕获vs事件冒泡" class="header-anchor">#</a> 事件捕获vs事件冒泡</h3> <p>当事件捕获和事件冒泡一起存在的情况，事件又是如何触发呢。
这里记被点击的DOM节点为target节点</p> <ol><li>document 往 target节点，捕获前进，遇到注册的捕获事件立即触发执行</li> <li>到达target节点，触发事件（<font color="red" size="3">对于target节点上，是先捕获还是先冒泡则捕获事件和冒泡事件的注册顺序，先注册先执行</font>）</li> <li>target节点 往 document 方向，冒泡前进，遇到注册的冒泡事件立即触发</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;s1&quot;</span><span class="token operator">&gt;</span>s1
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;s2&quot;</span><span class="token operator">&gt;</span>s2<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
s1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;s1 冒泡事件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
s2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;s2 冒泡事件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
s1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;s1 捕获事件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
s2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;s2 捕获事件&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>这里大体分析下执行结果
点击s2，click事件从document-&gt;html-&gt;body-&gt;s1-&gt;s2(捕获前进)
这里在s1上发现了捕获注册事件，则输出**&quot;s1 捕获事件&quot;**
到达s2，已经到达目的节点，
s2上注册了冒泡和捕获事件，先注册的冒泡后注册的捕获，则先执行冒泡，输出**&quot;s2 冒泡事件&quot;**
再在s2上执行后注册的事件，即捕获事件，输出**&quot;s2 捕获事件&quot;**
下面进入冒泡阶段，按照s2-&gt;s1-&gt;body-&gt;html-&gt;documen(冒泡前进)
在s1上发现了冒泡事件，则输出**&quot;s1 冒泡事件&quot;**</p> <h3 id="应用-事件代理"><a href="#应用-事件代理" class="header-anchor">#</a> 应用：事件代理</h3> <p>在实际的开发当中，利用事件流的特性，我们可以使用一种叫做事件代理的方法。</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>color-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>red<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>yellow<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>blue<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>green<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>black<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>white<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果点击页面中的li元素，然后输出li当中的颜色，我们通常会这样写:</p> <div class="language-arcade line-numbers-mode"><pre class="language-text"><code>(function(){
    var color_list = document.getElementById('color-list');
    var colors = color_list.getElementsByTagName('li');
    for(var i=0;i&lt;colors.length;i++){                          
        colors[i].addEventListener('click',showColor,false);
    };
    function showColor(e){
        var x = e.target;
        console.log(&quot;The color is &quot; + x.innerHTML);
    };
})();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>利用事件流的特性，我们只绑定一个事件处理函数也可以完成：</p> <div class="language-scheme line-numbers-mode"><pre class="language-scheme"><code><span class="token punctuation">(</span><span class="token function">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>{
    var color_list = document.getElementById<span class="token punctuation">(</span><span class="token symbol">'color-list</span><span class="token punctuation">'</span><span class="token punctuation">)</span><span class="token comment">;</span>
    color_list.addEventListener<span class="token punctuation">(</span><span class="token symbol">'click</span><span class="token symbol">',showColor,false</span><span class="token punctuation">)</span><span class="token comment">;</span>
    function showColor<span class="token punctuation">(</span><span class="token function">e</span><span class="token punctuation">)</span>{
        var x = e.target<span class="token comment">;</span>
        if<span class="token punctuation">(</span><span class="token function">x.nodeName.toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> === <span class="token symbol">'li</span><span class="token punctuation">'</span><span class="token punctuation">)</span>{
            console.log<span class="token punctuation">(</span><span class="token symbol">'The</span> color is <span class="token punctuation">'</span> + x.innerHTML<span class="token punctuation">)</span><span class="token comment">;</span>
        }
    }
}<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用事件代理的好处不仅在于将多个事件处理函数减为一个，而且对于不同的元素可以有不同的处理方法。假如上述列表元素当中添加了其他的元素（如：a、span等），我们不必再一次循环给每一个元素绑定事件，直接修改事件代理的事件处理函数即可。</p> <h3 id="选择冒泡还是捕获"><a href="#选择冒泡还是捕获" class="header-anchor">#</a> 选择冒泡还是捕获？</h3> <p>对于事件代理来说，在事件捕获或者事件冒泡阶段处理并没有明显的优劣之分，但是由于事件冒泡的事件流模型被所有主流的浏览器兼容，从兼容性角度来说还是建议大家使用事件冒泡模型。</p> <h3 id="ie浏览器兼容"><a href="#ie浏览器兼容" class="header-anchor">#</a> IE浏览器兼容</h3> <p>IE浏览器对addEventListener兼容性并不算太好，只有IE9以上可以使用。</p> <p>要兼容旧版本的IE浏览器，可以使用IE的attachEvent函数</p> <blockquote><p>object.attachEvent(event, function)</p></blockquote> <p>两个参数与addEventListener相似，分别是事件和处理函数，默认是事件冒泡阶段调用处理函数，要注意的是，写事件名时候要加上&quot;on&quot;前缀（&quot;onload&quot;、&quot;onclick&quot;等）。</p> <h2 id="事件轮询-eventloop"><a href="#事件轮询-eventloop" class="header-anchor">#</a> 事件轮询 Eventloop</h2> <p>事件轮询的工作是监听调用堆栈，并确定调用堆栈是否为空。如果调用堆栈是空的，它将检查消息队列，看看是否有任何挂起的回调等待执行。</p> <p>在这种情况下，消息队列包含一个回调，此时调用堆栈为空。因此，事件轮询将回调推到堆栈的顶部。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/ca51b8264d114d83b3a9f84940297056~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p> <p>先执行同步任务，然后执行宏任务，然后执行微任务</p> <p>或者说</p> <p><strong>先执行宏任务</strong></p> <p><strong>然后执行该宏任务产生的微任务</strong></p> <p><strong>开始执行下一个宏任务</strong></p> <p><strong>特例： 同步任务就是第一个宏任务</strong></p> <h3 id="题目1"><a href="#题目1" class="header-anchor">#</a> 题目1：</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script start'</span><span class="token punctuation">)</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'setTimeout'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise1'</span><span class="token punctuation">)</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'promise2'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'script end'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>答案</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/uk76kyqiob.png" alt="preload"></p> <h3 id="_1-任务队列"><a href="#_1-任务队列" class="header-anchor">#</a> 1.任务队列</h3> <ul><li><p>JS分为同步任务和异步任务</p></li> <li><p>异步任务包括： 宏任务和微任务</p></li> <li><p>同步任务都在主线程上执行，形成一个执行栈</p></li> <li><p>主线程之外，事件触发线程管理着一个任务队列，只要异步任务有了运行结果，就在任务队列之中放置一个事件。</p></li> <li><p>一旦执行栈中的所有同步任务执行完毕(此时JS引擎空闲)，系统就会读取任务队列，将可运行的异步任务添加到可执行栈中，开始执行。</p></li> <li><p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/egmf434i2f.png" alt="preload"></p></li></ul> <p><font color="red" size="3">先执行同步任务</font></p> <ul><li><p>同步任务主要包含</p> <p>new Promise()</p> <p>执行函数</p></li></ul> <p><font color="red" size="3">然后执行宏任务</font></p> <ul><li><p><strong>(macro)task主要包含：</strong></p> <p>1.script(整体代码)<font color="red" size="3">[这里的整体代码就是同步任务]</font></p> <p>2.setTimeout</p> <p>3.setInterval</p> <p>4.I/O</p> <p>5.UI交互事件</p> <p>6.postMessage</p> <p>7.MessageChannel</p> <p>8.setImmediate(Node.js 环境)</p></li></ul> <p><font color="red" size="3">最后执行微任务</font>（在某一个macrotask执行完后，就会将在它执行期间产生的所有microtask 都 执行完毕）</p> <ul><li><p><strong>microtask主要包含：</strong></p> <ol><li><p>Promise.then</p></li> <li><p>MutaionObserver</p></li> <li><p>process.nextTick(Node.js 环境)</p></li></ol></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/3l0gl6z1yc.png" alt="preload"></p> <p>由于因为async await 本身就是promise+generator的语法糖。所以await后面的代码是microtask。所以对于本题中的</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>等同于</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>即先把sycnc2方法执行一遍，然后再把后面的代码添加到微任务队列</p> <h3 id="_2-流程分析"><a href="#_2-流程分析" class="header-anchor">#</a> 2 流程分析</h3> <ol><li>首先，事件循环从宏任务(macrotask)队列开始，这个时候，宏任务队列中，只有一个script(整体代码)任务;当遇到任务源(task source)时，则会先分发任务到对应的任务队列中去。所以，上面例子的第一步执行如下图所示：</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/s198xg6608.png" alt="img"></p> <p>2.然后我们看到首先定义了两个async函数，接着往下看，然后遇到了 console 语句，直接输出 script start。输出之后，script 任务继续往下执行，遇到 setTimeout，其作为一个宏任务源，则会先将其任务分发到对应的队列中：</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/39ji1a39vc.png" alt="img"></p> <p>3.script 任务继续往下执行，执行了async1()函数，前面讲过async函数中在await之前的代码是立即执行的，所以会立即输出async1 start。 遇到了await时，会将await后面的表达式执行一遍，所以就紧接着输出async2，然后将await后面的代码也就是console.log('async1 end')加入到microtask中的Promise队列中，接着跳出async1函数来执行后面的代码。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/zdqqe5eggb.png" alt="img"></p> <p>4.script任务继续往下执行，遇到Promise实例。由于Promise中的函数是立即执行的，而后续的 .then 则会被分发到 microtask 的 Promise 队列中去。所以会先输出 promise1，然后执行 resolve，将 promise2 分配到对应队列。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/ogbw5sm7yi.png" alt="img"></p> <p>5.script任务继续往下执行，最后只有一句输出了 script end，至此，全局任务就执行完毕了。 根据上述，每次执行完一个宏任务之后，会去检查是否存在 Microtasks；如果有，则执行 Microtasks 直至清空 Microtask Queue。 因而在script任务执行完毕之后，开始查找清空微任务队列。此时，微任务中， Promise 队列有的两个任务async1 end和promise2，因此按先后顺序输出 async1 end，promise2。当所有的 Microtasks 执行完毕之后，表示第一轮的循环就结束了。</p> <p>6.<font color="red" size="3">第二轮循环依旧从宏任务队列开始</font>。此时宏任务中只有一个 setTimeout，取出直接输出即可，至此整个流程结束。</p> <h3 id="_3-总结"><a href="#_3-总结" class="header-anchor">#</a> 3.总结</h3> <p>先执行宏任务</p> <p>然后执行该宏任务产生的微任务</p> <p>开始执行下一个宏任务</p> <p>特例： 同步任务就是第一个宏任务</p> <h3 id="题目2"><a href="#题目2" class="header-anchor">#</a> 题目2：</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
请问控制台输入顺序为以下哪个选项： 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token number">1234589671819</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>有时需要将现有对象转为 Promise 对象，Promise.resolve方法就起到这个作用。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token comment">// 等价于</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 等价于</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token comment">//8</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>又因为执行await时后面的代码会被添加到微任务队列</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>等同于</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">async1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 start'</span><span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">async2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async1 end'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>所以在执行<code>console.log(await Promise.resolve(8));</code>时</p> <p>相当于把 8 以及 8 后面的代码放入了微任务队列</p> <p>最后不难得出答案</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20220502171830081.png" alt="image-20220502171830081"></p> <h2 id="etag是什么-有什么用"><a href="#etag是什么-有什么用" class="header-anchor">#</a> Etag是什么？有什么用</h2> <p>实体标记（ETag）是一个HTTP头，用于Web缓存验证和浏览器对资源的条件请求。</p> <p>etag使用已标记到用户浏览器的持久标识元素（PIE）。用户可以删除HTTP cookies，etag存储相同的信息和秘密备份，以重建删除的cookies的数据。</p> <p><font color="red" size="3">ETag是URL的TAG，主要是标志URL对象有没发生改变，用于客户端的缓存。</font>服务器产生ETag，并在HTTP响应头中将其传送到客户端，服务器用它来判断页面是否被修改过，如果未修改返回304，无需 传输整个对象。</p> <p><strong>Etag有什么作用：</strong></p> <p>HTTP协议里ETag是“被请求变量的实体值”。</p> <p>最典型的情况是，Etag请求Web资源，条件是这些资源自用户上次访问该站点以来已被更新。例如：</p> <p>用户可以访问具有每周更改的背景的网站。在新一周的第一次访问中，浏览器会检查缓存，如果找不到图像或过时的图像，则会下载当前背景并将其缓存。如果用户在那周已经访问过该站点，浏览器将收到图像未更改的返回响应。在这种情况下，浏览器将使用缓存中的本地副本，从而节省带宽并加快加载时间，网站加载速度 更快。</p> <p>通过Etag启用的HTML5本地存储和缓存cookie也是一种用于更新cookie的方法。消费者跟踪公司使用更新cookie来解决用户删除或拒绝cookie的问题。这种做法还可以用于跟踪用户的其他目的，例如监控黑客。</p> <h2 id="重绘和重排-重绘和回流"><a href="#重绘和重排-重绘和回流" class="header-anchor">#</a> 重绘和重排（重绘和回流）</h2> <h4 id="浏览器解析渲染页面"><a href="#浏览器解析渲染页面" class="header-anchor">#</a> 浏览器解析渲染页面</h4> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20220422153716594.png" alt="image-20220422153716594"></p> <p>就是<code>Webkit</code>解析渲染页面的过程。</p> <ul><li>解析HTML形成DOM树</li> <li>解析CSS形成CSSOM 树</li> <li>合并DOM树和CSSOM树形成渲染树</li> <li>浏览器开始渲染并绘制页面</li></ul> <p>这个过程涉及两个比较重要的概念<strong>回流</strong>和<strong>重绘</strong>，DOM结点都是以盒模型形式存在，需要浏览器去计算位置和宽度等，这个过程就是回流。等到页面的宽高，大小，颜色等属性确定下来后，浏览器开始绘制内容，这个过程叫做重绘。浏览器刚打开页面一定要经过这两个过程的，但是这个过程非常非常非常消耗性能，所以我们应该尽量减少页面的回流和重绘</p> <h4 id="性能优化之回流重绘-2"><a href="#性能优化之回流重绘-2" class="header-anchor">#</a> 性能优化之回流重绘</h4> <h4 id="回流-2"><a href="#回流-2" class="header-anchor">#</a> 回流</h4> <p><strong>什么是回流(重排)？</strong></p> <p><strong>当Render Tree中部分或全部元素的尺寸、结构、或某些属性发生改变时，浏览器重新渲染部分或全部文档的过程称为回流。</strong></p> <p>会导致回流的操作：</p> <ul><li>页面首次渲染</li> <li>浏览器窗口大小发生改变</li> <li>元素尺寸或位置发生改变</li> <li>元素内容变化（文字数量或图片大小等等）</li> <li>元素字体大小变化</li> <li>添加或者删除可见的DOM元素</li> <li>激活CSS伪类（例如：:hover）</li> <li>查询某些属性或调用某些方法</li></ul> <p>一些常用且会导致回流的属性和方法：</p> <ul><li><code>clientWidth、clientHeight、clientTop、clientLeft</code></li> <li><code>offsetWidth、offsetHeight、offsetTop、offsetLeft</code></li> <li><code>scrollWidth、scrollHeight、scrollTop、scrollLeft</code></li> <li><code>scrollIntoView()、scrollIntoViewIfNeeded()</code></li> <li><code>getComputedStyle()</code></li> <li><code>getBoundingClientRect()</code></li> <li><code>scrollTo()</code></li></ul> <h4 id="重绘-2"><a href="#重绘-2" class="header-anchor">#</a> 重绘</h4> <p><strong>什么是重绘？</strong></p> <p><strong>当页面中元素样式的改变并不影响它在文档流中的位置时（例如：color、background-color、visibility等），浏览器会将新样式赋予给元素并重新绘制它，这个过程称为重绘。</strong></p> <h4 id="优化-2"><a href="#优化-2" class="header-anchor">#</a> 优化</h4> <h5 id="css-2"><a href="#css-2" class="header-anchor">#</a> CSS</h5> <ul><li>避免使用table布局。</li> <li>尽可能在DOM树的最末端改变class。</li> <li>避免设置多层内联样式。</li> <li>将动画效果应用到position属性为absolute或fixed的元素上。</li> <li>避免使用CSS表达式（例如：calc()）。</li></ul> <h5 id="javascript-2"><a href="#javascript-2" class="header-anchor">#</a> JavaScript</h5> <ul><li>避免频繁操作样式，最好一次性重写style属性，或者将样式列表定义为class并一次性更改class属性。</li> <li>避免频繁操作DOM，<strong>创建一个documentFragment</strong>，在它上面应用所有DOM操作，最后再把它添加到文档中。</li> <li>也可以先为元素设置display: none，操作结束后再把它显示出来。因为在display属性为none的元素上进行的DOM操作不会引发回流和重绘。</li> <li>避免频繁读取会引发回流/重绘的属性，如果确实需要多次使用，就用一个变量缓存起来。</li> <li>对具有复杂动画的元素使用绝对定位，使它脱离文档流，否则会引起父元素及后续元素频繁回流。</li></ul> <h2 id="重点-浏览器储存cookie-localstorage-sessionstorage详细区别"><a href="#重点-浏览器储存cookie-localstorage-sessionstorage详细区别" class="header-anchor">#</a> (重点)浏览器储存cookie，localStorage，sessionStorage详细区别</h2> <p>Cookie、LocalStorage、SessionStorage区别</p> <ul><li><p>Cookie：其实最开始是服务器端⽤于记录⽤户状态的⼀种⽅式，由服务器设置，在客户端存储，然后每次发起同源请求时，发送给服务器端。cookie 最多能存储 4 k 数据，它的⽣存时间由 expires属性指定，并且 cookie 只能被同源的⻚⾯访问共享</p> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219095942985.png" alt="image-20230219095942985" style="zoom:50%;"></li> <li><p>SessionStorage：html5 提供的⼀种浏览器本地存储的⽅法，它借鉴了服务器端 session 的概念，代表的是⼀次会话中所保存的数据。它⼀般能够存储 5M 或者更⼤的数据，它在当前窗⼝关闭后就失效了，并且sessionStorage 只能被同⼀个窗⼝的同源⻚⾯所访问共享。</p></li> <li><p>LocalStorage：html5 提供的⼀种浏览器本地存储的⽅法，它⼀般也能够存储 5M 或者更⼤的数据。它和 sessionStorage 不同的是，除⾮⼿动删除它，否则它不会失效，并且 localStorage 也只能被同源⻚⾯所访问共享</p></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230219100212815.png" alt="image-20230219100212815"></p> <p>区别可以从三方面入手</p> <ul><li>容量</li> <li>API易用性</li> <li>是否随http请求发送出去</li></ul> <h2 id="http缓存-如果缓存还在有效期内-但是资源变更了怎么办"><a href="#http缓存-如果缓存还在有效期内-但是资源变更了怎么办" class="header-anchor">#</a> http缓存，如果缓存还在有效期内，但是资源变更了怎么办</h2> <h5 id="协商缓存-2"><a href="#协商缓存-2" class="header-anchor">#</a> 协商缓存</h5> <p>协商缓存需要进行对比判断是否可以使用缓存。浏览器第一次请求数据时，服务器会将缓存标识与数据一起响应给客户端，客户端将它们备份至缓存中。<font color="red" size="3">再次请求时，客户端会将缓存中的标识发送给服务器，服务器根据此标识判断</font>。若未失效，返回304状态码，浏览器拿到此状态码就可以直接使用缓存数据了。</p> <p>对于协商缓存来说，缓存标识我们需要着重理解一下，<font color="red" size="3">下面我们将着重介绍它的两种缓存方案。</font></p> <h6 id="last-modified"><a href="#last-modified" class="header-anchor">#</a> <font color="red" size="3">Last-Modified</font></h6> <blockquote><p>Last-Modified：服务器在响应请求时，会告诉浏览器资源的最后修改时间。</p></blockquote> <ul><li><code>if-Modified-Since</code>:浏览器再次请求服务器的时候，请求头会包含此字段，后面跟着在缓存中获得的最后修改时间。服务端收到此请求头发现有if-Modified-Since，则与被请求资源的最后修改时间进行对比，如果一致则返回304和响应报文头，浏览器只需要从缓存中获取信息即可。</li></ul> <p>从字面上看，就是说：从某个时间节点算起，是否文件被修改了</p> <ul><li>如果真的被修改：那么开始传输响应一个整体，服务器返回：200 OK</li> <li>如果没有被修改：那么只需传输响应header，服务器返回：304 Not Modified</li> <li><code>if-Unmodified-Since</code>:从字面上看, 就是说: 从某个时间点算起, 是否文件没有被修改
<ul><li>如果没有被修改:则开始`继续'传送文件: 服务器返回: 200 OK</li> <li>如果文件被修改:则不传输,服务器返回: 412 Precondition failed (预处理错误)</li></ul></li></ul> <p>这两个的区别是一个是修改了才下载一个是没修改才下载。</p> <p>Last-Modified 说好却也不是特别好，因为如果在服务器上，一个资源被修改了，但其实际内容根本没发生改变，会因为Last-Modified时间匹配不上而返回了整个实体给客户端（即使客户端缓存里有个一模一样的资源）。为了解决这个问题，HTTP1.1推出了Etag。</p> <h6 id="etag"><a href="#etag" class="header-anchor">#</a> <font color="red" size="3">Etag</font></h6> <blockquote><p>Etag：服务器响应请求时，通过此字段告诉浏览器当前资源在服务器生成的唯一标识（生成规则由服务器决定）</p></blockquote> <ul><li>If-None-Match：再次请求服务器时，浏览器的请求报文头部会包含此字段，后面的值为在缓存中获取的标识。服务器接收到次报文后发现If-None-Match则与被请求资源的唯一标识进行对比。
<ul><li>不同，说明资源被改动过，则响应整个资源内容，返回状态码200。</li> <li>相同，说明资源无心修改，则响应header，浏览器直接从缓存中获取数据信息。返回状态码304.</li></ul></li></ul> <p>但是实际应用中由于Etag的计算是使用算法来得出的，而算法会占用服务端计算的资源，所有服务端的资源都是宝贵的，所以就很少使用Etag了。</p> <h2 id="jsonp跨域的安全问题"><a href="#jsonp跨域的安全问题" class="header-anchor">#</a> jsonp跨域的安全问题</h2> <p>JSONP的优点是：它不像XMLHttpRequest对象实现的Ajax请求那样受到同源策略的限制；它的兼容性更好，在更加古老的浏览器中都可以运行，不需要XMLHttpRequest或ActiveX的支持；并且在请求完毕后可以通过调用callback的方式回传结果。</p> <p>JSONP的缺点则是：它只支持GET请求而不支持POST等其它类型的HTTP请求；它只支持跨域HTTP请求这种情况，不能解决不同域的两个页面之间如何进行JavaScript调用的问题。</p> <h2 id="jsonp的原理是什么-如何实现"><a href="#jsonp的原理是什么-如何实现" class="header-anchor">#</a> jsonp的原理是什么，如何实现</h2> <h3 id="一个正常的请求-json"><a href="#一个正常的请求-json" class="header-anchor">#</a> 一个正常的请求: JSON</h3> <p>正常发请求时，<code>curl</code> 示例:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">curl</span> https://shanyue.tech/api/user?id<span class="token operator">=</span><span class="token number">100</span>

<span class="token punctuation">{</span>
  <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">100</span>,
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;shanyue&quot;</span>,
  <span class="token string">&quot;wechat&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;xxxxx&quot;</span>,
  <span class="token string">&quot;phone&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;183xxxxxxxx&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>使用 <code>fetch</code> 发送请求，示例:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&quot;https://shanyue.tech/api/user?id=100&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;content-type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>请求数据后，使用一个函数来处理数据</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">handleData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="一个-jsonp-请求"><a href="#一个-jsonp-请求" class="header-anchor">#</a> 一个 JSONP 请求</h3> <p><code>JSONP</code>，全称 <code>JSON with Padding</code>，为了解决跨域的问题而出现。虽然它只能处理 GET 跨域，虽然现在基本上都使用 CORS 跨域，但仍然要知道它，毕竟<strong>面试会问</strong>。</p> <p><code>JSONP</code> 基于两个原理:</p> <ol><li>动态创建 <code>script</code>，使用 <code>script.src</code> 加载请求跨过跨域</li> <li><code>script.src</code> 加载的脚本内容为 JSONP: 即 <code>PADDING(JSON)</code> 格式</li></ol> <p>从上可知，使用 <code>JSONP</code> 跨域同样需要服务端的支持。<code>curl</code> 示例</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">curl</span> https://shanyue.tech/api/user?id<span class="token operator">=</span><span class="token number">100</span><span class="token operator">&amp;</span><span class="token assign-left variable">callback</span><span class="token operator">=</span>padding

padding<span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token number">100</span>,
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;shanyue&quot;</span>,
  <span class="token string">&quot;wechat&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;xxxxx&quot;</span>,
  <span class="token string">&quot;phone&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;183xxxxxxxx&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对于正常的请求有何不同一目了然: <strong>多了一个 callback=padding, 并且响应数据被 padding 包围</strong>，这就是 JSONP</p> <p><strong>那请求数据后，如何处理数据呢？此时的 padding 就是处理数据的函数</strong>。我们只需要在前端实现定义好 padding 函数即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span>padding <span class="token operator">=</span> handleData<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>基于以上两个原理，这里实现一个简单 jsonp 函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">jsonp_simple</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url<span class="token punctuation">,</span> onData<span class="token punctuation">,</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 一、默认 callback 函数为 padding</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> <span class="token string">&quot;padding&quot;</span><span class="token punctuation">,</span> <span class="token operator">...</span>params <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token comment">// 二、使用 onData 作为 window.padding 函数，接收数据</span>
  window<span class="token punctuation">[</span><span class="token string">&quot;padding&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> onData<span class="token punctuation">;</span>

  <span class="token comment">// 三、动态加载脚本</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 发送 JSONP 请求</span>
<span class="token function">jsonp_simple</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:10010&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">10000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Data:&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>此时会有一个问题: <strong>window.padding 函数会污染全局变量，如果有多个 JSONP 请求发送如何处理？</strong></p> <p><strong>使 jsonp 的回调函数名作为一个随机变量，避免冲突</strong>，代码如下</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url<span class="token punctuation">,</span> onData<span class="token punctuation">,</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 一、为了避免全局污染，使用一个随机函数名</span>
  <span class="token keyword">const</span> cbFnName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">JSONP_PADDING_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token comment">// 二、默认 callback 函数为 cbFnName</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> cbFnName<span class="token punctuation">,</span> <span class="token operator">...</span>params <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token comment">// 三、使用 onData 作为 cbFnName 回调函数，接收数据</span>
  window<span class="token punctuation">[</span>cbFnName<span class="token punctuation">]</span> <span class="token operator">=</span> onData<span class="token punctuation">;</span>

  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 发送 JSONP 请求</span>
<span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:10010&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">10000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">onData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Data:&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="服务器端代码"><a href="#服务器端代码" class="header-anchor">#</a> 服务器端代码</h3> <p><code>JSONP</code> 需要服务端进行配合，返回 <code>JSON With Padding</code> 数据，代码如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;querystring&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pathname<span class="token punctuation">,</span> query <span class="token punctuation">}</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;shanyue&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> params<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 服务端将要返回的字符串</span>
    str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>callback<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">10010</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="完整代码附录"><a href="#完整代码附录" class="header-anchor">#</a> 完整代码附录</h3> <p>完整代码可见<a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer">山月博客的 github 仓库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer"> (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: https://github.com/shfshanyue/blog/tree/master/code/jsonp/<a href="https://github.com/shfshanyue/blog/tree/master/code/jsonp/" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/shfshanyue/blog/tree/master/code/jsonp/" target="_blank" rel="noopener noreferrer"> (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>JSONP 实现完整代码:</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">stringify</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pairs <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> qs <span class="token operator">=</span> pairs
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>k<span class="token punctuation">,</span> v<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> noValue <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> v <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> v <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        noValue <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>noValue <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token operator">:</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> qs<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> url<span class="token punctuation">,</span> onData<span class="token punctuation">,</span> params <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 一、为了避免全局污染，使用一个随机函数名</span>
  <span class="token keyword">const</span> cbFnName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">JSONP_PADDING_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token comment">// 二、默认 callback 函数为 cbFnName</span>
  script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">callback</span><span class="token operator">:</span> cbFnName<span class="token punctuation">,</span> <span class="token operator">...</span>params <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token comment">// 三、使用 onData 作为 cbFnName 回调函数，接收数据</span>
  window<span class="token punctuation">[</span>cbFnName<span class="token punctuation">]</span> <span class="token operator">=</span> onData<span class="token punctuation">;</span>

  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><strong>JSONP 服务端适配相关代码:</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;querystring&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> pathname<span class="token punctuation">,</span> query <span class="token punctuation">}</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;shanyue&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> params<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token punctuation">.</span>callback<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">10010</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>JSONP 页面调用相关代码</strong></p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./index.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/javascript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:10010&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">10000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">onData</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Data:&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="jsonp-实现代码示例演示"><a href="#jsonp-实现代码示例演示" class="header-anchor">#</a> JSONP 实现代码示例演示</h3> <ul><li>从中克隆代码: <a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer">山月博客的 github 仓库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p><a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer"> (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>从中克隆代码: <a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer">山月博客的 github 仓库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer"> (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>从中克隆代码: <a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer">山月博客的 github 仓库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><a href="https://github.com/shfshanyue/blog/tree/master/code" target="_blank" rel="noopener noreferrer"> (opens new window)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="文件结构"><a href="#文件结构" class="header-anchor">#</a> 文件结构</h3> <ul><li><code>index.js</code>: jsonp 的简单与复杂实现</li> <li><code>server.js</code>: 服务器接口形式</li> <li><code>demo.html</code>: 前端如何调用 JSONP</li></ul> <h3 id="快速演示"><a href="#快速演示" class="header-anchor">#</a> 快速演示</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 开启服务端</span>
$ node server<span class="token punctuation">.</span>js

<span class="token comment">// 对 demo.html 起一个服务，并且按照提示在浏览器中打开地址，应该是 http://localhost:5000</span>
<span class="token comment">// 观察控制台输出 JSONP 的回调结果</span>
$ serve <span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="cors-跨域-要支持两个域名怎么做"><a href="#cors-跨域-要支持两个域名怎么做" class="header-anchor">#</a> cors 跨域，要支持两个域名怎么做</h2> <p>当浏览器发起ajax请求到其他域名时,会出现跨域的问题,在nginx上的解决方案是<font color="red" size="3">配置Access-Control-Allow-Origin来解决</font>,此参数只允许配置单个域名或者*，当我们需要允许多个域名跨域访问时却不好配置,可以用map来实现</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>map $http_origin $corsHost {
    default 0;
    &quot;~http://www.zz618.com&quot; http://www.zz618.com;
    &quot;~http://www.sukandy.com&quot; http://www.sukandy.com;
    &quot;~http://wap.123admin.com&quot; http://wap.123admin.com;
}
server
{
    listen 80;
    server_name search.123admin.com;
    root /nginx;
    location /
    {
        add_header Access-Control-Allow-Origin $corsHost;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="js会阻塞加载-怎么阻塞的"><a href="#js会阻塞加载-怎么阻塞的" class="header-anchor">#</a> js会阻塞加载，怎么阻塞的？</h2> <p>script标签有两个属性，一个是defer（翻译为延迟），二是asyn（翻译为异步，没错，和我们的常见的ajax和axios的异步是一个意思），这两个属性都可以改变脚本的加载执行方式（在浏览器支持的情况下，这两的兼容性，后面会补充）。</p> <ul><li><p>延迟：延迟是指当浏览器解析到script脚本时，会继续向下载入和解析文档，等到文档载入解析完成且可以操作文档时，才开始执行脚本。</p></li> <li><p>异步：异步是指当浏览器解析到script脚本时，会立刻下载和执行脚本，但同时浏览器解析器也会继续向下解析渲染文档，不会造成阻塞的现象。这使得脚本可以尽快的被载入执行，这很想我们前端调用post异步接口，并不影响文档的正常解析渲染。</p></li></ul> <p>ps：defer和async属性像是在告诉浏览器，链接进来的脚本不会使用document.write()，也不会生成文档内容，因此浏览器在下载脚本时可以继续解析和渲染文档。</p> <p>值得注意的是，</p> <ul><li>使用defer属性的脚本，当有多个的时候，这些脚本会按照他们在文档中排列的顺序载入执行。</li> <li>而使用asyn属性的脚本，当有多个的时候，会顺序开始触发载入，但谁先完成载入就谁先执行，这就是说，他们的执行顺序可能是无序不确定的。在有的时候知道这点很重要，因为这可能涉及一些有强制顺序的逻辑处理。</li></ul> <p>浏览器解析器遇到script脚本的解析逻辑来看，script脚本可以阻塞浏览器继续渲染，也可以不阻塞，分两种情形：<font color="red" size="3">默认情况下，script 脚本会阻塞浏览器继续渲染，但可以通过 script 的 async 与 defer 属性改变这种状况。</font></p> <ul><li><p>一个script标签同时使用了async和defer，则执行async，忽略defer。</p></li> <li><p>一个script标签只使用defer，且 defer=&quot;defer&quot;，则脚本将在页面完成解析时执行。</p></li> <li><p>async和defer都不使用，遇到script脚本即会马上载入和执行脚本，此时会阻塞页面继续向下解析渲染。</p></li> <li><p>只使用async且async=&quot;async&quot;，则脚本相对于页面的其余部分异步地执行。</p></li></ul> <h2 id="http缓存更新静态文件的方式"><a href="#http缓存更新静态文件的方式" class="header-anchor">#</a> http缓存更新静态文件的方式</h2> <p>强缓存</p> <p>协商缓存</p> <h5 id="强制缓存-3"><a href="#强制缓存-3" class="header-anchor">#</a> 强制缓存</h5> <p>当缓存数据库中有客户端需要的数据，客户端直接将数据从其中拿出来使用（如果数据未失效），当缓存服务器没有需要的数据时，客户端才会向服务端请求。</p> <h5 id="协商缓存-3"><a href="#协商缓存-3" class="header-anchor">#</a> 协商缓存</h5> <p>又称对比缓存。客户端会先从缓存数据库拿到一个缓存的标识，然后向服务端验证标识是否失效，如果没有失效服务端会返回304，这样客户端可以直接去缓存数据库拿出数据，如果失效，服务端会返回新的数据</p> <h2 id="postmessage"><a href="#postmessage" class="header-anchor">#</a> postmessage</h2> <p>postMessage - 跨域消息传递</p> <h3 id="postmessage的定义"><a href="#postmessage的定义" class="header-anchor">#</a> postMessage的定义</h3> <p>postMessage是html5引入的API,postMessage()方法允许来自不同源的脚本采用异步方式进行有效的通信,可以实现跨文本文档,多窗口,跨域消息传递.多用于窗口间数据通信,这也使它成为跨域通信的一种有效的解决方案.</p> <h3 id="发送数据"><a href="#发送数据" class="header-anchor">#</a> 发送数据:</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>otherWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> targetOrigin<span class="token punctuation">,</span> <span class="token punctuation">[</span>transfer<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="otherwindow"><a href="#otherwindow" class="header-anchor">#</a> otherWindow</h3> <p>窗口的一个引用,比如iframe的contentWindow属性,执行window.open返回的窗口对象,或者是命名过的或数值索引的window.frames.</p> <h3 id="接收数据-监听message事件的发生"><a href="#接收数据-监听message事件的发生" class="header-anchor">#</a> 接收数据: 监听message事件的发生</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> receiveMessage<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">receiveMessage</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">var</span> origin<span class="token operator">=</span> event<span class="token punctuation">.</span>origin<span class="token punctuation">;</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="postmessage的使用场景"><a href="#postmessage的使用场景" class="header-anchor">#</a> postMessage的使用场景</h2> <h3 id="场景一-跨域通信-包括get请求和post请求"><a href="#场景一-跨域通信-包括get请求和post请求" class="header-anchor">#</a> 场景一 跨域通信(包括GET请求和POST请求)</h3> <blockquote><p>我们都知道JSONP可以实现解决GET请求的跨域问题,但是不能解决POST请求的跨域问题.而postMessage都可以.这里只是列举一个示例,仅供参考,具体的代码如何编写要以具体的场景而定奥~</p></blockquote> <p><strong>父窗体创建跨域iframe并发送信息</strong></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>跨域POST消息发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/JavaScript<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>    
            // sendPost 通过postMessage实现跨域通信将表单信息发送到 moweide.gitcafe.io上,
            // 并取得返回的数据    
            function sendPost() {        
                // 获取id为otherPage的iframe窗口对象        
                var iframeWin = document.getElementById(&quot;otherPage&quot;).contentWindow;        
                // 向该窗口发送消息        
                iframeWin.postMessage(document.getElementById(&quot;message&quot;).value, 
                    'http://moweide.gitcafe.io');    
            }    
            // 监听跨域请求的返回    
            window.addEventListener(&quot;message&quot;, function(event) {        
                console.log(event, event.data);    
            }, false);
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>发送<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendPost()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span>
            <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://moweide.gitcafe.io/other-domain.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>otherPage<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>display:none<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p><strong>子窗体接收信息并处理</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;IE=edge&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token constant">POST</span> Handler<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;//code.jquery.com/jquery-1.11.0.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/JavaScript&quot;</span><span class="token operator">&gt;</span>
            window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">event</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 监听父窗口发送过来的数据向服务器发送post请求</span>
                <span class="token keyword">var</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
                $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token comment">// 注意这里的url只是一个示例.实际练习的时候你需要自己想办法提供一个后台接口</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> 
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://moweide.gitcafe.io/getData'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">&quot;info=&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">,</span>
                    <span class="token literal-property property">dataType</span><span class="token operator">:</span> <span class="token string">&quot;json&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        
                    <span class="token comment">//将请求成功返回的数据通过postMessage发送给父窗口        </span>
                    window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        
                    <span class="token comment">//将请求失败返回的数据通过postMessage发送给父窗口        </span>
                    window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h3 id="场景二-webworker"><a href="#场景二-webworker" class="header-anchor">#</a> 场景二  WebWorker</h3> <p>JavaScript语言采用的是单线程模型,通常来说,所有任务都在一个线程上完成,一次只能做一件事,后面的任务要等到前面的任务被执行完成后才可以开始执行,但是这种方法如果遇到复杂费时的计算,就会导致发生阻塞,严重阻碍应用程序的正常运行.<font color="red" size="3">Web Worker为web内容在后台线程中运行脚本提供了一种简单的方法,线程可以执行任务而不干扰用户界面.</font>一旦创建,一个worker可以将消息发送到创建它的JavaScript代码,通过消息发布到改代码指定的事件处理程序.</p> <p>一个woker是使用一个构造函数创建一个对象,运行一个命名的JavaScript文件-这个文件将包含在工作线程中运行的代码,woker运行在另一个全局上下文中,不同于当前的window,不能使用window来获取全局属性.</p> <p><strong>一些局限性</strong></p> <ul><li>只能加载同源脚本文件,不能直接操作DOM节点</li> <li>Worker 线程不能执行<code>alert()</code>方法和<code>confirm()</code>方法，但可以使用 XMLHttpRequest 对象发出 AJAX 请求</li> <li>无法读取本地文件,只能加载网络文件</li> <li>也不能使用window对象的默认方法和属性,然而你可以使用大量window对象之下的东西,包括webSocket,indexedDB以及FireFoxOS专用的DataStore API等数据存储机制.查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FWorker%2FFunctions_and_classes_available_to_workers" target="_blank" rel="noopener noreferrer">Functions and classes available to workers<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>获取详情。</li></ul> <p>workers和主线程间的数据传递通过这样的消息机制进行——双方都使用postMessage()方法发送各自的消息，使用onmessage事件处理函数来响应消息（消息被包含在<code>[Message](https://developer.mozilla.org/zh-CN/docs/Web/Reference/Events/Message &quot;/zh-CN/docs/Web/Reference/Events/Message&quot;)</code>事件的data属性中）。这个过程中数据并不是被共享而是被复制;woker分为专用worker和共享worker,一个专用worker仅仅能被首次生成它的脚本使用,而共享woker可以同时被多个脚本使用.</p> <p>专用woker使用示例:</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// main.js</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>Worker<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'http://xxx.com/worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 发送消息</span>
    first<span class="token punctuation">.</span><span class="token function-variable function">onchange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        myWorker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">[</span>first<span class="token punctuation">.</span>value<span class="token punctuation">,</span> second<span class="token punctuation">.</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Message posted to worker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    second<span class="token punctuation">.</span><span class="token function-variable function">onchange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      myWorker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">[</span>first<span class="token punctuation">.</span>value<span class="token punctuation">,</span>second<span class="token punctuation">.</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message posted to worker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 主线程 监听onmessage以响应worker回传的消息</span>
    myWorker<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> textContent <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message received from worker&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// worker.js</span>

<span class="token comment">// 内置selfduixiang,,代表子线程本身, worker内部要加载其他脚本,可通过importScripts()方法</span>
<span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;message received from main script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> workerResult <span class="token operator">=</span> <span class="token string">&quot;Result: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> e<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;posting message\back to main script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">postMessage</span><span class="token punctuation">(</span>workerResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>Web Worker的使用场景,用于收集埋点数据,可以用于大量复杂的数据计算,复杂的图像处理,大数据的处理.因为它不会阻碍主线程的正常执行和页面UI的渲染.</p> <p>埋点数据采集下的使用: 可在main.js中收集数据,将收集到的信息通过postMessage的方式发送给worker.js,在woker.js中进行相关运算和整理并发送到服务器端;当然,不使用Web Woker,通过在单页面应用中的index.html中创建iframe也可以实现页面间切换,页面停留时长等数据的采集,具体的实现我就不细讲了,感兴趣的同学可在网上搜索解决方案,有什么疑问欢迎私信我</p> <h3 id="场景三-service-worker"><a href="#场景三-service-worker" class="header-anchor">#</a> 场景三 Service Worker</h3> <p>可在浏览器控制台的application中里看到Service Worker的存在</p> <p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea95b6935c2a4022adbfbf647fa281d7~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p> <p>Service Worker是web应用做离线存储的一个最佳的解决方案,<font color="red" size="3">Service Worker和Web Worker的相同点是在常规的js引擎线程以外开辟了新的js线程去处理一些不适合在主线程上处理的业务,不同点主要包括以下几点:</font></p> <ul><li>Web Worker式服务于特定页面的,而Service Worker在被注册安装之后能够在多个页面使用</li> <li>Service Worker常驻在浏览器中,不会因为页面的关闭而被销毁.本质上,它是一个后台线程,只有你主动终结,或者浏览器回收,这个线程才会结束.</li> <li>生命周期,可调用的API也不同</li></ul> <p>我们可以使用Service Worker来进行缓存,用js来拦截浏览器的http请求,并设置缓存的文件,从而创建离线web应用.关于Service Worker的概念的介绍就到这里~~,感兴趣的可以找相关文章学习,有疑问的欢迎私信与我探讨~,这里我们主要介绍的是使用postMessage方法进行Service Worker和页面之间的通讯.</p> <p><strong>从页面发送信息到Service Worker</strong></p> <p>需要注意一点,这个页面如果直接扔进浏览器里(使用的是file协议)打开是会报错的,要使用nginx做端口映射,或者用node搭建一个服务器(使用http协议)来访问该页面(目前我猜测的原因是浏览器对file协议打开的文件做了一些服务的限制,如果有大佬知道具体原因还望告知).下文也将附上我的nginx做端口映射的配置.</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;IE=edge&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Service Worker跨窗口通信<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>textarea id<span class="token operator">=</span><span class="token string">&quot;showArea&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;sw1.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;sw2.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span> 
    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/JavaScript&quot;</span><span class="token operator">&gt;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'serviceWorker'</span> <span class="token keyword">in</span> window<span class="token punctuation">.</span>navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 对于多个不同scope的多个Service Worker,我们也可以给指定的Service Worker发送消息</span>
            navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'./sw1.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">scope</span><span class="token operator">:</span><span class="token string">'./sw1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>reg<span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token function">resolve</span><span class="token punctuation">(</span>reg<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>    
                        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">sw</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        sw<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;this message is from page to sw1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">'./sw2.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">scope</span><span class="token operator">:</span><span class="token string">'./sw2'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">,</span> reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>reg<span class="token punctuation">.</span>active<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token function">clearInterval</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token function">resolve</span><span class="token punctuation">(</span>reg<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>    
                        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">sw</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        sw<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">&quot;this message is from page to sw2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 接受数据，并填充在 DOM 中</span>
                    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'showArea'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> event<span class="token punctuation">.</span>data <span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>

<span class="token comment">// sw1.js</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;sw1.js &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    event<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'this message is from sw1.js, to page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// sw2.js</span>

self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;sw2.js &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> 
     <span class="token comment">// event.source是消息来源页面对象的引用   </span>
    event<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'this message is from sw2.js, to page'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p>nginx做端口映射的相关配置:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// nginx.conf</span>
<span class="token comment">// 因为有多个项目会用到nginx服务做端口映射</span>
<span class="token comment">// 所以我在nginx的目录下新建了conf.d的文件来存放每个项目的配置.</span>
<span class="token comment">// 然后在主配置文件里通过include引入</span>

 http <span class="token punctuation">{</span>    
    # 这里省略了一些你本机电脑上的nginx服务的配置    
    include conf<span class="token punctuation">.</span>d<span class="token comment">/*.conf; 
}


// testHtml.conf
server {    
    listen 9090;    
    server_name       localhost;
    location / {        
        root  C:/Users/hzljie/Desktop/test/testb;  
        # 这是我的测试页面的存放路径,读者用的时候记得根据自己的来更改奥        
        index  test.html test.htm;    
    }
}
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>运行的效果的截图:</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/bd6378f6862445bdb6b0155f72111e27~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img"></p> <p>这样就实现了Service Worker 与其他页面的通信,感兴趣的小伙伴可以一起来试一试奥.如果你出现报错的情况,要仔细检查自己的代码奥~</p> <h2 id="浏览器卡顿-你怎么去排除"><a href="#浏览器卡顿-你怎么去排除" class="header-anchor">#</a> 浏览器卡顿，你怎么去排除？</h2> <p><strong>1.渲染不及时，页面掉帧</strong></p> <ul><li>长时间占用js线程</li> <li>页面回流和重绘较多</li> <li>资源加载堵塞</li></ul> <p>我觉得这就是我上次碰到的哪个问题的原因，每一次请求时间差不多有2s左右，js长时间占用线程，而且加载的数据很多，页面回流与重绘严重，上一次请求还没结束，这一次请求又发起了，也造成了资源加载堵塞，多种原因导致我的页面卡崩溃了。
<strong>2.网页内存占用过高，运行卡顿</strong></p> <blockquote><p>内存泄漏导致内存过大</p></blockquote> <ul><li>意外的全局变量引起的内存泄漏</li> <li>闭包引起的内存泄漏</li> <li>被遗忘的定时器</li> <li>循环引用</li> <li>DOM 删除时没有解绑事件</li> <li>没有清理的DOM元素引用</li></ul> <blockquote><p>dom节点或事件占用内存过大</p></blockquote> <h3 id="_1-长时间占用js线程"><a href="#_1-长时间占用js线程" class="header-anchor">#</a> 1.长时间占用js线程</h3> <p>浏览器包括js线程和GUI线程，而且二者是互斥的，当长时间占用js线程时，会导致渲染不及时，出现页面卡顿</p> <ul><li>1.1同步方式获取数据，会导致gui线程挂起，数据返回后再执行渲染</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
   <span class="token literal-property property">async</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>1.2计算时间过长导致页面渲染不及时</li></ul> <p>很明显的例子就是我遇到的哪个BUG，2S的响应时间，不卡才怪。
<strong>渲染不及时的原因：</strong>
浏览器的渲染频率一般是60HZ，即要求1帧的时间为1s / 60 = 16.67ms，浏览器显示页面的时候，要处理js逻辑，还要做渲染，每个执行片段不能超过16.67ms。实际上，浏览器内核自身支撑体系运行也需要消耗一些时间，所以留给我们的时间差不多只有10ms。</p> <p><strong>常见的优化方式：</strong></p> <ul><li>使用requestIdleCallback和requestAnimationFrame，任务分片</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//添加一个任务</span>
<span class="token class-name">Task</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">addTask</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">task</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//每次重绘前取一个task执行</span>
<span class="token class-name">Task</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> tasks <span class="token operator">=</span> that<span class="token punctuation">.</span>tasks<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>tasks<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">var</span> task <span class="token operator">=</span> tasks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">task</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>that<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_2-页面回流和重绘较多"><a href="#_2-页面回流和重绘较多" class="header-anchor">#</a> 2.页面回流和重绘较多</h3> <p>尽量减少layout
获取scrollTop、clentWidth等维度属性时都会触发layout以获取实时的值，所以在for循环里面应该把这些值缓存一下</p> <p>简化DOM结构
当DOM结构越复杂时，需要重绘的元素也就越多。所以dom应该保持简单，特别是那些要做动画的，或者要监听scroll/mousemove事件的。<strong>另外使用flex比使用float在重绘方面会有优势</strong>。</p> <h3 id="_3-资源加载阻塞"><a href="#_3-资源加载阻塞" class="header-anchor">#</a> 3 资源加载阻塞</h3> <ul><li>js资源放在body之前</li> <li>行内script阻塞</li> <li>css加载会阻塞DOM树渲染（css并不会阻塞DOM树的解析）</li> <li>资源过大阻塞</li></ul> <h3 id="_4-内存泄漏导致内存过大"><a href="#_4-内存泄漏导致内存过大" class="header-anchor">#</a> 4.内存泄漏导致内存过大</h3> <p>浏览器有自己的一套垃圾回收机制，主流垃圾回收机制是标记清除，不过在ie中访问原生dom会采用引用计数方式机制，而如果闲置内存得不到及时回收，就会导致内存泄漏。</p> <p><strong>简单介绍下两种垃圾回收机制（GC Garbage Collection）</strong></p> <h4 id="标记清除"><a href="#标记清除" class="header-anchor">#</a> 标记清除</h4> <p><strong>定义和用法：</strong>
**当变量进入环境时，将变量标记为进入环境，当变量离开环境时，标记为离开环境。**某一时刻，垃圾回收器会过滤掉环境种的变量，以及被环境变量引用的变量，剩下的就是被视为准备回收的变量。
到目前为止，IE、Firefox、Opera、Chrome、Safari的js实现使用的都是标记清除的垃圾回收策略或类似的策略，只不过垃圾收集的时间间隔互不相同。
<strong>流程：</strong></p> <ul><li>浏览器在运行的时候会给存储再内存中的所有变量都加上标记</li> <li>去掉环境中的变量以及被环境中引用的变量的标记</li> <li>如果还有变量有标记，就会被视为准备删除的变量</li> <li>垃圾回收机制完成内存的清除工作，销毁那些带标记的变量，并回收他们所占用的内存空间</li></ul> <h4 id="引用计数"><a href="#引用计数" class="header-anchor">#</a> 引用计数</h4> <p>**定义和用法：**引用计数是跟踪记录每个值被引用的次数。
**基本原理：**就是变量的引用次数，被引用一次则加1，当这个引用计数为0时，被视为准备回收的对象。
<strong>流程：</strong></p> <ul><li>声明了一个变量并将一个引用类型的值赋值给这个变量，这个引用类型值引用次数就是1</li> <li>同一个值又被赋值另一个变量，这个引用类型的值引用次数加1</li> <li>当包含这个引用类型值得变量又被赋值另一个值了，那么这个引用类型的值的引用次数减1</li> <li>当引用次数变成0时， 说明这个值需要解除引用</li> <li>当垃圾回收机制下次运行时，它就会释放引用次数为0 的值所占用的内存</li></ul> <p><strong>常见的造成内存泄漏的原因：</strong></p> <ul><li><p>意外的全局变量引起的内存泄漏</p> <p><strong>解决</strong>：使用严格模式避免</p></li> <li><p>闭包引起的内存泄漏</p></li> <li><p>被遗忘的定时器</p></li> <li><p>循环引用</p></li></ul> <h3 id="_5-dom节点或事件占用内存过大"><a href="#_5-dom节点或事件占用内存过大" class="header-anchor">#</a> 5.dom节点或事件占用内存过大</h3> <p><strong>实例：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addDom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> d <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
            li<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> _this <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
                <span class="token keyword">let</span> dom <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                _this<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        li<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;/div&gt;
            &lt;h4&gt;
                测试图片 
            &lt;/h4&gt;
            &lt;img style = &quot;height:20px;width:100px&quot; src=&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1591105123139&amp;di=90a63b4962d0b4405ce65c2096a676c2&amp;imgtype=0&amp;src=http%3A%2F%2Fimg0.imgtn.bdimg.com%2Fit%2Fu%3D3769023270%2C3433174748%26fm%3D214%26gp%3D0.jpg&quot;/&gt;
            &lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
            d<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>上面的代码是下拉加载，每次都会添加dom，最终导致内存过大
<strong>解决办法</strong>：采用虚拟列表和事件委托</p> <p>总结：页面卡顿在实际开发过程中有很多场景，可以使用内存泄漏检测工具（sIEve，针对IE）进行检测，也可以使用chrome提供的timeline和profiles，或者performance，这里不再详细介绍。</p> <p>Chrome调试工具使用https://juejin.cn/post/6850037261518684167#heading-31</p> <p>（服务器到后台都讲了一遍，他告诉我如果数据没问题，是浏览器的问题怎么排除，我说了代码中打断点调试，他不满意，说我Chrome的调试工具台掌握很不好）</p> <h2 id="pc浏览器的分布-主流浏览器的版本"><a href="#pc浏览器的分布-主流浏览器的版本" class="header-anchor">#</a> PC浏览器的分布？主流浏览器的版本</h2> <p>主流的浏览器分为IE、Chrome、Firefox、Safari等几大类，它们具有以下特点：</p> <p>1、IE浏览器。</p> <p>Windows自带的浏览器，只支持Windows系统。国内的360浏览器、搜狗浏览器，都是在IE内核基础上开发的。</p> <p>2、Chrome浏览器。</p> <p>Chrome浏览器由Google在开源项目的基础上独立开发的一款浏览器，市场占有率第一，提供了很多方便开发者使用的插件。支持Windows平台，还支持Linux、Mac系统，同时它也提供了移动端的应用（如Android和iOS平台）</p> <p>3、Firefox浏览器。</p> <p>Firefox浏览器是开源组织提供的一款<strong>开源的浏览器</strong>，它开源了浏览器的源码，也提供了很多插件，方便了用户的使用，支持Windows平台、Llnux平台和Mac平台。</p> <p>4、Safari浏览器。</p> <p>Safari浏览器主要是Apple公司为Mac系统量身打造的一款浏览器，主要应用在Mac和iOS系统中</p> <h2 id="重点-缓存问题-etag和if-modify-since是怎么来的"><a href="#重点-缓存问题-etag和if-modify-since是怎么来的" class="header-anchor">#</a> (重点)缓存问题，Etag和IF-modify-since是怎么来的？</h2> <h5 id="协商缓存-4"><a href="#协商缓存-4" class="header-anchor">#</a> 协商缓存</h5> <p>协商缓存需要进行对比判断是否可以使用缓存。浏览器第一次请求数据时，服务器会将缓存标识与数据一起响应给客户端，客户端将它们备份至缓存中。再次请求时，客户端会将缓存中的标识发送给服务器，服务器根据此标识判断。若未失效，返回304状态码，浏览器拿到此状态码就可以直接使用缓存数据了。</p> <p>对于协商缓存来说，缓存标识我们需要着重理解一下，下面我们将着重介绍它的两种缓存方案。</p> <h6 id="last-modified-2"><a href="#last-modified-2" class="header-anchor">#</a> <font color="red" size="3">Last-Modified</font></h6> <blockquote><p>Last-Modified：服务器在响应请求时，会告诉浏览器资源的最后修改时间。</p></blockquote> <ul><li><code>if-Modified-Since</code>:浏览器再次请求服务器的时候，请求头会包含此字段，后面跟着在缓存中获得的最后修改时间。服务端收到此请求头发现有if-Modified-Since，则与被请求资源的最后修改时间进行对比，如果一致则返回304和响应报文头，浏览器只需要从缓存中获取信息即可。</li></ul> <p>从字面上看，就是说：从某个时间节点算起，是否文件被修改了</p> <ul><li>如果真的被修改：那么开始传输响应一个整体，服务器返回：200 OK</li> <li>如果没有被修改：那么只需传输响应header，服务器返回：304 Not Modified</li> <li><code>if-Unmodified-Since</code>:从字面上看, 就是说: 从某个时间点算起, 是否文件没有被修改
<ul><li>如果没有被修改:则开始`继续'传送文件: 服务器返回: 200 OK</li> <li>如果文件被修改:则不传输,服务器返回: 412 Precondition failed (预处理错误)</li></ul></li></ul> <p>这两个的区别是一个是修改了才下载一个是没修改才下载。</p> <p>Last-Modified 说好却也不是特别好，因为如果在服务器上，一个资源被修改了，但其实际内容根本没发生改变，会因为Last-Modified时间匹配不上而返回了整个实体给客户端（即使客户端缓存里有个一模一样的资源）。为了解决这个问题，HTTP1.1推出了Etag。</p> <h6 id="etag-2"><a href="#etag-2" class="header-anchor">#</a> <font color="red" size="3">Etag</font></h6> <blockquote><p>Etag：服务器响应请求时，通过此字段告诉浏览器当前资源在服务器生成的唯一标识（生成规则由服务器决定）</p></blockquote> <ul><li>If-None-Match：再次请求服务器时，浏览器的请求报文头部会包含此字段，后面的值为在缓存中获取的标识。服务器接收到次报文后发现If-None-Match则与被请求资源的唯一标识进行对比。
<ul><li>不同，说明资源被改动过，则响应整个资源内容，返回状态码200。</li> <li>相同，说明资源无心修改，则响应header，浏览器直接从缓存中获取数据信息。返回状态码304.</li></ul></li></ul> <p>但是实际应用中由于Etag的计算是使用算法来得出的，而算法会占用服务端计算的资源，所有服务端的资源都是宝贵的，所以就很少使用Etag了。</p> <h2 id="非同源cookie怎么访问"><a href="#非同源cookie怎么访问" class="header-anchor">#</a> 非同源cookie怎么访问</h2> <p>1.服务器端使用CROS协议解决跨域访问数据问题时，需要设置响应消息头Access-Control-Allow-Credentials值为“true”。
同时，还需要设置响应消息头Access-Control-Allow-Origin值为指定单一域名（注：不能为通配符“*”）。</p> <p>2.客户端需要设置Ajax请求属性withCredentials=true，让Ajax请求都带上Cookie。</p> <h2 id="如果要你缓存图片你怎么做"><a href="#如果要你缓存图片你怎么做" class="header-anchor">#</a> 如果要你缓存图片你怎么做？</h2> <p>前端 <a href="https://so.csdn.net/so/search?q=ajax&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">ajax<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 加载缓存方案 —— 图片强制缓存</p> <p>很多时候，浏览器会强制对页面里面的静态资源进行缓存，以提升页面的二次加载速度。</p> <p>当然这种说法，其实是不太准确的，因为我们是可以通过多种方式来控制这种“浏览器默认的缓存机制”。</p> <p>既可以通过在 html 的 head 中加标签来控制，也可以通过在后端响应前端的请求的响应头中设置参数来控制。</p> <p>如果想详细研究的话，请参考 stackoverflow 上的相关讨论，已经很详细了：https://stackoverflow.com/questions/49547/how-do-we-control-web-page-caching-across-all-browsers</p> <p><font color="red" size="3">这种浏览器默认的缓存的机制，其实是不可靠的，因为对于我们来说，不是完全可控的。</font></p> <p>如果我们想要一种完全可控的前端图片缓存机制，我们该如何做呢？</p> <p>别着急，耐心往下看，你就明白应该怎么处理了。
前端默认加载图片的几种方式</p> <p>我们知道的是，默认情况下，我们加载图片，都是借助 html 标签来加载的，我们一般的做法有几种：</p> <p><strong>1. html 方式</strong></p> <p>直接写在 html 代码中，将 img 标签的 src 设置为我们图片的路径。</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://www.baidu.com/img/bd_logo1.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>JavaScript 方式</li></ol> <p>通过创建一个 Image 对象的实例，然后将该实例的 src 属性设置为我们图片的路径。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'https://www.baidu.com/img/bd_logo1.png'</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'图片加载完成✅！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>上面 👆 这两种方式，都不是我们可控的。</p> <p>因为这两种方式，有个共同点，都不是通过 ajax 方式加载的，而是浏览器引擎解析了以后，自动请求的。</p> <p>打开 devtools，你就会明白这种说法是什么意思。</p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/aHR0cHM6Ly9jZG4ubmxhcmsuY29tL3l1cXVlLzAvMjAyMC9wbmcvMjA0OTU0LzE1NzkxOTQ5MTI2MDQtNjc5YzAyYjQtYjIwOC00Njk1LTk4YzMtYzU5OTIyMGQzMzE2LnBuZw" alt="image.png"></p> <p>但是如果，我们将图片的加载完全改成 ajax 加载，那么我们就可以完全控制，是否需要对图片做缓存了。</p> <p>但是如何做呢？</p> <h3 id="_1-ajax-加载图片"><a href="#_1-ajax-加载图片" class="header-anchor">#</a> 1.ajax 加载图片</h3> <p>这里我们借助 fetch 这个 api，来方便我们发送 ajax 请求。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>然后我们可以通过 then，拿到请求到的对象，但是这个对象需要封装成文件，我们才能使用。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_2-url-createobjecturl"><a href="#_2-url-createobjecturl" class="header-anchor">#</a> 2.. URL.createObjectURL</h3> <p>然后再通过 then 的链式调用，拿到封装后的文件对象。</p> <p>在这种方式，我们通过 URL.createObjectURL 这个 api，对拿到的文件对象进行封装，封装了以后，会返回一个新的 url 对象，这个对象可以理解为我们浏览器中的该对象的引用或者指针，就是指代该对象的。</p> <p>如果不了解 URL.createObjectURL，可以参考下该页面：https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> imgUrl <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果不理解为什么要这么用，可以参考下面这个在 input 选择图片上传的过程中预览图片的小 demo：https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications#Example_Using_object_URLs_to_display_images。</p> <blockquote><p>内存管理
在每次调用 createObjectURL() 方法时，都会创建一个新的 URL 对象，即使你已经用相同的对象作为参数创建过。当不再需要这些 URL 对象时，每个对象必须通过调用 URL.revokeObjectURL() 方法来释放。
浏览器在 document 卸载的时候，会自动释放它们，但是为了获得最佳性能和内存使用状况，你应该在安全的时机主动释放掉它们。</p></blockquote> <p>当用户在刷新页面的时候，会先执行 document 卸载操作，这些 对象URL 也被垃圾回收掉了，当用户再次进入的时候，访问的还是缓存的资源，然而这个资源的实际内存已经不存在了，所以会出现图片访问404的问题。好比那句话，人活着钱没了的感觉。。。</p> <p><font color="red" size="3">所以，使用URL.createObjectURL后无法直接将图片存入localStorage</font></p> <h3 id="_3-转为base64-格式"><a href="#_3-转为base64-格式" class="header-anchor">#</a> 3. 转为base64 格式</h3> <p>base64 也是一种常见用来存储图片的格式，我们可以借助其将图片编码为字符串，便于我们存储在数据库或者代码之中。</p> <p>我们当然也可以借助 base64 的方式，来存储我们通过 ajax 方式请求到的图片。</p> <p>我们直接将获取到的 blob 文件，通过<font color="red" size="3"> FileReader 对象</font>上的 <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader/readAsDataURL" target="_blank" rel="noopener noreferrer">readAsDataURL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这个 api，将其读取成 base64 格式的图片。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileReader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> base64 <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// readAsDataURL</span>
    fileReader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileReader<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'blobToBase64 error'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">1234567891011121314</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><hr> <p>理清楚了这个思路以后，接下来，就可以接着上一篇文章的思路来了。</p> <p>我们直接将 blob 存储在 IndexedDB 数据库中，我们借助 read 从 imagePool 这个表中读取我们请求的 url，当读取成功了，就证明这个文件我们曾经读取过，属于二次加载。</p> <p>那么我们 then 的 resolve 方法中就会被调用，否则 reject 方法就会被调用。</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">blob</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">add</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token string">'imagePool'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> imgUrl <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>imgUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getImageByXHR</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">read</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'imagePool'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
      reslove<span class="token punctuation">,</span>
      reject
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>当然，就像我们之前讲过的那样，凡事都有利弊，需要合理的衡量利弊。</p> <p>在性能和内存占用以及兼容性之间，找到一个合适的平衡点，足以。</p> <h3 id="_4-缓存在localstorage"><a href="#_4-缓存在localstorage" class="header-anchor">#</a> 4.缓存在localStorage</h3> <p>我们知道转base64会导致内存占用变大，本来3个字节结果变为了4个字节，</p> <p>我在开发时发现：我们的图片转为 base64 后大约在 30kb 左右（前提时对用户上传的图片进行压缩），有可能导致localStorage被占满，我们需要提供删除图片缓存的机制： 在用户退出登录的时候清空登录数据和图片缓存数据 检测本地缓存占用大小，提供用户一个类似于app上清空缓存的操作，主动提示用户去清空图片缓存 下下策，互相伤害，将别的域名下的localStorage删掉，只保留本域名下的缓存（这招可太阴了）</p> <h2 id="有多台服务器-sessionid怎么找"><a href="#有多台服务器-sessionid怎么找" class="header-anchor">#</a> 有多台服务器，sessionid怎么找</h2> <p>当使用多台服务器架设成集群之后，我们通过负载均衡的方式，同一个用户(或者ip)访问时被分配到不同的服务器上，假设在A服务器登录，如果在B服务器拿不到用户的登录信息session。这时访问到B服务器时就出现未登录情况。</p> <p>所以如何对于这种情况做到共享session至关重要。</p> <p>以下给出一些解决方案：(来源网络以及自己的一些见解)</p> <p><strong>1.通过数据库mysql共享session</strong></p> <p>a.采用一台专门的mysql服务器来存储所有的session信息。</p> <p>用户访问随机的web服务器时，会去这个专门的数据库服务器check一下session的情况，以达到session同步的目的。</p> <p>缺点就是：依懒性太强，mysql服务器无法工作，影响整个系统；</p> <p>b.将存放session的数据表与业务的数据表放在同一个库。如果mysql做了主从，需要每一个库都需要存在这个表，并且需要数据实时同步。</p> <p>缺点：用数据库来同步session，会加大数据库的负担，数据库本来就是容易产生瓶颈的地方，如果把session还放到数据库里面，无疑是雪上加霜。上面的二种方法，第一点方法较好，把放session的表独立开来，减轻了真正数据库的负担 。但是session一般的查询频率较高，放在数据库中查询性能也不是很好，不推荐使用这种方式。</p> <p><strong>2.通过cookie共享session</strong></p> <p>把用户访问页面产生的session放到cookie里面，就是以cookie为中转站。</p> <p>当访问服务器A时，登录成功之后将产生的session信息存放在cookie中；当访问请求分配到服务器B时，服务器B先判断服务器有没有这个session，如果没有，在去看看客户端的cookie里面有没有这个session，如果cookie里面有，就把cookie里面的sessoin同步到web服务器B，这样就可以实现session的同步了。</p> <p>缺点：cookie的安全性不高，容易伪造、客户端禁止使用cookie等都可能造成无法共享session。</p> <p><strong>3.通过服务器之间的数据同步session</strong></p> <p>使用一台作为用户的登录服务器，当用户登录成功之后，会将session写到当前服务器上，我们通过脚本或者守护进程将session同步到其他服务器上，这时当用户跳转到其他服务器，session一致，也就不用再次登录。</p> <p>缺陷：速度慢，同步session有延迟性，可能导致跳转服务器之后，session未同步。而且单向同步时，登录服务器宕机，整个系统都不能正常运行。</p> <p><strong>4.通过NFS共享Session</strong></p> <p>选择一台公共的NFS服务器(Network File Server)做共享服务器，所有的Web服务器登陆的时候把session数据写到这台服务器上，那么所有的session数据其实都是保存在这台NFS服务器上的，不论用户访问那太Web服务器，都要来这台服务器获取session数据，那么就能够实现共享session数据了。</p> <p>缺点：依赖性太强，如果NFS服务器down掉了，那么大家都无法工作了，当然，可以考虑多台NFS服务器同步的形式。</p> <p><strong>5.通过memcache同步session</strong></p> <p>memcache可以做分布式，如果没有这功能，他也不能用来做session同步。他可以把web服务器中的内存组合起来，成为一个&quot;内存池&quot;，不管是哪个服务器产生的sessoin都可以放到这个&quot;内存池&quot;中，其他的都可以使用。</p> <p>优点：以这种方式来同步session，不会加大数据库的负担，并且安全性比用cookie大大的提高，把session放到内存里面，比从文件中读取要快很多。</p> <p>缺点：memcache把内存分成很多种规格的存储块，有块就有大小，这种方式也就决定了，memcache不能完全利用内存，会产生内存碎片，如果存储块不足，还会产生内存溢出。</p> <p><strong>6.通过redis共享session</strong></p> <p>redis与memcache一样，都是将数据放在内存中。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p> <p><font color="red" size="3">根据实际开发应用，一般选择使用memcache或redis方式来共享session.</font> <img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/20210227113314225.png" alt="img"></p> <h2 id="图片懒加载"><a href="#图片懒加载" class="header-anchor">#</a> 图片懒加载</h2> <p>https://q.shanyue.tech/fe/dom/1.html#%E6%96%B9%E6%A1%88%E4%B8%80-%E4%BD%8D%E7%BD%AE%E8%AE%A1%E7%AE%97-%E6%BB%9A%E5%8A%A8%E4%BA%8B%E4%BB%B6-scroll-dataset-api</p> <h3 id="方案一-clientheight、scrolltop-和-offsettop"><a href="#方案一-clientheight、scrolltop-和-offsettop" class="header-anchor">#</a> 方案一:clientHeight、scrollTop 和 offsetTop</h3> <p>首先给图片一个占位资源:</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.xxx.com/target.jpg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>接着，通过监听 scroll 事件来判断图片是否到达视口:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> num <span class="token operator">=</span> img<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//计数器，从第一张图片开始计</span>

<span class="token function">lazyload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//首次加载别忘了显示图片</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> lazyload<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">lazyload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> viewHeight <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span><span class="token comment">//视口高度</span>
  <span class="token keyword">let</span> scrollTop <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span><span class="token comment">//滚动条卷去的高度</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> count<span class="token punctuation">;</span> i <span class="token operator">&lt;</span>num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 元素现在已经出现在视口中</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetTop <span class="token operator">&lt;</span> scrollHeight <span class="token operator">+</span> viewHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&quot;default.jpg&quot;</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
      img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>src <span class="token operator">=</span> img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;data-src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      count <span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>当然，最好对 scroll 事件做节流处理，以免频繁触发:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// throttle函数我们上节已经实现</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> <span class="token function">throttle</span><span class="token punctuation">(</span>lazyload<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="方案二-getboundingclientrect"><a href="#方案二-getboundingclientrect" class="header-anchor">#</a> 方案二：getBoundingClientRect</h3> <p>现在我们用另外一种方式来判断图片是否出现在了当前视口, 即 DOM 元素的 <code>getBoundingClientRect</code> API。</p> <p>上述的 lazyload 函数改成下面这样:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">lazyload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> count<span class="token punctuation">;</span> i <span class="token operator">&lt;</span>num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 元素现在已经出现在视口中</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>top <span class="token operator">&lt;</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&quot;default.jpg&quot;</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
      img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>src <span class="token operator">=</span> img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;data-src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      count <span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="方案三-intersectionobserver"><a href="#方案三-intersectionobserver" class="header-anchor">#</a> 方案三: IntersectionObserver</h3> <p>这是浏览器内置的一个<code>API</code>，实现了<code>监听window的scroll事件</code>、<code>判断是否在视口中</code>以及<code>节流</code>三大功能。</p> <p>我们来具体试一把：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;img&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntersectionObserver</span><span class="token punctuation">(</span><span class="token parameter">changes</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//changes 是被观察的元素集合</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> changes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> change <span class="token operator">=</span> changes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过这个属性判断是否在视口中</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>change<span class="token punctuation">.</span>isIntersecting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> imgElement <span class="token operator">=</span> change<span class="token punctuation">.</span>target<span class="token punctuation">;</span>
      imgElement<span class="token punctuation">.</span>src <span class="token operator">=</span> imgElement<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;data-src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      observer<span class="token punctuation">.</span><span class="token function">unobserve</span><span class="token punctuation">(</span>imgElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这样就很方便地实现了图片懒加载，当然这个<code>IntersectionObserver</code>也可以用作其他资源的预加载，功能非常强大。</p> <h3 id="方案四-lazyloading-属性"><a href="#方案四-lazyloading-属性" class="header-anchor">#</a> 方案四: LazyLoading 属性</h3> <p>浏览器觉得懒加载这事可以交给自己做，你们开发者加个属性就好了。实在是...！</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shanyue.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">loading</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>lazy<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="重点-跨浏览器开发"><a href="#重点-跨浏览器开发" class="header-anchor">#</a> (重点)跨浏览器开发</h2> <p>事件方面已经不用考虑了。现在基本都是现代浏览器，事件这种比较基础的 API 已经统一了。</p> <p>现在主要是 ES 标准存在实现差异，常见的解决方法有babel和esbuild（类似webpack的打包工具）</p> <p>css某些属性规定指定的浏览器</p> <h2 id="重点-浏览器缓存"><a href="#重点-浏览器缓存" class="header-anchor">#</a> (重点)浏览器缓存</h2> <p>https://juejin.cn/post/6947936223126093861</p> <h2 id="localhost-3000-与-localhost-5000-的-cookie-信息是否共享"><a href="#localhost-3000-与-localhost-5000-的-cookie-信息是否共享" class="header-anchor">#</a> localhost:3000 与 localhost:5000 的 cookie 信息是否共享</h2> <p>根据同源策略，cookie 是区分端口的，但是浏览器实现来说，“cookie 区分域，而不区分端口，也就是说，同一个 ip 下的多个端口下的 cookie 是共享的！</p> <h2 id="如何设置一个cookie"><a href="#如何设置一个cookie" class="header-anchor">#</a> 如何设置一个cookie</h2> <p><strong>服务端是通过 setCookie 的响应头来设置 cookie 的</strong>，要设置多个 cookie 时，得多写几个 setCookie。服务器如果希望在浏览器保存 Cookie，就要在 HTTP 回应的头信息里面，放置一个 Set-Cookie 字段。</p> <p>前端使用 document.cookie 属性来读写当前网页的 Cookie。写入的时候，Cookie 的值必须写成 key=value 的形式。</p> <p>Cookie  曾一度用于客户端数据的存储，因当时并没有其它合适的存储办法而作为唯一的存储手段，但现在随着现代浏览器开始支持各种各样的存储方式，Cookie  渐渐被淘汰。由于服务器指定 Cookie 后，浏览器的每次请求都会携带 Cookie 数据，会带来额外的性能开销（尤其是在移动环境下）</p> <h2 id="重点-如何删除一个-cookie"><a href="#重点-如何删除一个-cookie" class="header-anchor">#</a> (重点)如何删除一个 cookie</h2> <p>通过把该 <code>cookie</code> 的过期时间改为过去时即可删除成功，具体操作的话可以通过操作两个字段来完成</p> <ol><li><code>max-age</code>: 将要过期的最大秒数，设置为 <code>-1</code> 即可删除</li> <li><code>expires</code>: 将要过期的绝对时间，存储到 <code>cookies</code> 中需要通过 <code>date.toUTCString()</code> 处理，设置为过期时间即可删除</li></ol> <p>很明显，<code>max-age</code> 更为简单，以下代码可在命令行控制台中进行测试</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// max-age 设置为 -1 即可成功</span>
document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&quot;a=3; max-age=-1&quot;</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> document<span class="token punctuation">.</span>cookie
<span class="token operator">&lt;</span> <span class="token string">&quot;&quot;</span>

<span class="token operator">&gt;</span> document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'a=3'</span>
<span class="token operator">&lt;</span> <span class="token string">&quot;a=3&quot;</span>

<span class="token operator">&gt;</span> document<span class="token punctuation">.</span>cookie
<span class="token operator">&lt;</span> <span class="token string">&quot;a=3&quot;</span>

<span class="token comment">// 把该字段的 max-age 设置为 -1</span>
<span class="token operator">&gt;</span> document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'a=3; max-age=-1'</span>
<span class="token operator">&lt;</span> <span class="token string">&quot;a=3; max-age=-1&quot;</span>

<span class="token comment">// 删除成功</span>
<span class="token operator">&gt;</span> document<span class="token punctuation">.</span>cookie
<span class="token operator">&lt;</span> <span class="token string">&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="当-cookie-没有设置-maxage-时-cookie-会存在多久"><a href="#当-cookie-没有设置-maxage-时-cookie-会存在多久" class="header-anchor">#</a> 当 cookie 没有设置 maxage 时，cookie 会存在多久</h2> <p>不设置 max-age 和 expires，此 cookie 就是会话级别的，浏览器关闭就没了</p> <h2 id="浏览器中-cookie-有哪些字段"><a href="#浏览器中-cookie-有哪些字段" class="header-anchor">#</a> 浏览器中 cookie 有哪些字段</h2> <ul><li>Domain</li> <li>Path</li> <li>Expire/MaxAge</li> <li>HttpOnly</li> <li>Secure</li> <li>SameSite</li></ul> <h2 id="异步加载-js-脚本时-async-与-defer-有何区别"><a href="#异步加载-js-脚本时-async-与-defer-有何区别" class="header-anchor">#</a> 异步加载 JS 脚本时，async 与 defer 有何区别</h2> <p><img src="https://html.spec.whatwg.org/images/asyncdefer.svg" alt="async 与 defer 区别"></p> <p>在<em>正常情况下</em>，即 <code>&lt;script&gt;</code> 没有任何额外属性标记的情况下，有几点共识</p> <ol><li>JS 的脚本分为<strong>加载、解析、执行</strong>几个步骤，简单对应到图中就是 <code>fetch</code> (加载) 和 <code>execution</code> (解析并执行)</li> <li><strong>JS 的脚本加载(fetch)且执行(execution)会阻塞 DOM 的渲染</strong>，因此 JS 一般放到最后头</li></ol> <p>而 <code>defer</code> 与 <code>async</code> 的区别如下:</p> <ul><li>相同点: <strong>异步加载 (fetch)</strong></li> <li>不同点:
<ul><li>async 加载(fetch)完成后立即执行 (execution)，因此可能会阻塞 DOM 解析；</li> <li>defer 加载(fetch)完成后延迟到 DOM 解析完成后才会执行(execution)**，但会在事件 <code>DomContentLoaded</code> 之前</li></ul></li></ul> <h2 id="重点-重绘和重排有什么区别-怎么优化"><a href="#重点-重绘和重排有什么区别-怎么优化" class="header-anchor">#</a> (重点)重绘和重排有什么区别，怎么优化</h2> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230222130637192.png" alt="image-20230222130637192"></p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230222130646358.png" alt="image-20230222130646358"></p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230222130708586.png" alt="image-20230222130708586"></p> <p><img src="https://cdn.jsdelivr.net/gh/KeXiaoZhan/Images/image-20230222130807952.png" alt="image-20230222130807952"></p> <p>扩展: 怎么形成bfc</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/面经/腾讯面经/浏览器安全.html" class="prev">
        浏览器安全
      </a></span> <span class="next"><a href="/docs/面经/腾讯面经/前端框架.html">
        前端框架
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.9351438b.js" defer></script><script src="/docs/assets/js/2.4eec09cd.js" defer></script><script src="/docs/assets/js/1160.b9554851.js" defer></script>
  </body>
</html>
